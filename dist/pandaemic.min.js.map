{"version":3,"sources":["webpack://pandaemic_lib/webpack/bootstrap","webpack://pandaemic_lib/./src/utils.ts","webpack://pandaemic_lib/(webpack)/buildin/global.js","webpack://pandaemic_lib/./node_modules/events/events.js","webpack://pandaemic_lib/./src/boidRules.ts","webpack://pandaemic_lib/./src/pandemic.ts","webpack://pandaemic_lib/./src/color.ts","webpack://pandaemic_lib/./src/grapher.ts","webpack://pandaemic_lib/./src/index.ts","webpack://pandaemic_lib/./src/boids.ts","webpack://pandaemic_lib/./node_modules/timers-browserify/main.js","webpack://pandaemic_lib/./node_modules/setimmediate/setImmediate.js","webpack://pandaemic_lib/./node_modules/process/browser.js","webpack://pandaemic_lib/./src/parametercontrol.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","vec2","x","y","sub","this","add","scl","len","Math","sqrt","norm","fn","a","min","v","max","dot","rect","pos","size","position","center","isInside","point","insideX","insideY","parameter_type","parameter","type","nparam","help","dependecies","universal_percentage","getParameterByName","_values","entity_scoped","registerDependency","_updateHandler","getValue","push","_randomValue","paramList","emitter","emit","param","length","diff","abs","pop","_updateValues","_i","_a","cb","setImmediate","rnd","random","callback","valueOf","id","universal","setValue","val","setMin","setMax","getParametersByName","params","getParameterByNameOrCreate","_param","getParameters","EventEmitter","ruler","checkLength","str","fontStyle","element","_getElement","style","font","innerHTML","offsetWidth","checkHeight","offsetHeight","document","createElement","body","appendChild","visibility","top","whiteSpace","g","Function","e","window","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","init","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","prepend","events","existing","warning","newListener","unshift","warned","w","Error","String","count","console","warn","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","listeners","addListener","on","prependListener","once","prependOnceListener","list","originalListener","shift","index","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","distanceAccelerator","entities","distMatrix","tmp","ii","dvec","dist","vec","extendStatics","__extends","b","setPrototypeOf","__proto__","__","constructor","distanceElement","boidRule","ruleName","log","executeRule","entity","distanceMatrix","weightRule","dir","weightParamNormal","weightParamSick","weightParam","immuneState","immune_system_state","sick","socialRule","_super","_this","view_distance","entity_size","nEntities","viewDistance","rule_dir","_entity","removed","distEl","deceased","randomRule","avoidanceRule","avoidance_distance","avoidanceDistance","sicknessRule","infection_distance","infecting","incubating","infectionDistance","inVirusVicinity","immune_system","mortality_rate","infection_rate","incubation_time","healing_time","immune_time","_state","healthy","timer","makeSick","newstate","onStateUpdated","configurable","update","immune","infectable","AppColors","infected","dead","outline","fontColor","graphedVariable","color","values","variableList","appendValue","resetData","event","getGraphVariableByName","vars","variable","getGraphVariableByNameOrCreate","_var","getGraphedVariables","grapher","ctx","sizeChanged","margin","varNamesWidthPx","fontSizePt","colorDotSizePx","varNameSizePx","legendSize","legendMarkerHeight","nRows","dataChanged","updateIntervalID","minVal","maxVal","boundsChanged","width","canvas","height","varUpdatedListener","varAddedListener","stepSize","rowSize","yScale","xScale","startUpdateInterval","redrawLegend","addEventListener","setTimeout","resizeEvent","_updateLengendSizing","fontsize_px","toFixed","maxSizePx","nameSizePx","newval","interval","clearInterval","setInterval","clearRect","plotAllGraphVariables","fillStyle","idx","offset","fillText","beginPath","arc","PI","fill","strokeStyle","ySize","scale","moveTo","lineTo","stroke","translate","variables_1","gv","plotData","data","dataSet","sections","reset","boids","rules","initCanvas","canvasElement","container","canvasContext","getContext","resizeHandler","h","clientHeight","clientWidth","onload","param_container","getElementById","app_window","maxHeight","getBoundingClientRect","ParameterController","_initParameterController","be","gr","grapherCanvasElement","_initGrapher","options","boidEngineConfig","maxEntities","maxEntitySize","minEntitySize","fps","boidEngine","randr","addRule","socr","avr","sickr","infectOne","_initPandaemicApplication","btnRestart","onclick","restart","_initControls","scrollTo","continuum","boidRuleConfig","entitiesToBeRemoved","resetInNext","renderIntervalID","updateInterval","_parameterUpdateHandler","eps","entitiesToInfect","entitiesToImmunize","bound_size","_hbs","_initBoids","frametime","startRenderInterval","gv_EntitiesAlive","gv_EntitiesInfected","gv_EntitiesSick","gv_EntitesImmune","gv_EntitiesDead","floor","setImmuneSystemState","immunizeOne","boidStateUpdateHandler","_generateNewBoid","_x","_y","_pos","_ent","boid","onImmuneSystemStateUpdated","_render","stopRenderInterval","_update","stopUpdateInterval","_rule","clearRules","lineWidth","_updateGraphData","nInfected","nSick","nImmune","nDead","nAlive","_b","_c","velocity","_size","acceleration","speed","immuneSystem","walk_dir","rule","walk_acc","limit","limit_vec_len","new_position","_resolveCollisions","newpos","mindist","resolve_vector","self","Timeout","clearFn","_id","_clearFn","scope","clearTimeout","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","global","clearImmediate","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","attachTo","toString","process","handle","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","port2","documentElement","script","onreadystatechange","removeChild","source","indexOf","slice","attachEvent","task","run","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","binding","cwd","chdir","umask","ParameterControl","controller","minElement","maxElement","valueSlider","controlledParameter","createUIElement","loadFromLocalStorage","attachListeners","listElem","className","param_name","innerText","param_ctrl","label_min","htmlFor","input_min","br_el","label_max","input_max","param_setpoint","param_slider","addUIElement","localStorage","getItem","JSON","parse","saveParameterLocally","setItem","stringify","_el_1","onchange","parseInt","_el_2","_el_3","parameter_container","parameterAddHandler","controlElements","_ctrl"],"mappings":"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","file":"pandaemic.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","import { EventEmitter } from 'events'\r\n\r\nexport class vec2 {\r\n  x: number\r\n  y: number\r\n\r\n  constructor(x:number|null = 0, y:number|null = 0){\r\n    x = x || 0\r\n    y = y || 0\r\n\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  sub(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x - x.x, this.y - x.y)\r\n    }\r\n\r\n    y = y || x\r\n\r\n    return new vec2(this.x - x, this.y - y)\r\n  }\r\n\r\n  add(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x + x.x, this.y + x.y)\r\n    }\r\n\r\n    return new vec2(this.x + x, this.y + y)\r\n  }\r\n\r\n  scl(s:number|vec2 = 0): vec2{\r\n    if(typeof s === 'object'){\r\n      return new vec2(this.x*s.x, this.y*s.y)\r\n    }\r\n\r\n    return new vec2(this.x*s, this.y*s)\r\n  }\r\n\r\n  len():number{\r\n    return Math.sqrt(this.x*this.x + this.y*this.y)\r\n  }\r\n\r\n  norm():vec2{\r\n    let l = this.len()\r\n    if(l === 0) return new vec2(0, 0)\r\n    return new vec2(this.x/l, this.y/l)\r\n  }\r\n\r\n  fn(a:any):vec2{\r\n    return new vec2(a(this.x), a(this.y))\r\n  }\r\n\r\n  min(v: vec2){\r\n    return new vec2(Math.min(this.x, v.x), Math.min(this.x, v.y))\r\n  }\r\n\r\n  max(v: vec2){\r\n    return new vec2(Math.max(this.x, v.x), Math.max(this.x, v.y))\r\n  }\r\n\r\n  dot(v: vec2){\r\n    return this.x*v.x + this.y*v.y\r\n  }\r\n\r\n}\r\n\r\nexport class rect {\r\n  size: vec2\r\n  position: vec2\r\n\r\n  center: vec2\r\n\r\n  constructor(pos: vec2, size: vec2){\r\n    this.position = pos\r\n    this.size = size\r\n\r\n    this.center = this.position.add(this.size).scl(1/2)\r\n  }\r\n\r\n  isInside(point: vec2){\r\n    let insideX = (point.x > this.position.x) && (point.x < (this.position.x + this.size.x))\r\n    let insideY = (point.y > this.position.y) && (point.y < (this.position.y + this.size.y))\r\n    return insideX && insideY\r\n  }\r\n\r\n\r\n}\r\n\r\nexport enum parameter_type {\r\n  universal,\r\n  entity_scoped,\r\n  universal_percentage\r\n}\r\n\r\nexport class parameter {\r\n  static paramList: parameter[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  min: number\r\n  max: number\r\n  type: parameter_type\r\n  name: string\r\n  help: string|null\r\n\r\n  value: number\r\n  _values: number[]\r\n\r\n  dependecies: any[] = []\r\n\r\n  n: parameter|null\r\n\r\n  constructor(min: number, max:number, type: parameter_type, name: string = 'none', nparam: parameter|null = null, help:string|null=null){\r\n    if(type === parameter_type.universal_percentage){\r\n      // ignore min / max assignment\r\n      this.min = 0\r\n      this.max = 1\r\n    } else {\r\n      this.min = Math.min(min, max)\r\n      this.max = Math.max(min, max)\r\n    }\r\n\r\n    this.type = type\r\n    this.name = name\r\n    this.help = help\r\n\r\n    this.n = nparam || parameter.getParameterByName('nEntities')\r\n\r\n    this.value = (this.max - this.min)/2 + this.min\r\n    this._values = []\r\n    if(this.type === parameter_type.entity_scoped){\r\n      if(this.n){\r\n        this.n.registerDependency(this._updateHandler.bind(this))\r\n        for(let i=0; i<this.n.getValue(); i++){\r\n          this._values.push(this._randomValue())\r\n        }\r\n      }\r\n    }\r\n\r\n    parameter.paramList.push(this)\r\n    // console.log(parameter.paramList)\r\n    parameter.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  _updateHandler(param: parameter|null = null){\r\n    if(param && param.name === 'nEntities'){\r\n      let n = this._values.length\r\n      let diff = param.getValue() - n\r\n      for(let i=0; i<Math.abs(diff); i++) (diff>0)? this._values.push(0) : this._values.pop()\r\n    }\r\n\r\n    //update all values\r\n    this._updateValues()\r\n\r\n    // pass change event onto dependencies :)\r\n    for(let cb of this.dependecies){\r\n      setImmediate(cb, this)\r\n    }\r\n  }\r\n\r\n  _randomValue(): number{\r\n    let rnd:number = Math.random()\r\n    let val:number = (this.max - this.min)*rnd + this.min\r\n    return val\r\n  }\r\n\r\n  _updateValues(){\r\n    if(this.n){\r\n      for(let i=0; i<this.n.getValue(); i++){\r\n        this._values[i] = this._randomValue()\r\n      }\r\n    }\r\n  }\r\n\r\n  registerDependency(callback: any){\r\n    this.dependecies.push(callback)\r\n  }\r\n\r\n  valueOf(): number{\r\n    return 10\r\n  }\r\n\r\n  getValue(id: number = 0): number {\r\n    switch(this.type){\r\n      case parameter_type.universal:\r\n      case parameter_type.universal_percentage:\r\n        return this.value\r\n      case parameter_type.entity_scoped:\r\n        if(id < 0) id = 0\r\n        if(id >= this._values.length) id = this._values.length-1\r\n        return this._values[id]\r\n    }\r\n    return 0\r\n  }\r\n\r\n  setValue(val: number){\r\n    if(val > this.max) val = this.max\r\n    if(val < this.min) val = this.min\r\n    this.value = val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMin(val: number){\r\n    this.min = (this.type === parameter_type.universal_percentage)? 0 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMax(val: number){\r\n    this.max = (this.type === parameter_type.universal_percentage)? 1 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n\r\n\r\n\r\n  static getParametersByName(name: string){\r\n    let params:parameter[] = []\r\n    for(let param of parameter.paramList){\r\n      if(param.name === name) params.push(param)\r\n    }\r\n    return params\r\n  }\r\n\r\n  static getParameterByName(name: string): parameter|null{\r\n    return this.getParametersByName(name)[0]\r\n  }\r\n\r\n  static getParameterByNameOrCreate(name: string, type:parameter_type=parameter_type.entity_scoped, min:number=0, max:number= 1, help: string|null=null): parameter{\r\n    let _param = this.getParametersByName(name)[0]\r\n    if(!_param){\r\n      _param = new parameter(min, max, type, name, null, help)\r\n    }\r\n\r\n    return _param\r\n  }\r\n\r\n  static getParameters(){\r\n    return parameter.paramList\r\n  }\r\n\r\n}\r\n\r\nexport class ruler {\r\n  static element: HTMLElement|null\r\n  static checkLength(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetWidth\r\n  }\r\n\r\n  static checkHeight(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetHeight\r\n  }\r\n\r\n  static _getElement(){\r\n    // document.write('<span id=\"ruler\"></span>')\r\n    ruler.element = document.createElement('span') as HTMLElement\r\n    document.body.appendChild(ruler.element)\r\n    ruler.element.style.visibility = 'hidden'\r\n    ruler.element.style.position = 'absolute'\r\n    ruler.element.style.top = '0'\r\n    ruler.element.style.whiteSpace = 'nowrap'\r\n  }\r\n}\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","import { boid } from './boids'\r\nimport { vec2, rect, parameter, parameter_type } from './utils'\r\nimport { immune_system, immune_system_state } from './pandemic'\r\n\r\nexport class distanceElement{\r\n  dist: number = 0\r\n  vec: vec2 = new vec2()\r\n}\r\n\r\nexport function distanceAccelerator(entities: boid[]): distanceElement[][]{\r\n  let n = entities.length\r\n  let distMatrix: distanceElement [][] = []\r\n\r\n\r\n  let tmp: distanceElement[] = []\r\n  for(let i=0; i<n; i++){\r\n    tmp = []\r\n    // for(let ii=0; ii<n; ii++){\r\n    //   tmp.push({dist: 0, vec: new vec2()})\r\n    // }\r\n    distMatrix.push(tmp)\r\n  }\r\n\r\n  for(let i=0; i<n; i++){\r\n    for(let ii=i; ii<n; ii++){\r\n      let dvec = entities[i].position.sub(entities[ii].position)\r\n      let dist = dvec.len()\r\n      distMatrix[i][ii] = {dist:dist, vec: dvec}\r\n      distMatrix[ii][i] = {dist:dist, vec: dvec.scl(-1)}\r\n    }\r\n  }\r\n  return distMatrix\r\n}\r\n\r\nexport class boidRule {\r\n  ruleName: string;\r\n\r\n  constructor(name:string){\r\n    this.ruleName = name;\r\n    console.log('Constructed new rule w/ name:', name)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2{\r\n    console.log('Excuting base rule :)')\r\n    return new vec2()\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    let weightParamNormal = parameter.getParameterByNameOrCreate(`${this.ruleName} weight`, parameter_type.entity_scoped, 0, 1, `Weight applied to the decision of the ${this.ruleName}, if the Entity is not experiencing symptons (=healthy, immune, infected)`)\r\n    let weightParamSick = parameter.getParameterByNameOrCreate(`${this.ruleName} weight (sick)`, parameter_type.entity_scoped, 0, 1, `Weight applied to the decision of the ${this.ruleName}, if the Entity is experiencing symptons (=sick)`)\r\n\r\n    let weightParam = (entity.immuneState === immune_system_state.sick)? weightParamSick : weightParamNormal\r\n    return dir.scl(weightParam.getValue(entity.id))\r\n  }\r\n\r\n}\r\n\r\nexport class socialRule extends boidRule{\r\n\r\n  view_distance: parameter\r\n  entity_size: parameter\r\n\r\n  constructor(){\r\n    super('SocialRule')\r\n    this.view_distance = parameter.getParameterByNameOrCreate('Grouping Distance', parameter_type.universal, 10, 30, 'Distance in pixels below which Entities will spot another and move towards one each other.')\r\n    this.entity_size = parameter.getParameterByNameOrCreate('EntitySize', parameter_type.universal, 4, 8, 'Entity Size in pixels')\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities = distanceMatrix.length\r\n    let viewDistance = this.view_distance.getValue()\r\n\r\n    let rule_dir = new vec2()\r\n    for(let i:number=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n\r\n      //skip removed entities.\r\n      if(_entity.immuneState === immune_system_state.removed) continue;\r\n      if(entity === _entity) continue\r\n\r\n\r\n\r\n      let distEl = distanceMatrix[entity.id][i]\r\n      // let dist = entity.position.sub(_entity.position)\r\n      let dist = distEl.vec;\r\n      if(distEl.dist < viewDistance){\r\n        // if(dist <= this.entity_size.getValue(id)*1.2) continue\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 1/e))\r\n      }\r\n\r\n      // avoid dead people lol\r\n      if(entity.immuneState === immune_system_state.deceased) rule_dir = rule_dir.scl(-1);\r\n    }\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\nexport class randomRule extends boidRule{\r\n\r\n  constructor(){\r\n    super('randomRule')\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let x = (Math.random() - 0.5) * 2\r\n    let y = (Math.random() - 0.5) * 2\r\n\r\n    let rule_dir = new vec2(x, y)\r\n    return rule_dir.norm()\r\n}\r\n\r\n}\r\n\r\nexport class avoidanceRule extends boidRule{\r\n  avoidance_distance: parameter;\r\n\r\n\r\n  constructor(){\r\n    super('avoidanceRule')\r\n\r\n    this.avoidance_distance = parameter.getParameterByNameOrCreate('Avoidance Distance', parameter_type.universal, 10, 30, 'Distance in pixels below which Entities will spot another and move away from each other.')\r\n\r\n  }\r\n\r\n  executeRule(entity:boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let avoidanceDistance = this.avoidance_distance.getValue()\r\n\r\n    let rule_dir: vec2 = new vec2()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      //skip removed entities.\r\n      if(_entity.immuneState === immune_system_state.removed) continue;\r\n      if(entity === _entity) continue\r\n      let distEl = distanceMatrix[entity.id][i]\r\n      // let dist = _entity.position.sub(entity.position)\r\n      let dist = distEl.vec\r\n      if(distEl.dist < avoidanceDistance){\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 100 * 1/e))\r\n      }\r\n    }\r\n\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\n/*\r\nThis rule does not return a distance, but abuses the rule interface to handle infections...\r\n*/\r\nexport class sicknessRule extends boidRule{\r\n  infection_distance: parameter;\r\n\r\n  constructor(){\r\n    super('sicknessRule')\r\n    this.infection_distance = parameter.getParameterByNameOrCreate('Infection Distance', parameter_type.universal, 10, 15, 'Distance in pixels below which infections can occur.')\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    return dir;\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let infecting = entity.immuneState === immune_system_state.incubating || entity.immuneState === immune_system_state.sick || entity.immuneState === immune_system_state.deceased\r\n\r\n    let infectionDistance = this.infection_distance.getValue()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      //skip removed entities.\r\n      if(_entity.immuneState === immune_system_state.removed) continue;\r\n      if(entity === _entity) continue\r\n      let distEl = distanceMatrix[entity.id][i]\r\n      // let dist = entity.position.sub(_entity.position)\r\n      let dist = distEl.vec\r\n\r\n      // let distEl: distanceElement = distanceMatrix[id][i]\r\n      if(distEl.dist < infectionDistance && infecting){\r\n        // possibly infect the other boid...\r\n        let otherEntity = entities[i]\r\n        otherEntity.inVirusVicinity()\r\n      }\r\n    }\r\n\r\n    return new vec2()\r\n  }\r\n\r\n}\r\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport enum immune_system_state {\r\n  healthy,\r\n  incubating,\r\n  sick,\r\n  deceased,\r\n  removed,\r\n  immune\r\n}\r\n\r\nexport class immune_system {\r\n  mortality_rate: parameter\r\n  infection_rate: parameter\r\n  incubation_time: parameter\r\n  healing_time: parameter\r\n  immune_time: parameter\r\n\r\n  _state: immune_system_state\r\n  timer: number;\r\n\r\n  onStateUpdated: any|null;\r\n\r\n  constructor(){\r\n    this.mortality_rate = parameter.getParameterByNameOrCreate('Mortality Rate', parameter_type.universal_percentage, 0, 1, 'probability to die instead of becoming immune, when the healing time is over')\r\n    this.infection_rate = parameter.getParameterByNameOrCreate('Infection Rate', parameter_type.universal_percentage, 0, 1, 'probability that the entity will become infected when in the vicinity of another sick/infected entity')\r\n    this.incubation_time = parameter.getParameterByNameOrCreate('Incubation Time', parameter_type.universal, 0, 100, 'Time in seconds the virus takes to show symptoms (=change from infected to sick)')\r\n    this.healing_time = parameter.getParameterByNameOrCreate('Healing Time', parameter_type.universal, 0, 100, 'Time in seconds an infected Entity takes to heal/die.')\r\n    this.immune_time = parameter.getParameterByNameOrCreate('Immune Time', parameter_type.universal, 0, 100, 'Time in seconds a healed Entity is immune for.')\r\n\r\n    this._state = immune_system_state.healthy\r\n    this.timer = 0\r\n  }\r\n\r\n  makeSick(){\r\n    if(this.state !== immune_system_state.deceased){\r\n      this.state = immune_system_state.sick;\r\n    }\r\n  }\r\n\r\n  set state(newstate: immune_system_state){\r\n    this._state = newstate\r\n    if(this.onStateUpdated) this.onStateUpdated(this._state)\r\n  }\r\n\r\n  get state(){\r\n    return this._state\r\n  }\r\n\r\n  update(diff: number){\r\n    switch(this.state){\r\n      case immune_system_state.healthy:\r\n        // do nothing :)\r\n      break;\r\n      case immune_system_state.incubating:\r\n        this.timer += diff\r\n        if(this.timer > this.incubation_time.getValue()*1000){\r\n          this.state = immune_system_state.sick\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case immune_system_state.sick:\r\n        this.timer += diff\r\n        if(this.timer > this.healing_time.getValue()*1000){\r\n          let rnd = Math.random()\r\n          if(rnd > this.mortality_rate.getValue()){\r\n            this.state = immune_system_state.immune\r\n          }else{\r\n            this.state = immune_system_state.deceased\r\n          }\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case immune_system_state.deceased:\r\n        this.timer += diff\r\n        if(this.timer > 5000){\r\n          this.timer = 0;\r\n          this.state = immune_system_state.removed\r\n        }\r\n      break;\r\n      case immune_system_state.immune:\r\n        this.timer += diff\r\n        if(this.timer > this.immune_time.getValue()*1000){\r\n          this.state = immune_system_state.healthy\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case immune_system_state.removed:\r\n      break;\r\n    }\r\n  }\r\n\r\n  get infectable() {\r\n    return this._state === immune_system_state.healthy\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    if(!this.infectable) return\r\n    let _rnd = Math.random()\r\n    if(_rnd <= this.infection_rate.getValue()){\r\n      this.state = immune_system_state.incubating\r\n    }\r\n  }\r\n\r\n\r\n\r\n}\r\n","export class AppColors {\r\n  static immune: string = '#273B89'\r\n  static healthy: string = '#C9D1B2'\r\n  static infected: string = '#F36F21'\r\n  static sick: string = '#FF1919'\r\n  static dead: string = '#191919'\r\n\r\n  static outline: string = '#2a4e6c'\r\n\r\n  static fontColor: string = '#0B141C'\r\n\r\n}\r\n","import { vec2, ruler } from './utils'\r\nimport { EventEmitter } from 'events'\r\nimport { AppColors }  from './color'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class graphedVariable {\r\n  static variableList: graphedVariable[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  name: string\r\n  color: string\r\n\r\n  values: number[]\r\n  n: number\r\n\r\n  constructor(name: string = 'none', color: string = '#000'){\r\n    this.name = name\r\n    this.color = color\r\n\r\n    this.n = 0\r\n    this.values = []\r\n\r\n    graphedVariable.variableList.push(this)\r\n    // console.log(parameter.paramList)\r\n    graphedVariable.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  appendValue(val: number){\r\n    this.values.push(val)\r\n    graphedVariable.emitter.emit('variableUpdated', val, this)\r\n  }\r\n\r\n  get data(){\r\n    // TODO add preprocessing?\r\n    return this.values\r\n  }\r\n\r\n  resetData(){\r\n    this.n = 0\r\n    this.values = []\r\n  }\r\n\r\n  static on(event: string, callback: any){\r\n    graphedVariable.emitter.on(event, callback)\r\n  }\r\n\r\n  static getGraphVariableByName(name: string): graphedVariable|null{\r\n    let vars: graphedVariable[] = []\r\n    for(let variable of graphedVariable.variableList){\r\n      if(variable.name === name) vars.push(variable)\r\n    }\r\n\r\n    if(vars.length === 0) return null\r\n    return vars[0]\r\n  }\r\n\r\n  static getGraphVariableByNameOrCreate(name: string, color: string): graphedVariable{\r\n    let _var = this.getGraphVariableByName(name)\r\n    if(!_var){\r\n      _var = new graphedVariable(name, color)\r\n    }\r\n    return _var\r\n  }\r\n\r\n  static getGraphedVariables(){\r\n    return graphedVariable.variableList\r\n  }\r\n\r\n}\r\n\r\n\r\nexport class grapher{\r\n  values: number[][]\r\n  ctx: CanvasRenderingContext2D\r\n  size: vec2\r\n  sizeChanged: boolean = false\r\n\r\n  maxVal: number\r\n  minVal: number\r\n  boundsChanged: boolean\r\n\r\n  xScale: number\r\n  yScale: number\r\n  stepSize: number\r\n  margin: number = 10\r\n  rowSize: number\r\n\r\n  varNamesWidthPx: number = 0\r\n  fontSizePt: number = 10\r\n  colorDotSizePx: number = 4\r\n  varNameSizePx: number = 25\r\n\r\n  legendSize: number = 50\r\n  legendMarkerHeight: number = 0\r\n  nRows = 4\r\n\r\n  dataChanged: boolean = true\r\n\r\n  updateIntervalID: timerHandle|null = null\r\n\r\n  constructor(ctx: CanvasRenderingContext2D){\r\n    this.values = []\r\n    this.ctx = ctx\r\n\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.boundsChanged = true\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    graphedVariable.on('variableUpdated', this.varUpdatedListener.bind(this))\r\n    graphedVariable.on('paramAdded', this.varAddedListener.bind(this))\r\n\r\n    // set these values for your data\r\n    let sections = 12;\r\n    this.stepSize = 40;\r\n    this.rowSize = 50;\r\n\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.xScale = (this.size.x - this.rowSize) / sections;\r\n\r\n    this.startUpdateInterval(100)\r\n\r\n    this.redrawLegend()\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.sizeChanged = true\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  _updateLengendSizing(){\r\n\r\n    let fontsize_px = this.size.y / 13\r\n    fontsize_px *= 0.85\r\n    this.fontSizePt = fontsize_px * 0.75\r\n    this.fontSizePt = Math.min(this.fontSizePt, 12)\r\n    \r\n    fontsize_px = this.fontSizePt / 0.75\r\n    let fontStyle = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n\r\n    this.varNameSizePx = fontsize_px * 1.5\r\n    this.colorDotSizePx = Math.min(4, this.varNameSizePx/3)\r\n\r\n\r\n    let maxSizePx = 0\r\n    for (let _var of graphedVariable.variableList){\r\n      let nameSizePx = ruler.checkLength(_var.name + 'aa', fontStyle)\r\n      maxSizePx = Math.max(maxSizePx, nameSizePx)\r\n      // console.log(_var.name + '=>' + nameSizePx)\r\n    }\r\n    this.varNamesWidthPx = maxSizePx + 2*this.colorDotSizePx\r\n\r\n    this.legendSize = 2 * ruler.checkLength(this.maxVal.toFixed(1), fontStyle)\r\n    this.legendMarkerHeight = ruler.checkHeight(this.maxVal.toFixed(1), fontStyle)\r\n  }\r\n\r\n  varAddedListener(_var: graphedVariable){\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  varUpdatedListener(newval: number, _var: any): void {\r\n    if(newval < this.minVal){\r\n      this.minVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    if(newval > this.maxVal){\r\n      this.maxVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    this.dataChanged = true\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this.update.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  update(){\r\n    if(!this.dataChanged) return\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    if(this.boundsChanged){\r\n      this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n      // this.xScale = (this.size.x - this.rowSize) / sections;\r\n      this.boundsChanged = false\r\n    }\r\n\r\n    this.redrawLegend()\r\n    this.plotAllGraphVariables()\r\n    // console.log(this)\r\n    this.dataChanged = false\r\n  }\r\n\r\n  redrawLegend(){\r\n    this.ctx.fillStyle = AppColors.fontColor\r\n    this.ctx.font = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n    // this.ctx.font = '10pt Oswald'\r\n\r\n    let idx = 0\r\n    let offset = this.size.y - graphedVariable.getGraphedVariables().length * this.varNameSizePx\r\n    offset = (offset / 2) + this.margin\r\n    for (let _var of graphedVariable.getGraphedVariables()){\r\n      this.ctx.fillStyle = _var.color\r\n      // this.ctx.fillText(_var.name, this.margin, 20);\r\n      this.ctx.fillStyle = AppColors.fontColor\r\n      let y = offset + idx*this.varNameSizePx\r\n      this.ctx.fillText(_var.name, this.margin + this.legendSize, y);\r\n      this.ctx.fillStyle = _var.color\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(this.margin - 8 + this.legendSize,  y - 4, this.colorDotSizePx, 0, 2 * Math.PI, false);\r\n      this.ctx.fill()\r\n      idx ++\r\n    }\r\n\r\n    let stepSize = (this.maxVal - this.minVal) / this.nRows\r\n    // print row header and draw horizontal grid lines\r\n    var count =  0;\r\n    this.ctx.strokeStyle = AppColors.fontColor\r\n    this.ctx.fillStyle = AppColors.fontColor\r\n\r\n    let steps = 4\r\n    let ySize = (this.size.y - 2*this.margin)\r\n    for(let i=0;i<=steps;i++){\r\n      let y = this.margin + ySize * (i/steps)\r\n      let scale = this.minVal + (this.maxVal - this.minVal) * (1 - i/steps)\r\n      this.ctx.fillText(scale.toFixed(1), this.margin, y + this.legendMarkerHeight/4);\r\n      this.ctx.moveTo(this.legendSize + this.varNamesWidthPx, y)\r\n      this.ctx.lineTo(this.size.x - this.margin,y)\r\n    }\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  plotAllGraphVariables(){\r\n    this.ctx.translate(this.legendSize, 0);\r\n    let variables = graphedVariable.getGraphedVariables()\r\n    for(let gv of variables){\r\n      this.ctx.strokeStyle = gv.color\r\n      this.plotData(gv.data)\r\n    }\r\n    this.ctx.translate(-this.legendSize, 0);\r\n  }\r\n\r\n  plotData(dataSet: number[]) {\r\n    let sections = dataSet.length\r\n    // let rowsize = this.size.x / sections\r\n    let xScale = this.size.x / sections;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.yScale * (this.maxVal - dataSet[0]) + this.margin);\r\n    for (let i=1;i<sections;i++) {\r\n      this.ctx.lineTo(i * xScale, this.yScale * (this.maxVal - dataSet[i]) + this.margin);\r\n    }\r\n    this.ctx.stroke();\r\n    }\r\n\r\n  reset(){\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n  }\r\n}\r\n","import * as boids from \"./boids\";\nimport * as rules from \"./boidRules\"\nimport { vec2, rect, parameter, parameter_type } from './utils'\nimport { ParameterController } from './parametercontrol'\nimport { grapher } from './grapher'\n\n\n\nlet initCanvas = (canvasElement: HTMLCanvasElement, container: HTMLElement) => {\n  let canvasContext: CanvasRenderingContext2D|null = canvasElement.getContext('2d');\n\n  let resizeHandler = () => {\n    let h = canvasElement.clientHeight\n    let w = canvasElement.clientWidth\n\n    // Experimental oversize handler, for mobile\n    if(h < 400 || w < 400){\n      h = h*2\n      w = w*2\n    }\n\n    if(canvasContext){\n      canvasContext.canvas.width  = w;\n      canvasContext.canvas.height = h;\n    }\n\n  }\n\n  window.addEventListener('resize', resizeHandler);\n\n  resizeHandler()\n\n  return canvasContext\n}\n\nlet _initPandaemicApplication = (canvas: HTMLCanvasElement) => {\n  let container: HTMLElement|null = document.getElementById('be_canvas_container')\n  if(!container) return\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n\n  let options = new boids.boidEngineConfig()\n  options.maxEntities = 200\n  options.maxEntitySize = 8\n  options.minEntitySize = 8\n  options.fps = 25\n\n  let be = new boids.boidEngine(ctx, options)\n\n  let randr = new rules.randomRule()\n  be.addRule(randr)\n\n  let socr = new rules.socialRule();\n  be.addRule(socr)\n\n  let avr = new rules.avoidanceRule()\n  be.addRule(avr)\n\n  let sickr = new rules.sicknessRule()\n  be.addRule(sickr)\n\n  window.infectOne = be.infectOne.bind(be)\n\n  // be.startRenderInterval(100)\n  // setInterval(be.reset.bind(be), 1000)\n  return be\n}\n\nlet _initParameterController = () => {\n  let param_container = document.getElementById('p_container')\n  let app_window = document.getElementById('window')\n\n\n  if(param_container && app_window){\n    param_container.style.maxHeight = 0.95*app_window.getBoundingClientRect().height + 'px';\n    let _ctrl = new ParameterController(param_container)\n  }\n}\n\nlet _initGrapher = (canvas: HTMLCanvasElement) => {\n\n  let container: HTMLElement|null = document.getElementById('graph_canvas_container')\n  if(!container) return\n\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n  let _grapher = new grapher(ctx)\n  return _grapher\n}\n\nlet _initControls = (be: boids.boidEngine, gr: grapher) => {\n  let btnRestart: HTMLElement|null = document.getElementById('btn_restart')\n  if(btnRestart){\n    btnRestart.onclick = () => {\n      if(!btnRestart) return\n      be.restart()\n      gr.reset()\n    }\n  }\n}\n\nlet main = () => {\n\n  _initParameterController()\n\n  let be = null, gr = null\n\n  //get the grapher canvas element\n  let grapherCanvasElement: HTMLCanvasElement|null = document.getElementById('graph_canvas') as HTMLCanvasElement\n  if(grapherCanvasElement) gr = _initGrapher(grapherCanvasElement)\n\n  // get the canvas element\n  let canvasElement: HTMLCanvasElement|null = document.getElementById('canvas') as HTMLCanvasElement\n  if(canvasElement) be = _initPandaemicApplication(canvasElement)\n\n  if(be && gr){\n    _initControls(be, gr)\n  }\n\n  // Mobile scroll test:\n  window.addEventListener(\"load\",() => {\n    setTimeout(() => window.scrollTo(0, 1), 0);\n  });\n\n  /*\n  for(let i=0; i<20; i++){\n    let param = new parameter(0, 1, parameter_type.universal, `rule_${i}`)\n  }\n  */\n\n}\n\nwindow.onload = main\n","import { vec2, rect, parameter, parameter_type } from \"./utils\";\r\nimport { boidRule, distanceAccelerator, distanceElement} from './boidRules'\r\nimport { immune_system, immune_system_state } from './pandemic'\r\nimport { AppColors } from './color'\r\n\r\nimport { graphedVariable } from './grapher'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class boidEngineConfig {\r\n  maxEntities: number = 500;\r\n  minEntitySize: number = 3;\r\n  maxEntitySize: number = 3;\r\n\r\n  fps: number|null = null;\r\n\r\n  continuum: boolean = true;\r\n}\r\n\r\nexport class boidRuleConfig {\r\n\r\n}\r\n\r\nexport class boidEngine {\r\n\r\n  nEntities: parameter\r\n  ctx: CanvasRenderingContext2D\r\n\r\n  size: vec2\r\n  bound_size: vec2\r\n  _hbs: vec2\r\n\r\n  entity_size: parameter\r\n\r\n  entities: boid[]\r\n  entitiesToBeRemoved: boid[] = []\r\n  resetInNext: boolean = false\r\n\r\n  renderIntervalID: timerHandle|null = null\r\n  updateIntervalID: timerHandle|null = null\r\n  updateInterval: number = 0;\r\n\r\n  entitiesToInfect: parameter\r\n  entitiesToImmunize: parameter\r\n\r\n  rules: boidRule[] = []\r\n\r\n  continuum: boolean;\r\n\r\n  // graphed data:\r\n  gv_EntitiesAlive: graphedVariable\r\n  gv_EntitiesInfected: graphedVariable\r\n  gv_EntitiesSick: graphedVariable\r\n  gv_EntitesImmune: graphedVariable\r\n  gv_EntitiesDead: graphedVariable\r\n\r\n  // Initialization\r\n\r\n  constructor(ctx: CanvasRenderingContext2D, options: boidEngineConfig = new boidEngineConfig()){\r\n    this.ctx = ctx\r\n\r\n    this.nEntities = new parameter(10, options.maxEntities, parameter_type.universal, 'nEntities', null, 'Number of Entities to simulate.')\r\n    this.nEntities.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    let eps = parameter.getParameterByName('EntitySize')\r\n    this.entity_size = (eps)? eps :  new parameter(options.minEntitySize, options.maxEntitySize, parameter_type.entity_scoped, 'EntitySize', null, 'Entity size in pixels')\r\n    this.entity_size.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    this.entitiesToInfect = parameter.getParameterByNameOrCreate('# Infected at Start', parameter_type.universal, 0, 10)\r\n    this.entitiesToImmunize = parameter.getParameterByNameOrCreate('# Immune at Start', parameter_type.universal, 0, 10)\r\n\r\n    this.continuum = options.continuum\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n    this.entities = []\r\n\r\n    this._initBoids()\r\n\r\n    if(options.fps){\r\n      let frametime = 1000/options.fps;\r\n      this.startRenderInterval(frametime)\r\n      this.startUpdateInterval(frametime)\r\n      this.updateInterval = frametime;\r\n    }\r\n    this.gv_EntitiesAlive = graphedVariable.getGraphVariableByNameOrCreate('Entities Alive', AppColors.healthy)\r\n    this.gv_EntitiesInfected = graphedVariable.getGraphVariableByNameOrCreate('Entities Infected' , AppColors.infected)\r\n    this.gv_EntitiesSick = graphedVariable.getGraphVariableByNameOrCreate('Entities Sick', AppColors.sick)\r\n    this.gv_EntitesImmune = graphedVariable.getGraphVariableByNameOrCreate('Entities Immune', AppColors.immune)\r\n    this.gv_EntitiesDead = graphedVariable.getGraphVariableByNameOrCreate('Entities Dead', AppColors.dead)\r\n\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n  }\r\n\r\n  infectOne(){\r\n    let idx = Math.floor(this.entities.length * Math.random())\r\n    this.entities[idx].setImmuneSystemState(immune_system_state.incubating)\r\n  }\r\n\r\n  immunizeOne(){\r\n    let idx = Math.floor(this.entities.length * Math.random())\r\n    this.entities[idx].setImmuneSystemState(immune_system_state.immune)\r\n  }\r\n\r\n\r\n  boidStateUpdateHandler(entity: boid, state: immune_system_state){\r\n    // console.log(`boid #${entity.id} state is now: ${state}`)\r\n    if(state === immune_system_state.deceased){\r\n      //console.log 'removing boid'\r\n      this.entitiesToBeRemoved.push(entity)\r\n    }\r\n  }\r\n\r\n  _generateNewBoid(){\r\n    let id = this.entities.length\r\n    // choose a new starting point randomly :)\r\n    let _x = Math.random()\r\n    let _y = Math.random()\r\n    let _pos = new vec2(_x, _y).scl(this.bound_size)\r\n\r\n    // generate a new entity\r\n    let _ent = new boid(_pos, this.entity_size, id)\r\n\r\n    _ent.onImmuneSystemStateUpdated = this.boidStateUpdateHandler.bind(this, _ent)\r\n\r\n    this.entities.push(_ent)\r\n  }\r\n\r\n  _initBoids(){\r\n    for(let i=0; i<this.nEntities.getValue(); i++){\r\n      this._generateNewBoid()\r\n    }\r\n    for(let i =0; i<this.entitiesToInfect.getValue(); i++){\r\n      this.infectOne()\r\n    }\r\n    for(let i =0; i<this.entitiesToImmunize.getValue(); i++){\r\n      this.immunizeOne()\r\n    }\r\n  }\r\n\r\n  _parameterUpdateHandler(param: parameter){\r\n    switch(param.name){\r\n      case 'nEntities':\r\n        let n = param.getValue()\r\n        let diff = n - this.entities.length\r\n        for(let i=0; i<Math.abs(diff); i++) (diff > 0)? this._generateNewBoid() : this.entities.pop()\r\n      break;\r\n      case 'EntitySize':\r\n        this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Render/Update Intervals\r\n\r\n  startRenderInterval(interval: number){\r\n    if(this.renderIntervalID !== null){\r\n      clearInterval(this.renderIntervalID)\r\n    }\r\n    this.renderIntervalID = setInterval(this._render.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  stopRenderInterval(){\r\n    if(this.renderIntervalID){\r\n      clearInterval(this.renderIntervalID)\r\n      this.renderIntervalID = null\r\n    }\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this._update.bind(this), interval) as unknown as number\r\n\r\n    this.updateInterval = interval\r\n  }\r\n\r\n  stopUpdateInterval(){\r\n    if(this.updateIntervalID){\r\n      clearInterval(this.updateIntervalID)\r\n      this.updateIntervalID = null\r\n    }\r\n  }\r\n\r\n  // interface Methods\r\n\r\n  reset(){\r\n    this.entities = []\r\n    this._initBoids()\r\n  }\r\n\r\n  addRule(_rule: boidRule){\r\n    console.log(_rule)\r\n    this.rules.push(_rule)\r\n  }\r\n\r\n  clearRules(){\r\n    this.rules = []\r\n  }\r\n\r\n  // Render/Update Methods\r\n\r\n  _render(){\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\r\n    let id=0\r\n    for(let entity of this.entities){\r\n\r\n      if(entity.immuneState === immune_system_state.removed) continue;\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI, false);\r\n      switch(entity.immuneState){\r\n        case immune_system_state.immune:\r\n        this.ctx.fillStyle = AppColors.immune;\r\n        break;\r\n\r\n        case immune_system_state.healthy:\r\n        this.ctx.fillStyle = AppColors.healthy;\r\n        break;\r\n\r\n        case immune_system_state.incubating:\r\n        this.ctx.fillStyle = AppColors.infected;\r\n        break;\r\n\r\n        case immune_system_state.sick:\r\n        this.ctx.fillStyle = AppColors.sick;\r\n        break;\r\n\r\n        case immune_system_state.deceased:\r\n        this.ctx.fillStyle = AppColors.dead;\r\n        break;\r\n      }\r\n\r\n      this.ctx.fill();\r\n\r\n      this.ctx.beginPath();\r\n      this.ctx.strokeStyle = AppColors.outline\r\n      this.ctx.lineWidth = 0.3;\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI);\r\n      this.ctx.stroke();\r\n      id ++\r\n    }\r\n  }\r\n\r\n  _updateGraphData(){\r\n    let nEntitesMax = this.nEntities.getValue()\r\n    let nInfected: number = 0\r\n    let nSick: number = 0\r\n    let nImmune: number = 0\r\n    let nDead: number = nEntitesMax - this.entities.length\r\n\r\n    for(let ent of this.entities){\r\n      switch(ent.immuneState){\r\n        case immune_system_state.immune:\r\n          nImmune ++\r\n          break;\r\n        case immune_system_state.incubating:\r\n          nInfected ++\r\n          break;\r\n        case immune_system_state.sick:\r\n          nSick ++\r\n          break;\r\n        case immune_system_state.deceased:\r\n          nDead ++\r\n          break;\r\n      }\r\n    }\r\n\r\n    let nAlive: number = this.entities.length - nDead\r\n\r\n    this.gv_EntitiesAlive.appendValue(nAlive)\r\n    this.gv_EntitiesInfected.appendValue(nInfected)\r\n    this.gv_EntitiesSick.appendValue(nSick)\r\n    this.gv_EntitesImmune.appendValue(nImmune)\r\n    this.gv_EntitiesDead.appendValue(nDead)\r\n  }\r\n\r\n  _update(){\r\n    if(this.resetInNext){\r\n      this.entities = []\r\n      this._initBoids()\r\n      this.resetInNext = false;\r\n    }\r\n\r\n    if(this.entities.length > 0) this._updateGraphData();\r\n    /*\r\n    for(let ent of this.entitiesToBeRemoved){\r\n      this.entities.splice(this.entities.indexOf(ent), 1)\r\n    }\r\n    */\r\n    this.entitiesToBeRemoved = []\r\n    //console.log('stepping panda')\r\n    let diff = this.updateInterval;\r\n    //TODO calulate distance matrix\r\n    let distMatrix = distanceAccelerator(this.entities)\r\n    //let rules_list = [rules.socialRule, rules.randomRule, rules.makeBorderRule(this.size)]\r\n\r\n    for(let entity of this.entities){\r\n      entity.update(diff, this.entities, distMatrix, this.rules)\r\n    }\r\n\r\n    if(this.continuum){\r\n      let id = 0\r\n      for(let entity of this.entities){\r\n        let point = entity.position\r\n        if(point.x < -this.entity_size){\r\n          entity.position.x += this.size.x + entity.size\r\n        }else if (point.x > (this.size.x + this.entity_size.getValue(id))){\r\n          entity.position.x -= this.size.x + entity.size\r\n        }\r\n\r\n        if(point.y < -this.entity_size){\r\n          entity.position.y += this.size.y + entity.size\r\n        }else if (point.y > (this.size.y + this.entity_size.getValue(id))){\r\n          entity.position.y -= this.size.y + entity.size\r\n        }\r\n        id ++\r\n      }\r\n    }\r\n  }\r\n\r\n  restart(){\r\n    console.log('restarting be')\r\n\r\n    this.resetInNext = true\r\n\r\n    this.gv_EntitiesAlive.resetData()\r\n    this.gv_EntitiesInfected.resetData()\r\n    this.gv_EntitiesSick.resetData()\r\n    this.gv_EntitesImmune.resetData()\r\n    this.gv_EntitiesDead.resetData()\r\n  }\r\n\r\n}\r\n\r\nlet limit = (min: number, max: number, val:number) => {\r\n  if(val < min) return min\r\n  if(val > max) return max\r\n  return val\r\n}\r\n\r\nlet limit_vec_len = (vec:vec2, limit:number) => {\r\n  let len = vec.len()\r\n  if(len>limit) return vec.norm().scl(limit)\r\n  return vec\r\n}\r\n\r\nexport class boid {\r\n  position: vec2\r\n  velocity: vec2 = new vec2()\r\n  state: string\r\n  _size: parameter\r\n\r\n  id: number\r\n\r\n  acceleration: parameter\r\n  speed: parameter\r\n\r\n  immuneSystem: immune_system\r\n  ImmuneSystemStateUpdateHandler: any | null\r\n\r\n  constructor(pos: vec2 = new vec2(), size:parameter, id:number=0) {\r\n    this.position = pos\r\n    this._size = size\r\n    this.state = 'base'\r\n\r\n    this.id = id\r\n\r\n    this.acceleration = parameter.getParameterByNameOrCreate('Entity Acceleration', parameter_type.universal, 15, 25, 'Entity Acceleration in pixels/tick (one tick = ~1/25s)')\r\n    this.speed = parameter.getParameterByNameOrCreate('Entity Speed', parameter_type.universal, 15, 20, 'Entity Speed in pixels/tick (one tick = ~1/25s)')\r\n\r\n    this.immuneSystem = new immune_system()\r\n  }\r\n\r\n  update(diff: number, entities:boid[], distanceMatrix:distanceElement[][], rules: boidRule[]){\r\n    if(this.immuneState === immune_system_state.removed) return\r\n    if(this.immuneState === immune_system_state.deceased){\r\n      this.immuneSystem.update(diff)\r\n      return\r\n    }\r\n    let walk_dir = new vec2()\r\n\r\n    for(let idx=0; idx < rules.length; idx ++){\r\n      let rule = rules[idx]\r\n\r\n      // get the corresponding parameter :)\r\n      let rule_dir = rule.executeRule(this, entities, distanceMatrix)\r\n      rule_dir = rule.weightRule(rule_dir, this)\r\n      walk_dir = walk_dir.add(rule_dir)\r\n    }\r\n    let walk_acc = walk_dir.norm().scl(this.acceleration.getValue() * diff/1000)\r\n    this.velocity = this.velocity.add(walk_acc)\r\n    this.velocity = limit_vec_len(this.velocity, this.speed.getValue())\r\n\r\n    let new_position = this.position.add(this.velocity.scl(diff/1000))\r\n    // console.log(new_position.sub(this.position).len())\r\n\r\n    this.position = this._resolveCollisions(new_position, walk_dir, entities)\r\n\r\n    this.immuneSystem.update(diff)\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    this.immuneSystem.inVirusVicinity()\r\n  }\r\n\r\n  setImmuneSystemState(state: immune_system_state){\r\n    this.immuneSystem.state = state\r\n  }\r\n\r\n  // TODO move this to the engine :)\r\n  _resolveCollisions(newpos: vec2, walk_dir: vec2, entities:boid[]): vec2{\r\n    // could be sped up by only checking entities which were in the neighborhood before via max_walk_dist & distanceMatrix\r\n\r\n    let nEntities = entities.length\r\n\r\n    for(let i=0; i<nEntities; i++){\r\n      let entity = entities[i]\r\n      if(entity === this) continue\r\n      let dvec = entities[i].position.sub(newpos)\r\n      let len = dvec.len()\r\n\r\n      let mindist = this.size/2 + entities[i].size/2\r\n      if(len < mindist){\r\n        let resolve_vector = dvec.norm().scl(mindist - len)\r\n        // entities[i].position = entities[i].position.add(dvec.scl(0.25))\r\n        newpos = newpos.sub(resolve_vector)\r\n      }\r\n    }\r\n\r\n    return newpos\r\n  }\r\n\r\n  get size(): number{\r\n    return this._size.getValue(this.id)\r\n  }\r\n\r\n  get immuneState(){\r\n    return this.immuneSystem.state\r\n  }\r\n\r\n  set onImmuneSystemStateUpdated(callback: any){\r\n    this.immuneSystem.onStateUpdated = callback\r\n  }\r\n\r\n}\r\n\r\n/*\r\n\r\n\r\nsize: vec2\r\nbound_size: vec2\r\n_hbs: vec2\r\nentities: pandaEntity[]\r\n\r\nconstructor(ctx: CanvasRenderingContext2D, n: number){\r\n\r\n\r\n  this.ctx = ctx\r\n*/\r\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport class ParameterControl {\r\n  controller: ParameterController\r\n  controlledParameter: parameter\r\n\r\n  minElement: HTMLInputElement|null = null\r\n  maxElement: HTMLInputElement|null = null\r\n  valueSlider: HTMLInputElement|null = null\r\n\r\n  constructor(controller: ParameterController, param: parameter){\r\n    this.controller = controller\r\n    this.controlledParameter = param\r\n    this.createUIElement()\r\n    this.loadFromLocalStorage()\r\n    this.attachListeners()\r\n  }\r\n\r\n  createUIElement(){\r\n    let listElem = document.createElement('li');\r\n    listElem.className = ''\r\n\r\n    let param_name = document.createElement('div')\r\n    param_name.className = 'param_name | no_select'\r\n    param_name.innerText = this.controlledParameter.name\r\n    listElem.appendChild(param_name)\r\n\r\n    let param_ctrl = document.createElement('div')\r\n    param_ctrl.className = 'param_options | no_select'\r\n    //param_ctrl.innerText = this.controlledParameter.name + '\\n'\r\n\r\n    // Help tooltip:\r\n    if(this.controlledParameter.help){\r\n      param_name.className = 'param_name | no_select | has_help'\r\n      param_name.innerHTML = `${this.controlledParameter.name}<p>${this.controlledParameter.help}</p>`\r\n    }\r\n\r\n    if(this.controlledParameter.type === parameter_type.entity_scoped ||\r\n       this.controlledParameter.type === parameter_type.universal){\r\n\r\n         let label_min: HTMLLabelElement = document.createElement('label')\r\n         label_min.htmlFor = `${this.controlledParameter.name}_min`\r\n         label_min.innerText = 'min:'\r\n         let input_min: HTMLInputElement = document.createElement('input')\r\n         input_min.name = `${this.controlledParameter.name}_min`\r\n         input_min.type = 'number'\r\n         input_min.value = this.controlledParameter.min + ''\r\n\r\n         let br_el = document.createElement('br')\r\n\r\n         let label_max: HTMLLabelElement = document.createElement('label')\r\n         label_max.htmlFor = `${this.controlledParameter.name}_max`\r\n         label_max.innerText = 'max:'\r\n         let input_max: HTMLInputElement = document.createElement('input')\r\n         input_max.name = `${this.controlledParameter.name}_max`\r\n         input_max.type = 'number'\r\n         input_max.value = this.controlledParameter.max + ''\r\n\r\n         this.minElement = input_min\r\n         this.maxElement = input_max\r\n\r\n         param_ctrl.appendChild(label_min)\r\n         param_ctrl.appendChild(input_min)\r\n         param_ctrl.appendChild(br_el)\r\n         param_ctrl.appendChild(label_max)\r\n         param_ctrl.appendChild(input_max)\r\n    }\r\n    listElem.appendChild(param_ctrl)\r\n\r\n    if(this.controlledParameter.type === parameter_type.universal ||\r\n       this.controlledParameter.type === parameter_type.universal_percentage){\r\n      let param_setpoint = document.createElement('div')\r\n      param_setpoint.className = 'param_setpoint'\r\n\r\n      let param_slider: HTMLInputElement = document.createElement('input')\r\n      param_slider.type = 'range'\r\n      param_slider.min = '0'\r\n      param_slider.max = '1000'\r\n      param_slider.value = '500'\r\n\r\n      param_setpoint.appendChild(param_slider)\r\n\r\n      listElem.appendChild(param_setpoint)\r\n      this.valueSlider = param_slider\r\n    }\r\n    this.controller.addUIElement(listElem)\r\n  }\r\n\r\n  loadFromLocalStorage(){\r\n    let item = localStorage.getItem(this.controlledParameter.name)\r\n    if(!item) return;\r\n\r\n    let param = JSON.parse(item)\r\n\r\n    //update the parameter\r\n    this.controlledParameter.setMin(param.min)\r\n    this.controlledParameter.setMax(param.max)\r\n    this.controlledParameter.setValue(param.value)\r\n\r\n\r\n    //resync the UI\r\n    if(this.minElement){\r\n      this.minElement.value = param.min + ''\r\n    }\r\n\r\n    if(this.maxElement){\r\n      this.maxElement.value = param.max + ''\r\n    }\r\n\r\n    if(this.valueSlider){\r\n      this.valueSlider.value = '' + 1000*param.value/(param.max - param.min)\r\n    }\r\n  }\r\n\r\n  saveParameterLocally(){\r\n    localStorage.setItem(this.controlledParameter.name, JSON.stringify(this.controlledParameter));\r\n  }\r\n\r\n  attachListeners(){\r\n    if(this.minElement){\r\n      let _el: HTMLInputElement = this.minElement\r\n      this.minElement.onchange = () => {\r\n        this.controlledParameter.setMin(parseInt(_el.value))\r\n        this.saveParameterLocally()\r\n      }\r\n      this.saveParameterLocally()\r\n    }\r\n\r\n    if(this.maxElement){\r\n      let _el: HTMLInputElement = this.maxElement\r\n      this.maxElement.onchange = () => {\r\n        this.controlledParameter.setMax(parseInt(_el.value))\r\n        this.saveParameterLocally()\r\n      }\r\n\r\n    }\r\n\r\n    if(this.valueSlider){\r\n      let _el: HTMLInputElement = this.valueSlider\r\n      this.valueSlider.onchange = () => {\r\n        let val: number = parseInt(_el.value)/1000.0\r\n        val *= this.controlledParameter.max - this.controlledParameter.min\r\n        val += this.controlledParameter.min\r\n        this.controlledParameter.setValue(val)\r\n        this.saveParameterLocally()\r\n       }\r\n    }\r\n  }\r\n}\r\n\r\nexport class ParameterController {\r\n  parameter_container: HTMLElement\r\n  controlElements: ParameterControl[]\r\n\r\n  constructor(container: HTMLElement){\r\n    this.parameter_container = container\r\n    parameter.emitter.on('paramAdded', this.parameterAddHandler.bind(this))\r\n\r\n    this.controlElements = []\r\n  }\r\n\r\n  parameterAddHandler(param: parameter){\r\n    let _ctrl = new ParameterControl(this, param)\r\n    this.controlElements.push(_ctrl)\r\n  }\r\n\r\n  addUIElement(element: HTMLElement){\r\n    this.parameter_container.appendChild(element)\r\n  }\r\n\r\n}\r\n"],"sourceRoot":""}