{"version":3,"sources":["webpack://pandaemic_lib/webpack/bootstrap","webpack://pandaemic_lib/./src/utils.ts","webpack://pandaemic_lib/(webpack)/buildin/global.js","webpack://pandaemic_lib/./node_modules/events/events.js","webpack://pandaemic_lib/./src/boidRules.ts","webpack://pandaemic_lib/./src/pandemic.ts","webpack://pandaemic_lib/./src/grapher.ts","webpack://pandaemic_lib/./src/index.ts","webpack://pandaemic_lib/./src/boids.ts","webpack://pandaemic_lib/./node_modules/timers-browserify/main.js","webpack://pandaemic_lib/./node_modules/setimmediate/setImmediate.js","webpack://pandaemic_lib/./node_modules/process/browser.js","webpack://pandaemic_lib/./src/parametercontrol.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","vec2","x","y","sub","this","add","scl","len","Math","sqrt","norm","fn","a","min","v","max","dot","rect","pos","size","position","center","isInside","point","insideX","insideY","parameter_type","parameter","type","nparam","dependecies","universal_percentage","getParameterByName","_values","entity_scoped","registerDependency","_updateHandler","getValue","push","_randomValue","paramList","emitter","emit","param","length","diff","abs","pop","_updateValues","_i","_a","cb","setImmediate","rnd","random","callback","valueOf","id","universal","setValue","val","setMin","setMax","getParametersByName","params","getParameterByNameOrCreate","_param","getParameters","EventEmitter","ruler","checkLength","str","fontStyle","element","_getElement","style","font","innerHTML","offsetWidth","checkHeight","offsetHeight","document","createElement","body","appendChild","visibility","whiteSpace","g","Function","e","window","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","init","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","prepend","events","existing","warning","newListener","unshift","warned","w","Error","String","count","console","warn","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","listeners","addListener","on","prependListener","once","prependOnceListener","list","originalListener","shift","index","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","distanceAccelerator","entities","distMatrix","tmp","ii","dvec","dist","vec","extendStatics","__extends","b","setPrototypeOf","__proto__","__","constructor","distanceElement","boidRule","ruleName","log","executeRule","entity","distanceMatrix","weightRule","dir","weightParamNormal","weightParamSick","weightParam","immuneState","sickness_state","sick","socialRule","_super","_this","view_distance","entity_size","nEntities","viewDistance","rule_dir","_entity","randomRule","avoidanceRule","avoidance_distance","avoidanceDistance","sicknessRule","infection_distance","infecting","infection","incubating","infectionDistance","inVirusVicinity","sickness","mortality_rate","infection_rate","incubation_time","healing_time","immune_time","_state","healthy","timer","makeSick","deceased","newstate","onStateUpdated","configurable","update","cured","infectable","graphedVariable","color","values","variableList","appendValue","resetData","event","getGraphVariableByName","vars","variable","getGraphVariableByNameOrCreate","_var","getGraphedVariables","grapher","ctx","sizeChanged","margin","varNamesWidthPx","fontSizePt","colorDotSizePx","varNameSizePx","legendSize","legendMarkerHeight","nRows","dataChanged","updateIntervalID","minVal","maxVal","boundsChanged","width","canvas","height","varUpdatedListener","varAddedListener","stepSize","rowSize","yScale","xScale","startUpdateInterval","redrawLegend","addEventListener","setTimeout","resizeEvent","_updateLengendSizing","fontsize_px","toFixed","maxSizePx","nameSizePx","newval","interval","clearInterval","setInterval","clearRect","plotAllGraphVariables","fillStyle","idx","offset","y_1","fillText","beginPath","arc","PI","fill","strokeStyle","scale","moveTo","lineTo","stroke","translate","variables_1","gv","plotData","data","dataSet","sections","reset","boids","rules","initCanvas","canvasElement","container","canvasContext","getContext","resizeHandler","h","clientHeight","clientWidth","onload","param_container","getElementById","app_window","maxHeight","getBoundingClientRect","ParameterController","_initParameterController","be","gr","grapherCanvasElement","_initGrapher","options","boidEngineConfig","maxEntities","maxEntitySize","minEntitySize","fps","boidEngine","randr","addRule","socr","avr","sickr","infectOne","_initPandaemicApplication","btnRestart","onclick","restart","_initControls","scrollTo","continuum","boidRuleConfig","entitiesToBeRemoved","resetInNext","renderIntervalID","updateInterval","_parameterUpdateHandler","eps","entitiesToInfect","bound_size","_hbs","_initBoids","frametime","startRenderInterval","gv_EntitiesAlive","gv_EntitiesInfected","gv_EntitiesSick","gv_EntitesImmune","gv_EntitiesDead","floor","setImmuneSystemState","boidStateUpdateHandler","_generateNewBoid","_x","_y","_pos","_ent","boid","onImmuneSystemStateUpdated","_render","stopRenderInterval","_update","stopUpdateInterval","_rule","clearRules","lineWidth","_updateGraphData","nEntitesMax","nAlive","nInfected","nSick","nImmune","nDead","ent","splice","indexOf","_b","_c","_d","_e","velocity","_size","acceleration","speed","walk_dir","rule","walk_acc","limit","limit_vec_len","new_position","_resolveCollisions","newpos","mindist","resolve_vector","self","Timeout","clearFn","_id","_clearFn","scope","clearTimeout","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","global","clearImmediate","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","attachTo","toString","process","handle","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","port2","documentElement","script","onreadystatechange","removeChild","source","slice","attachEvent","task","run","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","binding","cwd","chdir","umask","ParameterControl","controller","minElement","maxElement","valueSlider","controlledParameter","createUIElement","attachListeners","listElem","className","param_ctrl","innerText","label_min","htmlFor","input_min","br_el","label_max","input_max","param_setpoint","param_slider","addUIElement","_el_1","onchange","parseInt","_el_2","_el_3","parameter_container","parameterAddHandler","controlElements","_ctrl"],"mappings":"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","file":"pandaemic.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","import { EventEmitter } from 'events'\r\n\r\nexport class vec2 {\r\n  x: number\r\n  y: number\r\n\r\n  constructor(x:number|null = 0, y:number|null = 0){\r\n    x = x || 0\r\n    y = y || 0\r\n\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  sub(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x - x.x, this.y - x.y)\r\n    }\r\n\r\n    y = y || x\r\n\r\n    return new vec2(this.x - x, this.y - y)\r\n  }\r\n\r\n  add(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x + x.x, this.y + x.y)\r\n    }\r\n\r\n    return new vec2(this.x + x, this.y + y)\r\n  }\r\n\r\n  scl(s:number|vec2 = 0): vec2{\r\n    if(typeof s === 'object'){\r\n      return new vec2(this.x*s.x, this.y*s.y)\r\n    }\r\n\r\n    return new vec2(this.x*s, this.y*s)\r\n  }\r\n\r\n  len():number{\r\n    return Math.sqrt(this.x*this.x + this.y*this.y)\r\n  }\r\n\r\n  norm():vec2{\r\n    let l = this.len()\r\n    if(l === 0) return new vec2(0, 0)\r\n    return new vec2(this.x/l, this.y/l)\r\n  }\r\n\r\n  fn(a:any):vec2{\r\n    return new vec2(a(this.x), a(this.y))\r\n  }\r\n\r\n  min(v: vec2){\r\n    return new vec2(Math.min(this.x, v.x), Math.min(this.x, v.y))\r\n  }\r\n\r\n  max(v: vec2){\r\n    return new vec2(Math.max(this.x, v.x), Math.max(this.x, v.y))\r\n  }\r\n\r\n  dot(v: vec2){\r\n    return this.x*v.x + this.y*v.y\r\n  }\r\n\r\n}\r\n\r\nexport class rect {\r\n  size: vec2\r\n  position: vec2\r\n\r\n  center: vec2\r\n\r\n  constructor(pos: vec2, size: vec2){\r\n    this.position = pos\r\n    this.size = size\r\n\r\n    this.center = this.position.add(this.size).scl(1/2)\r\n  }\r\n\r\n  isInside(point: vec2){\r\n    let insideX = (point.x > this.position.x) && (point.x < (this.position.x + this.size.x))\r\n    let insideY = (point.y > this.position.y) && (point.y < (this.position.y + this.size.y))\r\n    return insideX && insideY\r\n  }\r\n\r\n\r\n}\r\n\r\nexport enum parameter_type {\r\n  universal,\r\n  entity_scoped,\r\n  universal_percentage\r\n}\r\n\r\nexport class parameter {\r\n  static paramList: parameter[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  min: number\r\n  max: number\r\n  type: parameter_type\r\n  name: string\r\n\r\n  value: number\r\n  _values: number[]\r\n\r\n  dependecies: any[] = []\r\n\r\n  n: parameter|null\r\n\r\n  constructor(min: number, max:number, type: parameter_type, name: string = 'none', nparam: parameter|null = null){\r\n    if(type === parameter_type.universal_percentage){\r\n      // ignore min / max assignment\r\n      this.min = 0\r\n      this.max = 1\r\n    } else {\r\n      this.min = Math.min(min, max)\r\n      this.max = Math.max(min, max)\r\n    }\r\n\r\n    this.type = type\r\n    this.name = name\r\n\r\n    this.n = nparam || parameter.getParameterByName('nEntities')\r\n\r\n    this.value = (this.max - this.min)/2 + this.min\r\n    this._values = []\r\n    if(this.type === parameter_type.entity_scoped){\r\n      if(this.n){\r\n        this.n.registerDependency(this._updateHandler.bind(this))\r\n        for(let i=0; i<this.n.getValue(); i++){\r\n          this._values.push(this._randomValue())\r\n        }\r\n      }\r\n    }\r\n\r\n    parameter.paramList.push(this)\r\n    // console.log(parameter.paramList)\r\n    parameter.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  _updateHandler(param: parameter|null = null){\r\n    if(param && param.name === 'nEntities'){\r\n      let n = this._values.length\r\n      let diff = param.getValue() - n\r\n      for(let i=0; i<Math.abs(diff); i++) (diff>0)? this._values.push(0) : this._values.pop()\r\n    }\r\n\r\n    //update all values\r\n    this._updateValues()\r\n\r\n    // pass change event onto dependencies :)\r\n    for(let cb of this.dependecies){\r\n      setImmediate(cb, this)\r\n    }\r\n  }\r\n\r\n  _randomValue(): number{\r\n    let rnd:number = Math.random()\r\n    let val:number = (this.max - this.min)*rnd + this.min\r\n    return val\r\n  }\r\n\r\n  _updateValues(){\r\n    if(this.n){\r\n      for(let i=0; i<this.n.getValue(); i++){\r\n        this._values[i] = this._randomValue()\r\n      }\r\n    }\r\n  }\r\n\r\n  registerDependency(callback: any){\r\n    this.dependecies.push(callback)\r\n  }\r\n\r\n  valueOf(): number{\r\n    return 10\r\n  }\r\n\r\n  getValue(id: number = 0): number {\r\n    switch(this.type){\r\n      case parameter_type.universal:\r\n      case parameter_type.universal_percentage:\r\n        return this.value\r\n      case parameter_type.entity_scoped:\r\n        if(id < 0) id = 0\r\n        if(id >= this._values.length) id = this._values.length-1\r\n        return this._values[id]\r\n    }\r\n    return 0\r\n  }\r\n\r\n  setValue(val: number){\r\n    if(val > this.max) val = this.max\r\n    if(val < this.min) val = this.min\r\n    this.value = val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMin(val: number){\r\n    this.min = (this.type === parameter_type.universal_percentage)? 0 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMax(val: number){\r\n    this.max = (this.type === parameter_type.universal_percentage)? 1 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n\r\n\r\n\r\n  static getParametersByName(name: string){\r\n    let params:parameter[] = []\r\n    for(let param of parameter.paramList){\r\n      if(param.name === name) params.push(param)\r\n    }\r\n    return params\r\n  }\r\n\r\n  static getParameterByName(name: string): parameter|null{\r\n    return this.getParametersByName(name)[0]\r\n  }\r\n\r\n  static getParameterByNameOrCreate(name: string, type:parameter_type=parameter_type.entity_scoped, min:number=0, max:number= 1): parameter{\r\n    let _param = this.getParametersByName(name)[0]\r\n    if(!_param){\r\n      _param = new parameter(min, max, type, name)\r\n    }\r\n\r\n    return _param\r\n  }\r\n\r\n  static getParameters(){\r\n    return parameter.paramList\r\n  }\r\n\r\n}\r\n\r\nexport class ruler {\r\n  static element: HTMLElement|null\r\n  static checkLength(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetWidth\r\n  }\r\n\r\n  static checkHeight(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetHeight\r\n  }\r\n\r\n  static _getElement(){\r\n    // document.write('<span id=\"ruler\"></span>')\r\n    ruler.element = document.createElement('span') as HTMLElement\r\n    document.body.appendChild(ruler.element)\r\n    ruler.element.style.visibility = 'hidden'\r\n    ruler.element.style.whiteSpace = 'nowrap'\r\n  }\r\n}\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","import { boid } from './boids'\r\nimport { vec2, rect, parameter, parameter_type } from './utils'\r\nimport { sickness, sickness_state } from './pandemic'\r\n\r\nexport class distanceElement{\r\n  dist: number = 0\r\n  vec: vec2 = new vec2()\r\n}\r\n\r\nexport function distanceAccelerator(entities: boid[]): distanceElement[][]{\r\n  let n = entities.length\r\n  let distMatrix: distanceElement [][] = []\r\n\r\n\r\n  let tmp: distanceElement[] = []\r\n  for(let i=0; i<n; i++){\r\n    tmp = []\r\n    // for(let ii=0; ii<n; ii++){\r\n    //   tmp.push({dist: 0, vec: new vec2()})\r\n    // }\r\n    distMatrix.push(tmp)\r\n  }\r\n\r\n  for(let i=0; i<n; i++){\r\n    for(let ii=i; ii<n; ii++){\r\n      let dvec = entities[i].position.sub(entities[ii].position)\r\n      let dist = dvec.len()\r\n      distMatrix[i][ii] = {dist:dist, vec: dvec}\r\n      distMatrix[ii][i] = {dist:dist, vec: dvec.scl(-1)}\r\n    }\r\n  }\r\n  return distMatrix\r\n}\r\n\r\nexport class boidRule {\r\n  ruleName: string;\r\n\r\n  constructor(name:string){\r\n    this.ruleName = name;\r\n    console.log('Constructed new rule w/ name:', name)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2{\r\n    console.log('Excuting base rule :)')\r\n    return new vec2()\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    let weightParamNormal = parameter.getParameterByNameOrCreate(`${this.ruleName} weight`)\r\n    let weightParamSick = parameter.getParameterByNameOrCreate(`${this.ruleName} weight (sick)`)\r\n\r\n    let weightParam = (entity.immuneState === sickness_state.sick)? weightParamSick : weightParamNormal\r\n    return dir.scl(weightParam.getValue(entity.id))\r\n  }\r\n\r\n}\r\n\r\nexport class socialRule extends boidRule{\r\n\r\n  view_distance: parameter\r\n  entity_size: parameter\r\n\r\n  constructor(){\r\n    super('SocialRule')\r\n    this.view_distance = parameter.getParameterByNameOrCreate('View Distance', parameter_type.universal, 10, 30)\r\n    this.entity_size = parameter.getParameterByNameOrCreate('EntitySize', parameter_type.universal, 4, 8)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities = distanceMatrix.length\r\n    let viewDistance = this.view_distance.getValue()\r\n\r\n    let rule_dir = new vec2()\r\n    for(let i:number=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = entity.position.sub(_entity.position)\r\n      if(dist.len() < viewDistance){\r\n        // if(dist <= this.entity_size.getValue(id)*1.2) continue\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 1/e))\r\n      }\r\n    }\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\nexport class randomRule extends boidRule{\r\n\r\n  constructor(){\r\n    super('randomRule')\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let x = (Math.random() - 0.5) * 2\r\n    let y = (Math.random() - 0.5) * 2\r\n\r\n    let rule_dir = new vec2(x, y)\r\n    return rule_dir.norm()\r\n}\r\n\r\n}\r\n\r\nexport class avoidanceRule extends boidRule{\r\n  avoidance_distance: parameter;\r\n\r\n\r\n  constructor(){\r\n    super('avoidanceRule')\r\n\r\n    this.avoidance_distance = parameter.getParameterByNameOrCreate('Avoidance Distance', parameter_type.universal, 10, 30)\r\n\r\n  }\r\n\r\n  executeRule(entity:boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let avoidanceDistance = this.avoidance_distance.getValue()\r\n\r\n    let rule_dir: vec2 = new vec2()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = _entity.position.sub(entity.position)\r\n      if(dist.len() < avoidanceDistance){\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 100 * 1/e))\r\n      }\r\n    }\r\n\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\n/*\r\nThis rule does not return a distance, but abuses the rule interface to handle infections...\r\n*/\r\nexport class sicknessRule extends boidRule{\r\n  infection_distance: parameter;\r\n\r\n  constructor(){\r\n    super('sicknessRule')\r\n    this.infection_distance = parameter.getParameterByNameOrCreate('Infection Distance', parameter_type.universal, 10, 15)\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    return dir;\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let infecting = entity.infection.state === sickness_state.incubating || entity.infection.state === sickness_state.sick\r\n\r\n    let infectionDistance = this.infection_distance.getValue()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = entity.position.sub(_entity.position)\r\n\r\n      // let distEl: distanceElement = distanceMatrix[id][i]\r\n      if(dist.len() < infectionDistance && infecting){\r\n        // possibly infect the other boid...\r\n        let otherEntity = entities[i]\r\n        otherEntity.inVirusVicinity()\r\n      }\r\n    }\r\n\r\n    return new vec2()\r\n  }\r\n\r\n}\r\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport enum sickness_state {\r\n  healthy,\r\n  incubating,\r\n  sick,\r\n  deceased,\r\n  cured\r\n}\r\n\r\nexport class sickness {\r\n  mortality_rate: parameter\r\n  infection_rate: parameter\r\n  incubation_time: parameter\r\n  healing_time: parameter\r\n  immune_time: parameter\r\n\r\n  _state: sickness_state\r\n  timer: number;\r\n\r\n  onStateUpdated: any|null;\r\n\r\n  constructor(){\r\n    this.mortality_rate = parameter.getParameterByNameOrCreate('Mortality Rate', parameter_type.universal_percentage)\r\n    this.infection_rate = parameter.getParameterByNameOrCreate('Infection Rate', parameter_type.universal_percentage)\r\n    this.incubation_time = parameter.getParameterByNameOrCreate('Incubation Time', parameter_type.universal, 0, 100)\r\n    this.healing_time = parameter.getParameterByNameOrCreate('Healing Time', parameter_type.universal, 0, 100)\r\n    this.immune_time = parameter.getParameterByNameOrCreate('Immune Time', parameter_type.universal, 0, 100)\r\n\r\n    this._state = sickness_state.healthy\r\n    this.timer = 0\r\n  }\r\n\r\n  makeSick(){\r\n    if(this.state !== sickness_state.deceased){\r\n      this.state = sickness_state.sick;\r\n    }\r\n  }\r\n\r\n  set state(newstate: sickness_state){\r\n    this._state = newstate\r\n    if(this.onStateUpdated) this.onStateUpdated(this._state)\r\n  }\r\n\r\n  get state(){\r\n    return this._state\r\n  }\r\n\r\n  update(diff: number){\r\n    switch(this.state){\r\n      case sickness_state.healthy:\r\n        // do nothing :)\r\n      break;\r\n      case sickness_state.incubating:\r\n        this.timer += diff\r\n        if(this.timer > this.incubation_time.getValue()*1000){\r\n          this.state = sickness_state.sick\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case sickness_state.sick:\r\n        this.timer += diff\r\n        if(this.timer > this.healing_time.getValue()*1000){\r\n          let rnd = Math.random()\r\n          if(rnd > this.mortality_rate.getValue()){\r\n            this.state = sickness_state.healthy\r\n          }else{\r\n            this.state = sickness_state.deceased\r\n          }\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case sickness_state.deceased:\r\n        // can't do anything :)\r\n      break;\r\n      case sickness_state.cured:\r\n        this.timer += diff\r\n        if(this.timer > this.immune_time.getValue()*1000){\r\n          this.state = sickness_state.healthy\r\n          this.timer = 0\r\n        }\r\n      break;\r\n    }\r\n  }\r\n\r\n  get infectable() {\r\n    return this._state === sickness_state.healthy\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    if(!this.infectable) return\r\n    let _rnd = Math.random()\r\n    if(_rnd <= this.infection_rate.getValue()){\r\n      this.state = sickness_state.incubating\r\n    }\r\n  }\r\n\r\n\r\n\r\n}\r\n","import { vec2, ruler } from './utils'\r\nimport { EventEmitter } from 'events'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class graphedVariable {\r\n  static variableList: graphedVariable[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  name: string\r\n  color: string\r\n\r\n  values: number[]\r\n  n: number\r\n\r\n  constructor(name: string = 'none', color: string = '#000'){\r\n    this.name = name\r\n    this.color = color\r\n\r\n    this.n = 0\r\n    this.values = []\r\n\r\n    graphedVariable.variableList.push(this)\r\n    // console.log(parameter.paramList)\r\n    graphedVariable.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  appendValue(val: number){\r\n    this.values.push(val)\r\n    graphedVariable.emitter.emit('variableUpdated', val, this)\r\n  }\r\n\r\n  get data(){\r\n    // TODO add preprocessing?\r\n    return this.values\r\n  }\r\n\r\n  resetData(){\r\n    this.n = 0\r\n    this.values = []\r\n  }\r\n\r\n  static on(event: string, callback: any){\r\n    graphedVariable.emitter.on(event, callback)\r\n  }\r\n\r\n  static getGraphVariableByName(name: string): graphedVariable|null{\r\n    let vars: graphedVariable[] = []\r\n    for(let variable of graphedVariable.variableList){\r\n      if(variable.name === name) vars.push(variable)\r\n    }\r\n\r\n    if(vars.length === 0) return null\r\n    return vars[0]\r\n  }\r\n\r\n  static getGraphVariableByNameOrCreate(name: string, color: string): graphedVariable{\r\n    let _var = this.getGraphVariableByName(name)\r\n    if(!_var){\r\n      _var = new graphedVariable(name, color)\r\n    }\r\n    return _var\r\n  }\r\n\r\n  static getGraphedVariables(){\r\n    return graphedVariable.variableList\r\n  }\r\n\r\n}\r\n\r\n\r\nexport class grapher{\r\n  values: number[][]\r\n  ctx: CanvasRenderingContext2D\r\n  size: vec2\r\n  sizeChanged: boolean = false\r\n\r\n  maxVal: number\r\n  minVal: number\r\n  boundsChanged: boolean\r\n\r\n  xScale: number\r\n  yScale: number\r\n  stepSize: number\r\n  margin: number = 10\r\n  rowSize: number\r\n\r\n  varNamesWidthPx: number = 0\r\n  fontSizePt: number = 10\r\n  colorDotSizePx: number = 4\r\n  varNameSizePx: number = 25\r\n\r\n  legendSize: number = 50\r\n  legendMarkerHeight: number = 0\r\n  nRows = 4\r\n\r\n  dataChanged: boolean = true\r\n\r\n  updateIntervalID: timerHandle|null = null\r\n\r\n  constructor(ctx: CanvasRenderingContext2D){\r\n    this.values = []\r\n    this.ctx = ctx\r\n\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.boundsChanged = true\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    graphedVariable.on('variableUpdated', this.varUpdatedListener.bind(this))\r\n    graphedVariable.on('paramAdded', this.varAddedListener.bind(this))\r\n\r\n    // set these values for your data\r\n    let sections = 12;\r\n    this.stepSize = 40;\r\n    this.rowSize = 50;\r\n\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.xScale = (this.size.x - this.rowSize) / sections;\r\n\r\n    this.startUpdateInterval(100)\r\n\r\n    this.redrawLegend()\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.sizeChanged = true\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  _updateLengendSizing(){\r\n\r\n    let fontsize_px = this.size.y / 13\r\n    this.fontSizePt = fontsize_px*0.75\r\n    let fontStyle = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n\r\n    this.varNameSizePx = fontsize_px * 1.5\r\n    this.colorDotSizePx = Math.min(4, this.varNameSizePx/3)\r\n\r\n\r\n    let maxSizePx = 0\r\n    for (let _var of graphedVariable.variableList){\r\n      let nameSizePx = ruler.checkLength(_var.name + 'aa', fontStyle)\r\n      maxSizePx = Math.max(maxSizePx, nameSizePx)\r\n      // console.log(_var.name + '=>' + nameSizePx)\r\n    }\r\n    this.varNamesWidthPx = maxSizePx + 2*this.colorDotSizePx\r\n\r\n    this.legendSize = 2 * ruler.checkLength(this.maxVal.toFixed(1), fontStyle)\r\n    this.legendMarkerHeight = ruler.checkHeight(this.maxVal.toFixed(1), fontStyle)\r\n\r\n    this.yScale = (this.size.y - 2*this.margin - this.legendMarkerHeight) / (this.maxVal - this.minVal)\r\n  }\r\n\r\n  varAddedListener(_var: graphedVariable){\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  varUpdatedListener(newval: number, _var: any): void {\r\n    if(newval < this.minVal){\r\n      this.minVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    if(newval > this.maxVal){\r\n      this.maxVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    this.dataChanged = true\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this.update.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  update(){\r\n    if(!this.dataChanged) return\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    if(this.boundsChanged){\r\n      this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n      // this.xScale = (this.size.x - this.rowSize) / sections;\r\n      this.boundsChanged = false\r\n    }\r\n\r\n    this.redrawLegend()\r\n    this.plotAllGraphVariables()\r\n    // console.log(this)\r\n    this.dataChanged = false\r\n  }\r\n\r\n  redrawLegend(){\r\n    this.ctx.fillStyle = \"#997f89\"\r\n    this.ctx.font = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n    // this.ctx.font = '10pt Oswald'\r\n\r\n    let idx = 0\r\n    let offset = this.size.y - graphedVariable.getGraphedVariables().length * this.varNameSizePx\r\n    offset = (offset / 2) + this.margin/2\r\n    for (let _var of graphedVariable.variableList){\r\n      this.ctx.fillStyle = _var.color\r\n      // this.ctx.fillText(_var.name, this.margin, 20);\r\n      this.ctx.fillStyle = '#292c2e'\r\n      let y = offset + idx*this.varNameSizePx\r\n      this.ctx.fillText(_var.name, this.margin + this.legendSize, y);\r\n      this.ctx.fillStyle = _var.color\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(this.margin - 8 + this.legendSize,  y - 4, this.colorDotSizePx, 0, 2 * Math.PI, false);\r\n      this.ctx.fill()\r\n      idx ++\r\n    }\r\n\r\n    let stepSize = (this.maxVal - this.minVal) / this.nRows\r\n    // print row header and draw horizontal grid lines\r\n    var count =  0;\r\n    this.ctx.strokeStyle=\"#997f89\"; // color of grid lines\r\n    for (let scale=this.maxVal; scale>=this.minVal; scale = scale - stepSize) {\r\n      var y = this.margin + (this.yScale * count * stepSize);\r\n\r\n      this.ctx.fillText(scale.toFixed(1), this.margin, y + this.margin/2);\r\n      this.ctx.moveTo(this.legendSize + this.varNamesWidthPx ,y)\r\n      this.ctx.lineTo(this.size.x - this.margin,y)\r\n      count++;\r\n    }\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  plotAllGraphVariables(){\r\n    this.ctx.translate(this.legendSize, 0);\r\n    let variables = graphedVariable.getGraphedVariables()\r\n    for(let gv of variables){\r\n      this.ctx.strokeStyle = gv.color\r\n      this.plotData(gv.data)\r\n    }\r\n    this.ctx.translate(-this.legendSize, 0);\r\n  }\r\n\r\n  plotData(dataSet: number[]) {\r\n    let sections = dataSet.length\r\n    // let rowsize = this.size.x / sections\r\n    let xScale = this.size.x / sections;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.yScale * (this.maxVal - dataSet[0]) + this.margin);\r\n    for (let i=1;i<sections;i++) {\r\n      this.ctx.lineTo(i * xScale, this.yScale * (this.maxVal - dataSet[i]) + this.margin);\r\n    }\r\n    this.ctx.stroke();\r\n    }\r\n\r\n  reset(){\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n  }\r\n}\r\n","import * as boids from \"./boids\";\nimport * as rules from \"./boidRules\"\nimport { vec2, rect, parameter, parameter_type } from './utils'\nimport { ParameterController } from './parametercontrol'\nimport { grapher } from './grapher'\n\n\n\nlet initCanvas = (canvasElement: HTMLCanvasElement, container: HTMLElement) => {\n  let canvasContext: CanvasRenderingContext2D|null = canvasElement.getContext('2d');\n\n  let resizeHandler = () => {\n    let h = canvasElement.clientHeight\n    canvasElement.height = h\n    let w = canvasElement.clientWidth\n    canvasElement.width = w\n    if(canvasContext){\n      canvasContext.canvas.width  = w;\n      canvasContext.canvas.height = h;\n    }\n\n  }\n\n  window.addEventListener('resize', resizeHandler);\n\n  resizeHandler()\n\n  return canvasContext\n}\n\nlet _initPandaemicApplication = (canvas: HTMLCanvasElement) => {\n  let container: HTMLElement|null = document.getElementById('be_canvas_container')\n  if(!container) return\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n\n  let options = new boids.boidEngineConfig()\n  options.maxEntities = 200\n  options.maxEntitySize = 8\n  options.minEntitySize = 8\n  options.fps = 25\n\n  let be = new boids.boidEngine(ctx, options)\n\n  let randr = new rules.randomRule()\n  be.addRule(randr)\n\n  let socr = new rules.socialRule();\n  be.addRule(socr)\n\n  let avr = new rules.avoidanceRule()\n  be.addRule(avr)\n\n  let sickr = new rules.sicknessRule()\n  be.addRule(sickr)\n\n  window.infectOne = be.infectOne.bind(be)\n\n  // be.startRenderInterval(100)\n  // setInterval(be.reset.bind(be), 1000)\n  return be\n}\n\nlet _initParameterController = () => {\n  let param_container = document.getElementById('p_container')\n  let app_window = document.getElementById('window')\n\n\n  if(param_container && app_window){\n    param_container.style.maxHeight = 0.95*app_window.getBoundingClientRect().height + 'px';\n    let _ctrl = new ParameterController(param_container)\n  }\n}\n\nlet _initGrapher = (canvas: HTMLCanvasElement) => {\n\n  let container: HTMLElement|null = document.getElementById('graph_canvas_container')\n  if(!container) return\n\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n  let _grapher = new grapher(ctx)\n  return _grapher\n}\n\nlet _initControls = (be: boids.boidEngine, gr: grapher) => {\n  let btnRestart: HTMLElement|null = document.getElementById('btn_restart')\n  if(btnRestart){\n    btnRestart.onclick = () => {\n      if(!btnRestart) return\n      be.restart()\n      gr.reset()\n    }\n  }\n}\n\nlet main = () => {\n\n  _initParameterController()\n\n  let be = null, gr = null\n\n  //get the grapher canvas element\n  let grapherCanvasElement: HTMLCanvasElement|null = document.getElementById('graph_canvas') as HTMLCanvasElement\n  if(grapherCanvasElement) gr = _initGrapher(grapherCanvasElement)\n\n  // get the canvas element\n  let canvasElement: HTMLCanvasElement|null = document.getElementById('canvas') as HTMLCanvasElement\n  if(canvasElement) be = _initPandaemicApplication(canvasElement)\n\n  if(be && gr){\n    _initControls(be, gr)\n  }\n\n  // Mobile scroll test:\n  window.addEventListener(\"load\",() => {\n    setTimeout(() => window.scrollTo(0, 1), 0);\n  });\n\n  /*\n  for(let i=0; i<20; i++){\n    let param = new parameter(0, 1, parameter_type.universal, `rule_${i}`)\n  }\n  */\n\n}\n\nwindow.onload = main\n","import { vec2, rect, parameter, parameter_type } from \"./utils\";\r\nimport { boidRule, distanceAccelerator, distanceElement} from './boidRules'\r\nimport { sickness, sickness_state } from './pandemic'\r\n\r\nimport { graphedVariable } from './grapher'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class boidEngineConfig {\r\n  maxEntities: number = 500;\r\n  minEntitySize: number = 3;\r\n  maxEntitySize: number = 3;\r\n\r\n  fps: number|null = null;\r\n\r\n  continuum: boolean = true;\r\n}\r\n\r\nexport class boidRuleConfig {\r\n\r\n}\r\n\r\nexport class boidEngine {\r\n\r\n  nEntities: parameter\r\n  ctx: CanvasRenderingContext2D\r\n\r\n  size: vec2\r\n  bound_size: vec2\r\n  _hbs: vec2\r\n\r\n  entity_size: parameter\r\n\r\n  entities: boid[]\r\n  entitiesToBeRemoved: boid[] = []\r\n  resetInNext: boolean = false\r\n\r\n  renderIntervalID: timerHandle|null = null\r\n  updateIntervalID: timerHandle|null = null\r\n  updateInterval: number = 0;\r\n\r\n  entitiesToInfect: parameter\r\n\r\n  rules: boidRule[] = []\r\n\r\n  continuum: boolean;\r\n\r\n  // graphed data:\r\n  gv_EntitiesAlive: graphedVariable\r\n  gv_EntitiesInfected: graphedVariable\r\n  gv_EntitiesSick: graphedVariable\r\n  gv_EntitesImmune: graphedVariable\r\n  gv_EntitiesDead: graphedVariable\r\n\r\n  // Initialization\r\n\r\n  constructor(ctx: CanvasRenderingContext2D, options: boidEngineConfig = new boidEngineConfig()){\r\n    this.ctx = ctx\r\n\r\n    this.nEntities = new parameter(10, options.maxEntities, parameter_type.universal, 'nEntities')\r\n    this.nEntities.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    let eps = parameter.getParameterByName('EntitySize')\r\n    this.entity_size = (eps)? eps :  new parameter(options.minEntitySize, options.maxEntitySize, parameter_type.entity_scoped, 'EntitySize')\r\n    this.entity_size.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    this.entitiesToInfect = parameter.getParameterByNameOrCreate('# Infected at Start', parameter_type.universal, 0, 10)\r\n\r\n    this.continuum = options.continuum\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n    this.entities = []\r\n\r\n    this._initBoids()\r\n\r\n    if(options.fps){\r\n      let frametime = 1000/options.fps;\r\n      this.startRenderInterval(frametime)\r\n      this.startUpdateInterval(frametime)\r\n      this.updateInterval = frametime;\r\n    }\r\n    this.gv_EntitiesAlive = graphedVariable.getGraphVariableByNameOrCreate('Entites Alive', '#198c19')\r\n    this.gv_EntitiesInfected = graphedVariable.getGraphVariableByNameOrCreate('Entites Infected' , '#73e500')\r\n    this.gv_EntitiesSick = graphedVariable.getGraphVariableByNameOrCreate('Entites Sick', '#ff4c4c')\r\n    this.gv_EntitesImmune = graphedVariable.getGraphVariableByNameOrCreate('Entites Immune', '#004c00')\r\n    this.gv_EntitiesDead = graphedVariable.getGraphVariableByNameOrCreate('Entities Dead', '#b20000')\r\n\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n  }\r\n\r\n  infectOne(){\r\n    let idx = Math.floor(this.entities.length * Math.random())\r\n    this.entities[idx].setImmuneSystemState(sickness_state.incubating)\r\n  }\r\n\r\n  boidStateUpdateHandler(entity: boid, state: sickness_state){\r\n    // console.log(`boid #${entity.id} state is now: ${state}`)\r\n    if(state === sickness_state.deceased){\r\n      //console.log 'removing boid'\r\n      this.entitiesToBeRemoved.push(entity)\r\n    }\r\n  }\r\n\r\n  _generateNewBoid(){\r\n    let id = this.entities.length\r\n    // choose a new starting point randomly :)\r\n    let _x = Math.random()\r\n    let _y = Math.random()\r\n    let _pos = new vec2(_x, _y).scl(this.bound_size)\r\n\r\n    // generate a new entity\r\n    let _ent = new boid(_pos, this.entity_size, id)\r\n\r\n    _ent.onImmuneSystemStateUpdated = this.boidStateUpdateHandler.bind(this, _ent)\r\n\r\n    this.entities.push(_ent)\r\n  }\r\n\r\n  _initBoids(){\r\n    for(let i=0; i<this.nEntities.getValue(); i++){\r\n      this._generateNewBoid()\r\n    }\r\n    for(let i =0; i<this.entitiesToInfect.getValue(); i++){\r\n      this.infectOne()\r\n    }\r\n  }\r\n\r\n  _parameterUpdateHandler(param: parameter){\r\n    switch(param.name){\r\n      case 'nEntities':\r\n        let n = param.getValue()\r\n        let diff = n - this.entities.length\r\n        for(let i=0; i<Math.abs(diff); i++) (diff > 0)? this._generateNewBoid() : this.entities.pop()\r\n      break;\r\n      case 'EntitySize':\r\n        this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Render/Update Intervals\r\n\r\n  startRenderInterval(interval: number){\r\n    if(this.renderIntervalID !== null){\r\n      clearInterval(this.renderIntervalID)\r\n    }\r\n    this.renderIntervalID = setInterval(this._render.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  stopRenderInterval(){\r\n    if(this.renderIntervalID){\r\n      clearInterval(this.renderIntervalID)\r\n      this.renderIntervalID = null\r\n    }\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this._update.bind(this), interval) as unknown as number\r\n\r\n    this.updateInterval = interval\r\n  }\r\n\r\n  stopUpdateInterval(){\r\n    if(this.updateIntervalID){\r\n      clearInterval(this.updateIntervalID)\r\n      this.updateIntervalID = null\r\n    }\r\n  }\r\n\r\n  // interface Methods\r\n\r\n  reset(){\r\n    this.entities = []\r\n    this._initBoids()\r\n  }\r\n\r\n  addRule(_rule: boidRule){\r\n    console.log(_rule)\r\n    this.rules.push(_rule)\r\n  }\r\n\r\n  clearRules(){\r\n    this.rules = []\r\n  }\r\n\r\n  // Render/Update Methods\r\n\r\n  _render(){\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\r\n    let id=0\r\n    for(let entity of this.entities){\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI, false);\r\n      switch(entity.immuneState){\r\n        case sickness_state.cured:\r\n        this.ctx.fillStyle = '#004c00';\r\n        break;\r\n\r\n        case sickness_state.healthy:\r\n        this.ctx.fillStyle = '#198c19';\r\n        break;\r\n\r\n        case sickness_state.incubating:\r\n        this.ctx.fillStyle = '#ffff7f';\r\n        break;\r\n\r\n        case sickness_state.sick:\r\n        this.ctx.fillStyle = '#ff4c4c';\r\n        break;\r\n      }\r\n\r\n      this.ctx.fill();\r\n\r\n      this.ctx.beginPath();\r\n      this.ctx.strokeStyle = '#2a4e6c'\r\n      this.ctx.lineWidth = 0.3;\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI);\r\n      this.ctx.stroke();\r\n      id ++\r\n    }\r\n  }\r\n\r\n  _updateGraphData(){\r\n    let nEntitesMax = this.nEntities.getValue()\r\n    let nAlive: number = this.entities.length\r\n    let nInfected: number = 0\r\n    let nSick: number = 0\r\n    let nImmune: number = 0\r\n    let nDead: number = nEntitesMax - this.entities.length\r\n\r\n    for(let ent of this.entities){\r\n      switch(ent.immuneState){\r\n        case sickness_state.cured:\r\n          nImmune ++\r\n          break;\r\n        case sickness_state.incubating:\r\n          nInfected ++\r\n          break;\r\n        case sickness_state.sick:\r\n          nSick ++\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.gv_EntitiesAlive.appendValue(nAlive)\r\n    this.gv_EntitiesInfected.appendValue(nInfected)\r\n    this.gv_EntitiesSick.appendValue(nSick)\r\n    this.gv_EntitesImmune.appendValue(nImmune)\r\n    this.gv_EntitiesDead.appendValue(nDead)\r\n  }\r\n\r\n  _update(){\r\n    if(this.resetInNext){\r\n      this.entities = []\r\n      this._initBoids()\r\n      this.resetInNext = false;\r\n    }\r\n\r\n    if(this.entities.length > 0) this._updateGraphData();\r\n    for(let ent of this.entitiesToBeRemoved){\r\n      this.entities.splice(this.entities.indexOf(ent), 1)\r\n    }\r\n    this.entitiesToBeRemoved = []\r\n    //console.log('stepping panda')\r\n    let diff = this.updateInterval;\r\n    //TODO calulate distance matrix\r\n    let distMatrix = distanceAccelerator(this.entities)\r\n    //let rules_list = [rules.socialRule, rules.randomRule, rules.makeBorderRule(this.size)]\r\n\r\n    for(let entity of this.entities){\r\n      entity.update(diff, this.entities, distMatrix, this.rules)\r\n    }\r\n\r\n    if(this.continuum){\r\n      let id = 0\r\n      for(let entity of this.entities){\r\n        let point = entity.position\r\n        if(point.x < -this.entity_size){\r\n          entity.position.x += this.size.x + entity.size\r\n        }else if (point.x > (this.size.x + this.entity_size.getValue(id))){\r\n          entity.position.x -= this.size.x + entity.size\r\n        }\r\n\r\n        if(point.y < -this.entity_size){\r\n          entity.position.y += this.size.y + entity.size\r\n        }else if (point.y > (this.size.y + this.entity_size.getValue(id))){\r\n          entity.position.y -= this.size.y + entity.size\r\n        }\r\n        id ++\r\n      }\r\n    }\r\n  }\r\n\r\n  restart(){\r\n    console.log('restarting be')\r\n\r\n    this.resetInNext = true\r\n\r\n    this.gv_EntitiesAlive.resetData()\r\n    this.gv_EntitiesInfected.resetData()\r\n    this.gv_EntitiesSick.resetData()\r\n    this.gv_EntitesImmune.resetData()\r\n    this.gv_EntitiesDead.resetData()\r\n  }\r\n\r\n}\r\n\r\nlet limit = (min: number, max: number, val:number) => {\r\n  if(val < min) return min\r\n  if(val > max) return max\r\n  return val\r\n}\r\n\r\nlet limit_vec_len = (vec:vec2, limit:number) => {\r\n  let len = vec.len()\r\n  if(len>limit) return vec.norm().scl(limit)\r\n  return vec\r\n}\r\n\r\nexport class boid {\r\n  position: vec2\r\n  velocity: vec2 = new vec2()\r\n  state: string\r\n  _size: parameter\r\n\r\n  id: number\r\n\r\n  acceleration: parameter\r\n  speed: parameter\r\n\r\n  infection: sickness\r\n  ImmuneSystemStateUpdateHandler: any | null\r\n\r\n  constructor(pos: vec2 = new vec2(), size:parameter, id:number=0) {\r\n    this.position = pos\r\n    this._size = size\r\n    this.state = 'base'\r\n\r\n    this.id = id\r\n\r\n    this.acceleration = parameter.getParameterByNameOrCreate('Entity Acceleration', parameter_type.universal, 15, 25)\r\n    this.speed = parameter.getParameterByNameOrCreate('Entity Speed', parameter_type.universal, 15, 20)\r\n\r\n    this.infection = new sickness()\r\n  }\r\n\r\n  update(diff: number, entities:boid[], distanceMatrix:distanceElement[][], rules: boidRule[]){\r\n    let walk_dir = new vec2()\r\n\r\n    for(let idx=0; idx < rules.length; idx ++){\r\n      let rule = rules[idx]\r\n\r\n      // get the corresponding parameter :)\r\n      let rule_dir = rule.executeRule(this, entities, distanceMatrix)\r\n      rule_dir = rule.weightRule(rule_dir, this)\r\n      walk_dir = walk_dir.add(rule_dir)\r\n    }\r\n    let walk_acc = walk_dir.norm().scl(this.acceleration.getValue() * diff/1000)\r\n    this.velocity = this.velocity.add(walk_acc)\r\n    this.velocity = limit_vec_len(this.velocity, this.speed.getValue())\r\n\r\n    let new_position = this.position.add(this.velocity.scl(diff/1000))\r\n    // console.log(new_position.sub(this.position).len())\r\n\r\n    this.position = this._resolveCollisions(new_position, walk_dir, entities)\r\n\r\n    this.infection.update(diff)\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    this.infection.inVirusVicinity()\r\n  }\r\n\r\n  setImmuneSystemState(state: sickness_state){\r\n    this.infection.state = state\r\n  }\r\n\r\n  // TODO move this to the engine :)\r\n  _resolveCollisions(newpos: vec2, walk_dir: vec2, entities:boid[]): vec2{\r\n    // could be sped up by only checking entities which were in the neighborhood before via max_walk_dist & distanceMatrix\r\n\r\n    let nEntities = entities.length\r\n\r\n    for(let i=0; i<nEntities; i++){\r\n      let entity = entities[i]\r\n      if(entity === this) continue\r\n      let dvec = entities[i].position.sub(newpos)\r\n      let len = dvec.len()\r\n\r\n      let mindist = this.size/2 + entities[i].size/2\r\n      if(len < mindist){\r\n        let resolve_vector = dvec.norm().scl(mindist - len)\r\n        // entities[i].position = entities[i].position.add(dvec.scl(0.25))\r\n        newpos = newpos.sub(resolve_vector)\r\n      }\r\n    }\r\n\r\n    return newpos\r\n  }\r\n\r\n  get size(): number{\r\n    return this._size.getValue(this.id)\r\n  }\r\n\r\n  get immuneState(){\r\n    return this.infection.state\r\n  }\r\n\r\n  set onImmuneSystemStateUpdated(callback: any){\r\n    this.infection.onStateUpdated = callback\r\n  }\r\n\r\n}\r\n\r\n/*\r\n\r\n\r\nsize: vec2\r\nbound_size: vec2\r\n_hbs: vec2\r\nentities: pandaEntity[]\r\n\r\nconstructor(ctx: CanvasRenderingContext2D, n: number){\r\n\r\n\r\n  this.ctx = ctx\r\n*/\r\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport class ParameterControl {\r\n  controller: ParameterController\r\n  controlledParameter: parameter\r\n\r\n  minElement: HTMLInputElement|null = null\r\n  maxElement: HTMLInputElement|null = null\r\n  valueSlider: HTMLInputElement|null = null\r\n\r\n  constructor(controller: ParameterController, param: parameter){\r\n    this.controller = controller\r\n    this.controlledParameter = param\r\n    this.createUIElement()\r\n    this.attachListeners()\r\n  }\r\n\r\n  createUIElement(){\r\n    let listElem = document.createElement('li');\r\n    listElem.className = ''\r\n    let param_ctrl = document.createElement('div')\r\n    param_ctrl.className = 'param_options | no_select'\r\n    param_ctrl.innerText = this.controlledParameter.name + '\\n'\r\n\r\n    if(this.controlledParameter.type === parameter_type.entity_scoped ||\r\n       this.controlledParameter.type === parameter_type.universal){\r\n\r\n         let label_min: HTMLLabelElement = document.createElement('label')\r\n         label_min.htmlFor = `${this.controlledParameter.name}_min`\r\n         label_min.innerText = 'min:'\r\n         let input_min: HTMLInputElement = document.createElement('input')\r\n         input_min.name = `${this.controlledParameter.name}_min`\r\n         input_min.type = 'number'\r\n         input_min.value = this.controlledParameter.min + ''\r\n\r\n         let br_el = document.createElement('br')\r\n\r\n         let label_max: HTMLLabelElement = document.createElement('label')\r\n         label_max.htmlFor = `${this.controlledParameter.name}_max`\r\n         label_max.innerText = 'max:'\r\n         let input_max: HTMLInputElement = document.createElement('input')\r\n         input_max.name = `${this.controlledParameter.name}_max`\r\n         input_max.type = 'number'\r\n         input_max.value = this.controlledParameter.max + ''\r\n\r\n         this.minElement = input_min\r\n         this.maxElement = input_max\r\n\r\n         param_ctrl.appendChild(label_min)\r\n         param_ctrl.appendChild(input_min)\r\n         param_ctrl.appendChild(br_el)\r\n         param_ctrl.appendChild(label_max)\r\n         param_ctrl.appendChild(input_max)\r\n    }\r\n    listElem.appendChild(param_ctrl)\r\n\r\n    if(this.controlledParameter.type === parameter_type.universal ||\r\n       this.controlledParameter.type === parameter_type.universal_percentage){\r\n      let param_setpoint = document.createElement('div')\r\n      param_setpoint.className = 'param_setpoint'\r\n\r\n      let param_slider: HTMLInputElement = document.createElement('input')\r\n      param_slider.type = 'range'\r\n      param_slider.min = '0'\r\n      param_slider.max = '1000'\r\n      param_slider.value = '500'\r\n\r\n      param_setpoint.appendChild(param_slider)\r\n\r\n      listElem.appendChild(param_setpoint)\r\n      this.valueSlider = param_slider\r\n    }\r\n    this.controller.addUIElement(listElem)\r\n  }\r\n\r\n  attachListeners(){\r\n    if(this.minElement){\r\n      let _el: HTMLInputElement = this.minElement\r\n      this.minElement.onchange = () => { this.controlledParameter.setMin(parseInt(_el.value)) }\r\n    }\r\n\r\n    if(this.maxElement){\r\n      let _el: HTMLInputElement = this.maxElement\r\n      this.maxElement.onchange = () => { this.controlledParameter.setMax(parseInt(_el.value)) }\r\n    }\r\n\r\n    if(this.valueSlider){\r\n      let _el: HTMLInputElement = this.valueSlider\r\n      this.valueSlider.onchange = () => {\r\n        let val: number = parseInt(_el.value)/1000.0\r\n        val *= this.controlledParameter.max - this.controlledParameter.min\r\n        val += this.controlledParameter.min\r\n        this.controlledParameter.setValue(val)\r\n       }\r\n    }\r\n  }\r\n}\r\n\r\nexport class ParameterController {\r\n  parameter_container: HTMLElement\r\n  controlElements: ParameterControl[]\r\n\r\n  constructor(container: HTMLElement){\r\n    this.parameter_container = container\r\n    parameter.emitter.on('paramAdded', this.parameterAddHandler.bind(this))\r\n\r\n    this.controlElements = []\r\n  }\r\n\r\n  parameterAddHandler(param: parameter){\r\n    let _ctrl = new ParameterControl(this, param)\r\n    this.controlElements.push(_ctrl)\r\n  }\r\n\r\n  addUIElement(element: HTMLElement){\r\n    this.parameter_container.appendChild(element)\r\n  }\r\n\r\n}\r\n"],"sourceRoot":""}