{"version":3,"sources":["webpack://pandaemic_lib/webpack/bootstrap","webpack://pandaemic_lib/./src/utils.ts","webpack://pandaemic_lib/(webpack)/buildin/global.js","webpack://pandaemic_lib/./node_modules/events/events.js","webpack://pandaemic_lib/./src/boidRules.ts","webpack://pandaemic_lib/./src/pandemic.ts","webpack://pandaemic_lib/./src/grapher.ts","webpack://pandaemic_lib/./src/index.ts","webpack://pandaemic_lib/./src/boids.ts","webpack://pandaemic_lib/./node_modules/timers-browserify/main.js","webpack://pandaemic_lib/./node_modules/setimmediate/setImmediate.js","webpack://pandaemic_lib/./node_modules/process/browser.js","webpack://pandaemic_lib/./src/parametercontrol.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","vec2","x","y","sub","this","add","scl","len","Math","sqrt","norm","fn","a","min","v","max","dot","rect","pos","size","position","center","isInside","point","insideX","insideY","parameter_type","parameter","type","nparam","dependecies","universal_percentage","getParameterByName","_values","entity_scoped","registerDependency","_updateHandler","getValue","push","_randomValue","paramList","emitter","emit","param","length","diff","abs","pop","_updateValues","_i","_a","cb","setImmediate","rnd","random","callback","valueOf","id","universal","setValue","val","setMin","setMax","getParametersByName","params","getParameterByNameOrCreate","_param","getParameters","EventEmitter","ruler","checkLength","str","fontStyle","element","_getElement","style","font","innerHTML","offsetWidth","document","createElement","body","appendChild","visibility","whiteSpace","g","Function","e","window","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","init","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","prepend","events","existing","warning","newListener","unshift","warned","w","Error","String","count","console","warn","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","listeners","addListener","on","prependListener","once","prependOnceListener","list","originalListener","shift","index","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","distanceAccelerator","entities","distMatrix","tmp","ii","dvec","dist","vec","extendStatics","__extends","b","setPrototypeOf","__proto__","__","constructor","distanceElement","boidRule","ruleName","log","executeRule","entity","distanceMatrix","weightRule","dir","weightParamNormal","weightParamSick","weightParam","immuneState","sickness_state","sick","socialRule","_super","_this","view_distance","entity_size","nEntities","viewDistance","rule_dir","_entity","randomRule","avoidanceRule","avoidance_distance","avoidanceDistance","sicknessRule","infection_distance","infecting","infection","incubating","infectionDistance","inVirusVicinity","sickness","mortality_rate","infection_rate","incubation_time","healing_time","immune_time","_state","healthy","timer","makeSick","deceased","newstate","onStateUpdated","configurable","update","cured","infectable","graphedVariable","color","values","variableList","appendValue","resetData","event","getGraphVariableByName","vars","variable","getGraphVariableByNameOrCreate","_var","getGraphedVariables","grapher","ctx","sizeChanged","margin","varNamesWidthPx","fontSizePt","colorDotSizePx","varNameSizePx","legendSize","nRows","dataChanged","updateIntervalID","minVal","maxVal","boundsChanged","width","canvas","height","varUpdatedListener","varAddedListener","stepSize","rowSize","yScale","xScale","startUpdateInterval","redrawLegend","addEventListener","setTimeout","resizeEvent","_updateLengendSizing","fontsize_px","toFixed","maxSizePx","nameSizePx","newval","interval","clearInterval","setInterval","clearRect","plotAllGraphVariables","fillStyle","idx","offset","y_1","fillText","beginPath","arc","PI","fill","strokeStyle","scale","moveTo","lineTo","stroke","translate","variables_1","gv","plotData","data","dataSet","sections","reset","boids","rules","initCanvas","canvasElement","container","canvasContext","getContext","resizeHandler","h","clientHeight","clientWidth","onload","param_container","getElementById","app_window","maxHeight","getBoundingClientRect","ParameterController","_initParameterController","be","gr","grapherCanvasElement","_initGrapher","options","boidEngineConfig","maxEntities","maxEntitySize","minEntitySize","fps","boidEngine","randr","addRule","socr","avr","sickr","infectOne","_initPandaemicApplication","btnRestart","onclick","restart","_initControls","continuum","boidRuleConfig","entitiesToBeRemoved","resetInNext","renderIntervalID","updateInterval","_parameterUpdateHandler","eps","entitiesToInfect","bound_size","_hbs","_initBoids","frametime","startRenderInterval","gv_EntitiesAlive","gv_EntitiesInfected","gv_EntitiesSick","gv_EntitesImmune","gv_EntitiesDead","floor","setImmuneSystemState","boidStateUpdateHandler","_generateNewBoid","_x","_y","_pos","_ent","boid","onImmuneSystemStateUpdated","_render","stopRenderInterval","_update","stopUpdateInterval","_rule","clearRules","lineWidth","_updateGraphData","nEntitesMax","nAlive","nInfected","nSick","nImmune","nDead","ent","splice","indexOf","_b","_c","_d","_e","velocity","_size","acceleration","speed","walk_dir","rule","walk_acc","limit","limit_vec_len","new_position","_resolveCollisions","newpos","mindist","resolve_vector","self","Timeout","clearFn","_id","_clearFn","scope","clearTimeout","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","global","clearImmediate","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","attachTo","toString","process","handle","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","port2","documentElement","script","onreadystatechange","removeChild","source","slice","attachEvent","task","run","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","binding","cwd","chdir","umask","ParameterControl","controller","minElement","maxElement","valueSlider","controlledParameter","createUIElement","attachListeners","listElem","className","param_ctrl","innerText","label_min","htmlFor","input_min","br_el","label_max","input_max","param_setpoint","param_slider","addUIElement","_el_1","onchange","parseInt","_el_2","_el_3","parameter_container","parameterAddHandler","controlElements","_ctrl"],"mappings":"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","file":"pandaemic.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","import { EventEmitter } from 'events'\r\n\r\nexport class vec2 {\r\n  x: number\r\n  y: number\r\n\r\n  constructor(x:number|null = 0, y:number|null = 0){\r\n    x = x || 0\r\n    y = y || 0\r\n\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  sub(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x - x.x, this.y - x.y)\r\n    }\r\n\r\n    y = y || x\r\n\r\n    return new vec2(this.x - x, this.y - y)\r\n  }\r\n\r\n  add(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x + x.x, this.y + x.y)\r\n    }\r\n\r\n    return new vec2(this.x + x, this.y + y)\r\n  }\r\n\r\n  scl(s:number|vec2 = 0): vec2{\r\n    if(typeof s === 'object'){\r\n      return new vec2(this.x*s.x, this.y*s.y)\r\n    }\r\n\r\n    return new vec2(this.x*s, this.y*s)\r\n  }\r\n\r\n  len():number{\r\n    return Math.sqrt(this.x*this.x + this.y*this.y)\r\n  }\r\n\r\n  norm():vec2{\r\n    let l = this.len()\r\n    if(l === 0) return new vec2(0, 0)\r\n    return new vec2(this.x/l, this.y/l)\r\n  }\r\n\r\n  fn(a:any):vec2{\r\n    return new vec2(a(this.x), a(this.y))\r\n  }\r\n\r\n  min(v: vec2){\r\n    return new vec2(Math.min(this.x, v.x), Math.min(this.x, v.y))\r\n  }\r\n\r\n  max(v: vec2){\r\n    return new vec2(Math.max(this.x, v.x), Math.max(this.x, v.y))\r\n  }\r\n\r\n  dot(v: vec2){\r\n    return this.x*v.x + this.y*v.y\r\n  }\r\n\r\n}\r\n\r\nexport class rect {\r\n  size: vec2\r\n  position: vec2\r\n\r\n  center: vec2\r\n\r\n  constructor(pos: vec2, size: vec2){\r\n    this.position = pos\r\n    this.size = size\r\n\r\n    this.center = this.position.add(this.size).scl(1/2)\r\n  }\r\n\r\n  isInside(point: vec2){\r\n    let insideX = (point.x > this.position.x) && (point.x < (this.position.x + this.size.x))\r\n    let insideY = (point.y > this.position.y) && (point.y < (this.position.y + this.size.y))\r\n    return insideX && insideY\r\n  }\r\n\r\n\r\n}\r\n\r\nexport enum parameter_type {\r\n  universal,\r\n  entity_scoped,\r\n  universal_percentage\r\n}\r\n\r\nexport class parameter {\r\n  static paramList: parameter[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  min: number\r\n  max: number\r\n  type: parameter_type\r\n  name: string\r\n\r\n  value: number\r\n  _values: number[]\r\n\r\n  dependecies: any[] = []\r\n\r\n  n: parameter|null\r\n\r\n  constructor(min: number, max:number, type: parameter_type, name: string = 'none', nparam: parameter|null = null){\r\n    if(type === parameter_type.universal_percentage){\r\n      // ignore min / max assignment\r\n      this.min = 0\r\n      this.max = 1\r\n    } else {\r\n      this.min = Math.min(min, max)\r\n      this.max = Math.max(min, max)\r\n    }\r\n\r\n    this.type = type\r\n    this.name = name\r\n\r\n    this.n = nparam || parameter.getParameterByName('nEntities')\r\n\r\n    this.value = (this.max - this.min)/2 + this.min\r\n    this._values = []\r\n    if(this.type === parameter_type.entity_scoped){\r\n      if(this.n){\r\n        this.n.registerDependency(this._updateHandler.bind(this))\r\n        for(let i=0; i<this.n.getValue(); i++){\r\n          this._values.push(this._randomValue())\r\n        }\r\n      }\r\n    }\r\n\r\n    parameter.paramList.push(this)\r\n    // console.log(parameter.paramList)\r\n    parameter.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  _updateHandler(param: parameter|null = null){\r\n    if(param && param.name === 'nEntities'){\r\n      let n = this._values.length\r\n      let diff = param.getValue() - n\r\n      for(let i=0; i<Math.abs(diff); i++) (diff>0)? this._values.push(0) : this._values.pop()\r\n    }\r\n\r\n    //update all values\r\n    this._updateValues()\r\n\r\n    // pass change event onto dependencies :)\r\n    for(let cb of this.dependecies){\r\n      setImmediate(cb, this)\r\n    }\r\n  }\r\n\r\n  _randomValue(): number{\r\n    let rnd:number = Math.random()\r\n    let val:number = (this.max - this.min)*rnd + this.min\r\n    return val\r\n  }\r\n\r\n  _updateValues(){\r\n    if(this.n){\r\n      for(let i=0; i<this.n.getValue(); i++){\r\n        this._values[i] = this._randomValue()\r\n      }\r\n    }\r\n  }\r\n\r\n  registerDependency(callback: any){\r\n    this.dependecies.push(callback)\r\n  }\r\n\r\n  valueOf(): number{\r\n    return 10\r\n  }\r\n\r\n  getValue(id: number = 0): number {\r\n    switch(this.type){\r\n      case parameter_type.universal:\r\n      case parameter_type.universal_percentage:\r\n        return this.value\r\n      case parameter_type.entity_scoped:\r\n        if(id < 0) id = 0\r\n        if(id >= this._values.length) id = this._values.length-1\r\n        return this._values[id]\r\n    }\r\n    return 0\r\n  }\r\n\r\n  setValue(val: number){\r\n    if(val > this.max) val = this.max\r\n    if(val < this.min) val = this.min\r\n    this.value = val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMin(val: number){\r\n    this.min = (this.type === parameter_type.universal_percentage)? 0 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMax(val: number){\r\n    this.max = (this.type === parameter_type.universal_percentage)? 1 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n\r\n\r\n\r\n  static getParametersByName(name: string){\r\n    let params:parameter[] = []\r\n    for(let param of parameter.paramList){\r\n      if(param.name === name) params.push(param)\r\n    }\r\n    return params\r\n  }\r\n\r\n  static getParameterByName(name: string): parameter|null{\r\n    return this.getParametersByName(name)[0]\r\n  }\r\n\r\n  static getParameterByNameOrCreate(name: string, type:parameter_type=parameter_type.entity_scoped, min:number=0, max:number= 1): parameter{\r\n    let _param = this.getParametersByName(name)[0]\r\n    if(!_param){\r\n      _param = new parameter(min, max, type, name)\r\n    }\r\n\r\n    return _param\r\n  }\r\n\r\n  static getParameters(){\r\n    return parameter.paramList\r\n  }\r\n\r\n}\r\n\r\nexport class ruler {\r\n  static element: HTMLElement|null\r\n  static checkLength(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetWidth\r\n  }\r\n\r\n  static _getElement(){\r\n    // document.write('<span id=\"ruler\"></span>')\r\n    ruler.element = document.createElement('span') as HTMLElement\r\n    document.body.appendChild(ruler.element)\r\n    ruler.element.style.visibility = 'hidden'\r\n    ruler.element.style.whiteSpace = 'nowrap'\r\n  }\r\n}\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","import { boid } from './boids'\r\nimport { vec2, rect, parameter, parameter_type } from './utils'\r\nimport { sickness, sickness_state } from './pandemic'\r\n\r\nexport class distanceElement{\r\n  dist: number = 0\r\n  vec: vec2 = new vec2()\r\n}\r\n\r\nexport function distanceAccelerator(entities: boid[]): distanceElement[][]{\r\n  let n = entities.length\r\n  let distMatrix: distanceElement [][] = []\r\n\r\n\r\n  let tmp: distanceElement[] = []\r\n  for(let i=0; i<n; i++){\r\n    tmp = []\r\n    // for(let ii=0; ii<n; ii++){\r\n    //   tmp.push({dist: 0, vec: new vec2()})\r\n    // }\r\n    distMatrix.push(tmp)\r\n  }\r\n\r\n  for(let i=0; i<n; i++){\r\n    for(let ii=i; ii<n; ii++){\r\n      let dvec = entities[i].position.sub(entities[ii].position)\r\n      let dist = dvec.len()\r\n      distMatrix[i][ii] = {dist:dist, vec: dvec}\r\n      distMatrix[ii][i] = {dist:dist, vec: dvec.scl(-1)}\r\n    }\r\n  }\r\n  return distMatrix\r\n}\r\n\r\nexport class boidRule {\r\n  ruleName: string;\r\n\r\n  constructor(name:string){\r\n    this.ruleName = name;\r\n    console.log('Constructed new rule w/ name:', name)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2{\r\n    console.log('Excuting base rule :)')\r\n    return new vec2()\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    let weightParamNormal = parameter.getParameterByNameOrCreate(`${this.ruleName} weight`)\r\n    let weightParamSick = parameter.getParameterByNameOrCreate(`${this.ruleName} weight (sick)`)\r\n\r\n    let weightParam = (entity.immuneState === sickness_state.sick)? weightParamSick : weightParamNormal\r\n    return dir.scl(weightParam.getValue(entity.id))\r\n  }\r\n\r\n}\r\n\r\nexport class socialRule extends boidRule{\r\n\r\n  view_distance: parameter\r\n  entity_size: parameter\r\n\r\n  constructor(){\r\n    super('SocialRule')\r\n    this.view_distance = parameter.getParameterByNameOrCreate('View Distance', parameter_type.universal, 10, 30)\r\n    this.entity_size = parameter.getParameterByNameOrCreate('EntitySize', parameter_type.universal, 4, 8)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities = distanceMatrix.length\r\n    let viewDistance = this.view_distance.getValue()\r\n\r\n    let rule_dir = new vec2()\r\n    for(let i:number=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = entity.position.sub(_entity.position)\r\n      if(dist.len() < viewDistance){\r\n        // if(dist <= this.entity_size.getValue(id)*1.2) continue\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 1/e))\r\n      }\r\n    }\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\nexport class randomRule extends boidRule{\r\n\r\n  constructor(){\r\n    super('randomRule')\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let x = (Math.random() - 0.5) * 2\r\n    let y = (Math.random() - 0.5) * 2\r\n\r\n    let rule_dir = new vec2(x, y)\r\n    return rule_dir.norm()\r\n}\r\n\r\n}\r\n\r\nexport class avoidanceRule extends boidRule{\r\n  avoidance_distance: parameter;\r\n\r\n\r\n  constructor(){\r\n    super('avoidanceRule')\r\n\r\n    this.avoidance_distance = parameter.getParameterByNameOrCreate('Avoidance Distance', parameter_type.universal, 10, 30)\r\n\r\n  }\r\n\r\n  executeRule(entity:boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let avoidanceDistance = this.avoidance_distance.getValue()\r\n\r\n    let rule_dir: vec2 = new vec2()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = _entity.position.sub(entity.position)\r\n      if(dist.len() < avoidanceDistance){\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 100 * 1/e))\r\n      }\r\n    }\r\n\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\n/*\r\nThis rule does not return a distance, but abuses the rule interface to handle infections...\r\n*/\r\nexport class sicknessRule extends boidRule{\r\n  infection_distance: parameter;\r\n\r\n  constructor(){\r\n    super('sicknessRule')\r\n    this.infection_distance = parameter.getParameterByNameOrCreate('Infection Distance', parameter_type.universal, 10, 15)\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    return dir;\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let infecting = entity.infection.state === sickness_state.incubating || entity.infection.state === sickness_state.sick\r\n\r\n    let infectionDistance = this.infection_distance.getValue()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = entity.position.sub(_entity.position)\r\n\r\n      // let distEl: distanceElement = distanceMatrix[id][i]\r\n      if(dist.len() < infectionDistance && infecting){\r\n        // possibly infect the other boid...\r\n        let otherEntity = entities[i]\r\n        otherEntity.inVirusVicinity()\r\n      }\r\n    }\r\n\r\n    return new vec2()\r\n  }\r\n\r\n}\r\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport enum sickness_state {\r\n  healthy,\r\n  incubating,\r\n  sick,\r\n  deceased,\r\n  cured\r\n}\r\n\r\nexport class sickness {\r\n  mortality_rate: parameter\r\n  infection_rate: parameter\r\n  incubation_time: parameter\r\n  healing_time: parameter\r\n  immune_time: parameter\r\n\r\n  _state: sickness_state\r\n  timer: number;\r\n\r\n  onStateUpdated: any|null;\r\n\r\n  constructor(){\r\n    this.mortality_rate = parameter.getParameterByNameOrCreate('Mortality Rate', parameter_type.universal_percentage)\r\n    this.infection_rate = parameter.getParameterByNameOrCreate('Infection Rate', parameter_type.universal_percentage)\r\n    this.incubation_time = parameter.getParameterByNameOrCreate('Incubation Time', parameter_type.universal, 0, 100)\r\n    this.healing_time = parameter.getParameterByNameOrCreate('Healing Time', parameter_type.universal, 0, 100)\r\n    this.immune_time = parameter.getParameterByNameOrCreate('Immune Time', parameter_type.universal, 0, 100)\r\n\r\n    this._state = sickness_state.healthy\r\n    this.timer = 0\r\n  }\r\n\r\n  makeSick(){\r\n    if(this.state !== sickness_state.deceased){\r\n      this.state = sickness_state.sick;\r\n    }\r\n  }\r\n\r\n  set state(newstate: sickness_state){\r\n    this._state = newstate\r\n    if(this.onStateUpdated) this.onStateUpdated(this._state)\r\n  }\r\n\r\n  get state(){\r\n    return this._state\r\n  }\r\n\r\n  update(diff: number){\r\n    switch(this.state){\r\n      case sickness_state.healthy:\r\n        // do nothing :)\r\n      break;\r\n      case sickness_state.incubating:\r\n        this.timer += diff\r\n        if(this.timer > this.incubation_time.getValue()*1000){\r\n          this.state = sickness_state.sick\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case sickness_state.sick:\r\n        this.timer += diff\r\n        if(this.timer > this.healing_time.getValue()*1000){\r\n          let rnd = Math.random()\r\n          if(rnd > this.mortality_rate.getValue()){\r\n            this.state = sickness_state.healthy\r\n          }else{\r\n            this.state = sickness_state.deceased\r\n          }\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case sickness_state.deceased:\r\n        // can't do anything :)\r\n      break;\r\n      case sickness_state.cured:\r\n        this.timer += diff\r\n        if(this.timer > this.immune_time.getValue()*1000){\r\n          this.state = sickness_state.healthy\r\n          this.timer = 0\r\n        }\r\n      break;\r\n    }\r\n  }\r\n\r\n  get infectable() {\r\n    return this._state === sickness_state.healthy\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    if(!this.infectable) return\r\n    let _rnd = Math.random()\r\n    if(_rnd <= this.infection_rate.getValue()){\r\n      this.state = sickness_state.incubating\r\n    }\r\n  }\r\n\r\n\r\n\r\n}\r\n","import { vec2, ruler } from './utils'\r\nimport { EventEmitter } from 'events'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class graphedVariable {\r\n  static variableList: graphedVariable[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  name: string\r\n  color: string\r\n\r\n  values: number[]\r\n  n: number\r\n\r\n  constructor(name: string = 'none', color: string = '#000'){\r\n    this.name = name\r\n    this.color = color\r\n\r\n    this.n = 0\r\n    this.values = []\r\n\r\n    graphedVariable.variableList.push(this)\r\n    // console.log(parameter.paramList)\r\n    graphedVariable.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  appendValue(val: number){\r\n    this.values.push(val)\r\n    graphedVariable.emitter.emit('variableUpdated', val, this)\r\n  }\r\n\r\n  get data(){\r\n    // TODO add preprocessing?\r\n    return this.values\r\n  }\r\n\r\n  resetData(){\r\n    this.n = 0\r\n    this.values = []\r\n  }\r\n\r\n  static on(event: string, callback: any){\r\n    graphedVariable.emitter.on(event, callback)\r\n  }\r\n\r\n  static getGraphVariableByName(name: string): graphedVariable|null{\r\n    let vars: graphedVariable[] = []\r\n    for(let variable of graphedVariable.variableList){\r\n      if(variable.name === name) vars.push(variable)\r\n    }\r\n\r\n    if(vars.length === 0) return null\r\n    return vars[0]\r\n  }\r\n\r\n  static getGraphVariableByNameOrCreate(name: string, color: string): graphedVariable{\r\n    let _var = this.getGraphVariableByName(name)\r\n    if(!_var){\r\n      _var = new graphedVariable(name, color)\r\n    }\r\n    return _var\r\n  }\r\n\r\n  static getGraphedVariables(){\r\n    return graphedVariable.variableList\r\n  }\r\n\r\n}\r\n\r\n\r\nexport class grapher{\r\n  values: number[][]\r\n  ctx: CanvasRenderingContext2D\r\n  size: vec2\r\n  sizeChanged: boolean = false\r\n\r\n  maxVal: number\r\n  minVal: number\r\n  boundsChanged: boolean\r\n\r\n  xScale: number\r\n  yScale: number\r\n  stepSize: number\r\n  margin: number = 10\r\n  rowSize: number\r\n\r\n  varNamesWidthPx: number = 0\r\n  fontSizePt: number = 10\r\n  colorDotSizePx: number = 4\r\n  varNameSizePx: number = 25\r\n\r\n  legendSize: number = 50\r\n  nRows = 4\r\n\r\n  dataChanged: boolean = true\r\n\r\n  updateIntervalID: timerHandle|null = null\r\n\r\n  constructor(ctx: CanvasRenderingContext2D){\r\n    this.values = []\r\n    this.ctx = ctx\r\n\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.boundsChanged = true\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    graphedVariable.on('variableUpdated', this.varUpdatedListener.bind(this))\r\n    graphedVariable.on('paramAdded', this.varAddedListener.bind(this))\r\n\r\n    // set these values for your data\r\n    let sections = 12;\r\n    this.stepSize = 40;\r\n    this.rowSize = 50;\r\n\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.xScale = (this.size.x - this.rowSize) / sections;\r\n\r\n    this.startUpdateInterval(100)\r\n\r\n    this.redrawLegend()\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.sizeChanged = true\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  _updateLengendSizing(){\r\n\r\n    let fontsize_px = this.size.y / 13\r\n    this.fontSizePt = fontsize_px*0.75\r\n    let fontStyle = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n\r\n    this.varNameSizePx = fontsize_px * 1.5\r\n    this.colorDotSizePx = Math.min(4, this.varNameSizePx/3)\r\n\r\n\r\n    let maxSizePx = 0\r\n    for (let _var of graphedVariable.variableList){\r\n      let nameSizePx = ruler.checkLength(_var.name + 'aa', fontStyle)\r\n      maxSizePx = Math.max(maxSizePx, nameSizePx)\r\n      // console.log(_var.name + '=>' + nameSizePx)\r\n    }\r\n    this.varNamesWidthPx = maxSizePx + 2*this.colorDotSizePx\r\n\r\n    this.legendSize = 2 * ruler.checkLength(this.maxVal.toFixed(1), fontStyle)\r\n  }\r\n\r\n  varAddedListener(_var: graphedVariable){\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  varUpdatedListener(newval: number, _var: any): void {\r\n    if(newval < this.minVal){\r\n      this.minVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    if(newval > this.maxVal){\r\n      this.maxVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    this.dataChanged = true\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this.update.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  update(){\r\n    if(!this.dataChanged) return\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    if(this.boundsChanged){\r\n      this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n      // this.xScale = (this.size.x - this.rowSize) / sections;\r\n      this.boundsChanged = false\r\n    }\r\n\r\n    this.redrawLegend()\r\n    this.plotAllGraphVariables()\r\n    // console.log(this)\r\n    this.dataChanged = false\r\n  }\r\n\r\n  redrawLegend(){\r\n    this.ctx.fillStyle = \"#997f89\"\r\n    this.ctx.font = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n    // this.ctx.font = '10pt Oswald'\r\n\r\n    let idx = 0\r\n    let offset = this.size.y - graphedVariable.getGraphedVariables().length * this.varNameSizePx\r\n    offset = offset / 2\r\n    for (let _var of graphedVariable.variableList){\r\n      this.ctx.fillStyle = _var.color\r\n      // this.ctx.fillText(_var.name, this.margin, 20);\r\n      this.ctx.fillStyle = '#292c2e'\r\n      let y = offset + this.margin + idx*this.varNameSizePx\r\n      this.ctx.fillText(_var.name, this.margin + this.legendSize, y);\r\n      this.ctx.fillStyle = _var.color\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(this.margin - 8 + this.legendSize,  y - 4, this.colorDotSizePx, 0, 2 * Math.PI, false);\r\n      this.ctx.fill()\r\n      idx ++\r\n    }\r\n\r\n    let stepSize = (this.maxVal - this.minVal) / this.nRows\r\n    // print row header and draw horizontal grid lines\r\n    var count =  0;\r\n    this.ctx.strokeStyle=\"#997f89\"; // color of grid lines\r\n    for (let scale=this.maxVal; scale>=this.minVal; scale = scale - stepSize) {\r\n      var y = this.margin + (this.yScale * count * stepSize);\r\n\r\n      this.ctx.fillText(scale.toFixed(1), this.margin, y + this.margin/2);\r\n      this.ctx.moveTo(this.legendSize + this.varNamesWidthPx ,y)\r\n      this.ctx.lineTo(this.size.x - this.margin,y)\r\n      count++;\r\n    }\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  plotAllGraphVariables(){\r\n    this.ctx.translate(this.legendSize, 0);\r\n    let variables = graphedVariable.getGraphedVariables()\r\n    for(let gv of variables){\r\n      this.ctx.strokeStyle = gv.color\r\n      this.plotData(gv.data)\r\n    }\r\n    this.ctx.translate(-this.legendSize, 0);\r\n  }\r\n\r\n  plotData(dataSet: number[]) {\r\n    let sections = dataSet.length\r\n    // let rowsize = this.size.x / sections\r\n    let xScale = this.size.x / sections;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.yScale * (this.maxVal - dataSet[0]) + this.margin);\r\n    for (let i=1;i<sections;i++) {\r\n      this.ctx.lineTo(i * xScale, this.yScale * (this.maxVal - dataSet[i]) + this.margin);\r\n    }\r\n    this.ctx.stroke();\r\n    }\r\n\r\n  reset(){\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n  }\r\n}\r\n","import * as boids from \"./boids\";\nimport * as rules from \"./boidRules\"\nimport { vec2, rect, parameter, parameter_type } from './utils'\nimport { ParameterController } from './parametercontrol'\nimport { grapher } from './grapher'\n\n\n\nlet initCanvas = (canvasElement: HTMLCanvasElement, container: HTMLElement) => {\n  let canvasContext: CanvasRenderingContext2D|null = canvasElement.getContext('2d');\n\n  let resizeHandler = () => {\n    let h = canvasElement.clientHeight\n    canvasElement.height = h\n    let w = canvasElement.clientWidth\n    canvasElement.width = w\n    if(canvasContext){\n      canvasContext.canvas.width  = w;\n      canvasContext.canvas.height = h;\n    }\n\n  }\n\n  window.addEventListener('resize', resizeHandler);\n\n  resizeHandler()\n\n  return canvasContext\n}\n\nlet _initPandaemicApplication = (canvas: HTMLCanvasElement) => {\n  let container: HTMLElement|null = document.getElementById('be_canvas_container')\n  if(!container) return\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n\n  let options = new boids.boidEngineConfig()\n  options.maxEntities = 200\n  options.maxEntitySize = 8\n  options.minEntitySize = 8\n  options.fps = 25\n\n  let be = new boids.boidEngine(ctx, options)\n\n  let randr = new rules.randomRule()\n  be.addRule(randr)\n\n  let socr = new rules.socialRule();\n  be.addRule(socr)\n\n  let avr = new rules.avoidanceRule()\n  be.addRule(avr)\n\n  let sickr = new rules.sicknessRule()\n  be.addRule(sickr)\n\n  window.infectOne = be.infectOne.bind(be)\n\n  // be.startRenderInterval(100)\n  // setInterval(be.reset.bind(be), 1000)\n  return be\n}\n\nlet _initParameterController = () => {\n  let param_container = document.getElementById('p_container')\n  let app_window = document.getElementById('window')\n\n\n  if(param_container && app_window){\n    param_container.style.maxHeight = 0.95*app_window.getBoundingClientRect().height + 'px';\n    let _ctrl = new ParameterController(param_container)\n  }\n}\n\nlet _initGrapher = (canvas: HTMLCanvasElement) => {\n\n  let container: HTMLElement|null = document.getElementById('graph_canvas_container')\n  if(!container) return\n\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n  let _grapher = new grapher(ctx)\n  return _grapher\n}\n\nlet _initControls = (be: boids.boidEngine, gr: grapher) => {\n  let btnRestart: HTMLElement|null = document.getElementById('btn_restart')\n  if(btnRestart){\n    btnRestart.onclick = () => {\n      if(!btnRestart) return\n      be.restart()\n      gr.reset()\n    }\n  }\n}\n\nlet main = () => {\n  /* This is a fix for CSS-Scaling on PCs */\n  // if(navigator.userAgent.match(/Android/i)\n  // || navigator.userAgent.match(/webOS/i)\n  // || navigator.userAgent.match(/iPhone/i)\n  // || navigator.userAgent.match(/iPad/i)\n  // || navigator.userAgent.match(/iPod/i)\n  // || navigator.userAgent.match(/BlackBerry/i)\n  // || navigator.userAgent.match(/Windows Phone/i)) {\n  //   console.log('Running on mobile, not applying viewport fix.')\n  // }else{\n  //   document.write('<meta name=\"viewport\" content=\"width=device-width, height=device-height, initial-scale=1\">');\n  // }\n\n  _initParameterController()\n\n  let be = null, gr = null\n\n  //get the grapher canvas element\n  let grapherCanvasElement: HTMLCanvasElement|null = document.getElementById('graph_canvas') as HTMLCanvasElement\n  if(grapherCanvasElement) gr = _initGrapher(grapherCanvasElement)\n\n  // get the canvas element\n  let canvasElement: HTMLCanvasElement|null = document.getElementById('canvas') as HTMLCanvasElement\n  if(canvasElement) be = _initPandaemicApplication(canvasElement)\n\n  if(be && gr){\n    _initControls(be, gr)\n  }\n\n  /*\n  for(let i=0; i<20; i++){\n    let param = new parameter(0, 1, parameter_type.universal, `rule_${i}`)\n  }\n  */\n\n}\n\nwindow.onload = main\n","import { vec2, rect, parameter, parameter_type } from \"./utils\";\r\nimport { boidRule, distanceAccelerator, distanceElement} from './boidRules'\r\nimport { sickness, sickness_state } from './pandemic'\r\n\r\nimport { graphedVariable } from './grapher'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class boidEngineConfig {\r\n  maxEntities: number = 500;\r\n  minEntitySize: number = 3;\r\n  maxEntitySize: number = 3;\r\n\r\n  fps: number|null = null;\r\n\r\n  continuum: boolean = true;\r\n}\r\n\r\nexport class boidRuleConfig {\r\n\r\n}\r\n\r\nexport class boidEngine {\r\n\r\n  nEntities: parameter\r\n  ctx: CanvasRenderingContext2D\r\n\r\n  size: vec2\r\n  bound_size: vec2\r\n  _hbs: vec2\r\n\r\n  entity_size: parameter\r\n\r\n  entities: boid[]\r\n  entitiesToBeRemoved: boid[] = []\r\n  resetInNext: boolean = false\r\n\r\n  renderIntervalID: timerHandle|null = null\r\n  updateIntervalID: timerHandle|null = null\r\n  updateInterval: number = 0;\r\n\r\n  entitiesToInfect: parameter\r\n\r\n  rules: boidRule[] = []\r\n\r\n  continuum: boolean;\r\n\r\n  // graphed data:\r\n  gv_EntitiesAlive: graphedVariable\r\n  gv_EntitiesInfected: graphedVariable\r\n  gv_EntitiesSick: graphedVariable\r\n  gv_EntitesImmune: graphedVariable\r\n  gv_EntitiesDead: graphedVariable\r\n\r\n  // Initialization\r\n\r\n  constructor(ctx: CanvasRenderingContext2D, options: boidEngineConfig = new boidEngineConfig()){\r\n    this.ctx = ctx\r\n\r\n    this.nEntities = new parameter(10, options.maxEntities, parameter_type.universal, 'nEntities')\r\n    this.nEntities.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    let eps = parameter.getParameterByName('EntitySize')\r\n    this.entity_size = (eps)? eps :  new parameter(options.minEntitySize, options.maxEntitySize, parameter_type.entity_scoped, 'EntitySize')\r\n    this.entity_size.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    this.entitiesToInfect = parameter.getParameterByNameOrCreate('# Infected at Start', parameter_type.universal, 0, 10)\r\n\r\n    this.continuum = options.continuum\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n    this.entities = []\r\n\r\n    this._initBoids()\r\n\r\n    if(options.fps){\r\n      let frametime = 1000/options.fps;\r\n      this.startRenderInterval(frametime)\r\n      this.startUpdateInterval(frametime)\r\n      this.updateInterval = frametime;\r\n    }\r\n    this.gv_EntitiesAlive = graphedVariable.getGraphVariableByNameOrCreate('Entites Alive', '#198c19')\r\n    this.gv_EntitiesInfected = graphedVariable.getGraphVariableByNameOrCreate('Entites Infected' , '#73e500')\r\n    this.gv_EntitiesSick = graphedVariable.getGraphVariableByNameOrCreate('Entites Sick', '#ff4c4c')\r\n    this.gv_EntitesImmune = graphedVariable.getGraphVariableByNameOrCreate('Entites Immune', '#004c00')\r\n    this.gv_EntitiesDead = graphedVariable.getGraphVariableByNameOrCreate('Entities Dead', '#b20000')\r\n\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n  }\r\n\r\n  infectOne(){\r\n    let idx = Math.floor(this.entities.length * Math.random())\r\n    this.entities[idx].setImmuneSystemState(sickness_state.incubating)\r\n  }\r\n\r\n  boidStateUpdateHandler(entity: boid, state: sickness_state){\r\n    // console.log(`boid #${entity.id} state is now: ${state}`)\r\n    if(state === sickness_state.deceased){\r\n      //console.log 'removing boid'\r\n      this.entitiesToBeRemoved.push(entity)\r\n    }\r\n  }\r\n\r\n  _generateNewBoid(){\r\n    let id = this.entities.length\r\n    // choose a new starting point randomly :)\r\n    let _x = Math.random()\r\n    let _y = Math.random()\r\n    let _pos = new vec2(_x, _y).scl(this.bound_size)\r\n\r\n    // generate a new entity\r\n    let _ent = new boid(_pos, this.entity_size, id)\r\n\r\n    _ent.onImmuneSystemStateUpdated = this.boidStateUpdateHandler.bind(this, _ent)\r\n\r\n    this.entities.push(_ent)\r\n  }\r\n\r\n  _initBoids(){\r\n    for(let i=0; i<this.nEntities.getValue(); i++){\r\n      this._generateNewBoid()\r\n    }\r\n    for(let i =0; i<this.entitiesToInfect.getValue(); i++){\r\n      this.infectOne()\r\n    }\r\n  }\r\n\r\n  _parameterUpdateHandler(param: parameter){\r\n    switch(param.name){\r\n      case 'nEntities':\r\n        let n = param.getValue()\r\n        let diff = n - this.entities.length\r\n        for(let i=0; i<Math.abs(diff); i++) (diff > 0)? this._generateNewBoid() : this.entities.pop()\r\n      break;\r\n      case 'EntitySize':\r\n        this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Render/Update Intervals\r\n\r\n  startRenderInterval(interval: number){\r\n    if(this.renderIntervalID !== null){\r\n      clearInterval(this.renderIntervalID)\r\n    }\r\n    this.renderIntervalID = setInterval(this._render.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  stopRenderInterval(){\r\n    if(this.renderIntervalID){\r\n      clearInterval(this.renderIntervalID)\r\n      this.renderIntervalID = null\r\n    }\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this._update.bind(this), interval) as unknown as number\r\n\r\n    this.updateInterval = interval\r\n  }\r\n\r\n  stopUpdateInterval(){\r\n    if(this.updateIntervalID){\r\n      clearInterval(this.updateIntervalID)\r\n      this.updateIntervalID = null\r\n    }\r\n  }\r\n\r\n  // interface Methods\r\n\r\n  reset(){\r\n    this.entities = []\r\n    this._initBoids()\r\n  }\r\n\r\n  addRule(_rule: boidRule){\r\n    console.log(_rule)\r\n    this.rules.push(_rule)\r\n  }\r\n\r\n  clearRules(){\r\n    this.rules = []\r\n  }\r\n\r\n  // Render/Update Methods\r\n\r\n  _render(){\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\r\n    let id=0\r\n    for(let entity of this.entities){\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI, false);\r\n      switch(entity.immuneState){\r\n        case sickness_state.cured:\r\n        this.ctx.fillStyle = '#004c00';\r\n        break;\r\n\r\n        case sickness_state.healthy:\r\n        this.ctx.fillStyle = '#198c19';\r\n        break;\r\n\r\n        case sickness_state.incubating:\r\n        this.ctx.fillStyle = '#ffff7f';\r\n        break;\r\n\r\n        case sickness_state.sick:\r\n        this.ctx.fillStyle = '#ff4c4c';\r\n        break;\r\n      }\r\n\r\n      this.ctx.fill();\r\n\r\n      this.ctx.beginPath();\r\n      this.ctx.strokeStyle = '#2a4e6c'\r\n      this.ctx.lineWidth = 0.3;\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI);\r\n      this.ctx.stroke();\r\n      id ++\r\n    }\r\n  }\r\n\r\n  _updateGraphData(){\r\n    let nEntitesMax = this.nEntities.getValue()\r\n    let nAlive: number = this.entities.length\r\n    let nInfected: number = 0\r\n    let nSick: number = 0\r\n    let nImmune: number = 0\r\n    let nDead: number = nEntitesMax - this.entities.length\r\n\r\n    for(let ent of this.entities){\r\n      switch(ent.immuneState){\r\n        case sickness_state.cured:\r\n          nImmune ++\r\n          break;\r\n        case sickness_state.incubating:\r\n          nInfected ++\r\n          break;\r\n        case sickness_state.sick:\r\n          nSick ++\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.gv_EntitiesAlive.appendValue(nAlive)\r\n    this.gv_EntitiesInfected.appendValue(nInfected)\r\n    this.gv_EntitiesSick.appendValue(nSick)\r\n    this.gv_EntitesImmune.appendValue(nImmune)\r\n    this.gv_EntitiesDead.appendValue(nDead)\r\n  }\r\n\r\n  _update(){\r\n    if(this.resetInNext){\r\n      this.entities = []\r\n      this._initBoids()\r\n      this.resetInNext = false;\r\n    }\r\n\r\n    if(this.entities.length > 0) this._updateGraphData();\r\n    for(let ent of this.entitiesToBeRemoved){\r\n      this.entities.splice(this.entities.indexOf(ent), 1)\r\n    }\r\n    this.entitiesToBeRemoved = []\r\n    //console.log('stepping panda')\r\n    let diff = this.updateInterval;\r\n    //TODO calulate distance matrix\r\n    let distMatrix = distanceAccelerator(this.entities)\r\n    //let rules_list = [rules.socialRule, rules.randomRule, rules.makeBorderRule(this.size)]\r\n\r\n    for(let entity of this.entities){\r\n      entity.update(diff, this.entities, distMatrix, this.rules)\r\n    }\r\n\r\n    if(this.continuum){\r\n      let id = 0\r\n      for(let entity of this.entities){\r\n        let point = entity.position\r\n        if(point.x < -this.entity_size){\r\n          entity.position.x += this.size.x + entity.size\r\n        }else if (point.x > (this.size.x + this.entity_size.getValue(id))){\r\n          entity.position.x -= this.size.x + entity.size\r\n        }\r\n\r\n        if(point.y < -this.entity_size){\r\n          entity.position.y += this.size.y + entity.size\r\n        }else if (point.y > (this.size.y + this.entity_size.getValue(id))){\r\n          entity.position.y -= this.size.y + entity.size\r\n        }\r\n        id ++\r\n      }\r\n    }\r\n  }\r\n\r\n  restart(){\r\n    console.log('restarting be')\r\n\r\n    this.resetInNext = true\r\n\r\n    this.gv_EntitiesAlive.resetData()\r\n    this.gv_EntitiesInfected.resetData()\r\n    this.gv_EntitiesSick.resetData()\r\n    this.gv_EntitesImmune.resetData()\r\n    this.gv_EntitiesDead.resetData()\r\n  }\r\n\r\n}\r\n\r\nlet limit = (min: number, max: number, val:number) => {\r\n  if(val < min) return min\r\n  if(val > max) return max\r\n  return val\r\n}\r\n\r\nlet limit_vec_len = (vec:vec2, limit:number) => {\r\n  let len = vec.len()\r\n  if(len>limit) return vec.norm().scl(limit)\r\n  return vec\r\n}\r\n\r\nexport class boid {\r\n  position: vec2\r\n  velocity: vec2 = new vec2()\r\n  state: string\r\n  _size: parameter\r\n\r\n  id: number\r\n\r\n  acceleration: parameter\r\n  speed: parameter\r\n\r\n  infection: sickness\r\n  ImmuneSystemStateUpdateHandler: any | null\r\n\r\n  constructor(pos: vec2 = new vec2(), size:parameter, id:number=0) {\r\n    this.position = pos\r\n    this._size = size\r\n    this.state = 'base'\r\n\r\n    this.id = id\r\n\r\n    this.acceleration = parameter.getParameterByNameOrCreate('Entity Acceleration', parameter_type.universal, 15, 25)\r\n    this.speed = parameter.getParameterByNameOrCreate('Entity Speed', parameter_type.universal, 15, 20)\r\n\r\n    this.infection = new sickness()\r\n  }\r\n\r\n  update(diff: number, entities:boid[], distanceMatrix:distanceElement[][], rules: boidRule[]){\r\n    let walk_dir = new vec2()\r\n\r\n    for(let idx=0; idx < rules.length; idx ++){\r\n      let rule = rules[idx]\r\n\r\n      // get the corresponding parameter :)\r\n      let rule_dir = rule.executeRule(this, entities, distanceMatrix)\r\n      rule_dir = rule.weightRule(rule_dir, this)\r\n      walk_dir = walk_dir.add(rule_dir)\r\n    }\r\n    let walk_acc = walk_dir.norm().scl(this.acceleration.getValue() * diff/1000)\r\n    this.velocity = this.velocity.add(walk_acc)\r\n    this.velocity = limit_vec_len(this.velocity, this.speed.getValue())\r\n\r\n    let new_position = this.position.add(this.velocity.scl(diff/1000))\r\n    // console.log(new_position.sub(this.position).len())\r\n\r\n    this.position = this._resolveCollisions(new_position, walk_dir, entities)\r\n\r\n    this.infection.update(diff)\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    this.infection.inVirusVicinity()\r\n  }\r\n\r\n  setImmuneSystemState(state: sickness_state){\r\n    this.infection.state = state\r\n  }\r\n\r\n  // TODO move this to the engine :)\r\n  _resolveCollisions(newpos: vec2, walk_dir: vec2, entities:boid[]): vec2{\r\n    // could be sped up by only checking entities which were in the neighborhood before via max_walk_dist & distanceMatrix\r\n\r\n    let nEntities = entities.length\r\n\r\n    for(let i=0; i<nEntities; i++){\r\n      let entity = entities[i]\r\n      if(entity === this) continue\r\n      let dvec = entities[i].position.sub(newpos)\r\n      let len = dvec.len()\r\n\r\n      let mindist = this.size/2 + entities[i].size/2\r\n      if(len < mindist){\r\n        let resolve_vector = dvec.norm().scl(mindist - len)\r\n        // entities[i].position = entities[i].position.add(dvec.scl(0.25))\r\n        newpos = newpos.sub(resolve_vector)\r\n      }\r\n    }\r\n\r\n    return newpos\r\n  }\r\n\r\n  get size(): number{\r\n    return this._size.getValue(this.id)\r\n  }\r\n\r\n  get immuneState(){\r\n    return this.infection.state\r\n  }\r\n\r\n  set onImmuneSystemStateUpdated(callback: any){\r\n    this.infection.onStateUpdated = callback\r\n  }\r\n\r\n}\r\n\r\n/*\r\n\r\n\r\nsize: vec2\r\nbound_size: vec2\r\n_hbs: vec2\r\nentities: pandaEntity[]\r\n\r\nconstructor(ctx: CanvasRenderingContext2D, n: number){\r\n\r\n\r\n  this.ctx = ctx\r\n*/\r\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport class ParameterControl {\r\n  controller: ParameterController\r\n  controlledParameter: parameter\r\n\r\n  minElement: HTMLInputElement|null = null\r\n  maxElement: HTMLInputElement|null = null\r\n  valueSlider: HTMLInputElement|null = null\r\n\r\n  constructor(controller: ParameterController, param: parameter){\r\n    this.controller = controller\r\n    this.controlledParameter = param\r\n    this.createUIElement()\r\n    this.attachListeners()\r\n  }\r\n\r\n  createUIElement(){\r\n    let listElem = document.createElement('li');\r\n    listElem.className = ''\r\n    let param_ctrl = document.createElement('div')\r\n    param_ctrl.className = 'param_options | no_select'\r\n    param_ctrl.innerText = this.controlledParameter.name + '\\n'\r\n\r\n    if(this.controlledParameter.type === parameter_type.entity_scoped ||\r\n       this.controlledParameter.type === parameter_type.universal){\r\n\r\n         let label_min: HTMLLabelElement = document.createElement('label')\r\n         label_min.htmlFor = `${this.controlledParameter.name}_min`\r\n         label_min.innerText = 'min:'\r\n         let input_min: HTMLInputElement = document.createElement('input')\r\n         input_min.name = `${this.controlledParameter.name}_min`\r\n         input_min.type = 'number'\r\n         input_min.value = this.controlledParameter.min + ''\r\n\r\n         let br_el = document.createElement('br')\r\n\r\n         let label_max: HTMLLabelElement = document.createElement('label')\r\n         label_max.htmlFor = `${this.controlledParameter.name}_max`\r\n         label_max.innerText = 'max:'\r\n         let input_max: HTMLInputElement = document.createElement('input')\r\n         input_max.name = `${this.controlledParameter.name}_max`\r\n         input_max.type = 'number'\r\n         input_max.value = this.controlledParameter.max + ''\r\n\r\n         this.minElement = input_min\r\n         this.maxElement = input_max\r\n\r\n         param_ctrl.appendChild(label_min)\r\n         param_ctrl.appendChild(input_min)\r\n         param_ctrl.appendChild(br_el)\r\n         param_ctrl.appendChild(label_max)\r\n         param_ctrl.appendChild(input_max)\r\n    }\r\n    listElem.appendChild(param_ctrl)\r\n\r\n    if(this.controlledParameter.type === parameter_type.universal ||\r\n       this.controlledParameter.type === parameter_type.universal_percentage){\r\n      let param_setpoint = document.createElement('div')\r\n      param_setpoint.className = 'param_setpoint'\r\n\r\n      let param_slider: HTMLInputElement = document.createElement('input')\r\n      param_slider.type = 'range'\r\n      param_slider.min = '0'\r\n      param_slider.max = '1000'\r\n      param_slider.value = '500'\r\n\r\n      param_setpoint.appendChild(param_slider)\r\n\r\n      listElem.appendChild(param_setpoint)\r\n      this.valueSlider = param_slider\r\n    }\r\n    this.controller.addUIElement(listElem)\r\n  }\r\n\r\n  attachListeners(){\r\n    if(this.minElement){\r\n      let _el: HTMLInputElement = this.minElement\r\n      this.minElement.onchange = () => { this.controlledParameter.setMin(parseInt(_el.value)) }\r\n    }\r\n\r\n    if(this.maxElement){\r\n      let _el: HTMLInputElement = this.maxElement\r\n      this.maxElement.onchange = () => { this.controlledParameter.setMax(parseInt(_el.value)) }\r\n    }\r\n\r\n    if(this.valueSlider){\r\n      let _el: HTMLInputElement = this.valueSlider\r\n      this.valueSlider.onchange = () => {\r\n        let val: number = parseInt(_el.value)/1000.0\r\n        val *= this.controlledParameter.max - this.controlledParameter.min\r\n        val += this.controlledParameter.min\r\n        this.controlledParameter.setValue(val)\r\n       }\r\n    }\r\n  }\r\n}\r\n\r\nexport class ParameterController {\r\n  parameter_container: HTMLElement\r\n  controlElements: ParameterControl[]\r\n\r\n  constructor(container: HTMLElement){\r\n    this.parameter_container = container\r\n    parameter.emitter.on('paramAdded', this.parameterAddHandler.bind(this))\r\n\r\n    this.controlElements = []\r\n  }\r\n\r\n  parameterAddHandler(param: parameter){\r\n    let _ctrl = new ParameterControl(this, param)\r\n    this.controlElements.push(_ctrl)\r\n  }\r\n\r\n  addUIElement(element: HTMLElement){\r\n    this.parameter_container.appendChild(element)\r\n  }\r\n\r\n}\r\n"],"sourceRoot":""}