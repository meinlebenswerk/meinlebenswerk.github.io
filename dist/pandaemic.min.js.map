{"version":3,"sources":["webpack://pandaemic_lib/webpack/bootstrap","webpack://pandaemic_lib/./src/utils.ts","webpack://pandaemic_lib/(webpack)/buildin/global.js","webpack://pandaemic_lib/./node_modules/events/events.js","webpack://pandaemic_lib/./src/boidRules.ts","webpack://pandaemic_lib/./src/pandemic.ts","webpack://pandaemic_lib/./src/color.ts","webpack://pandaemic_lib/./src/grapher.ts","webpack://pandaemic_lib/./src/index.ts","webpack://pandaemic_lib/./src/boids.ts","webpack://pandaemic_lib/./node_modules/timers-browserify/main.js","webpack://pandaemic_lib/./node_modules/setimmediate/setImmediate.js","webpack://pandaemic_lib/./node_modules/process/browser.js","webpack://pandaemic_lib/./src/parametercontrol.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","vec2","x","y","sub","this","add","scl","len","Math","sqrt","norm","fn","a","min","v","max","dot","rect","pos","size","position","center","isInside","point","insideX","insideY","parameter_type","parameter","type","nparam","dependecies","universal_percentage","getParameterByName","_values","entity_scoped","registerDependency","_updateHandler","getValue","push","_randomValue","paramList","emitter","emit","param","length","diff","abs","pop","_updateValues","_i","_a","cb","setImmediate","rnd","random","callback","valueOf","id","universal","setValue","val","setMin","setMax","getParametersByName","params","getParameterByNameOrCreate","_param","getParameters","EventEmitter","ruler","checkLength","str","fontStyle","element","_getElement","style","font","innerHTML","offsetWidth","checkHeight","offsetHeight","document","createElement","body","appendChild","visibility","top","whiteSpace","g","Function","e","window","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","init","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","prepend","events","existing","warning","newListener","unshift","warned","w","Error","String","count","console","warn","onceWrapper","fired","removeListener","wrapFn","arguments","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","err","message","context","handler","listeners","addListener","on","prependListener","once","prependOnceListener","list","originalListener","shift","index","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","distanceAccelerator","entities","distMatrix","tmp","ii","dvec","dist","vec","extendStatics","__extends","b","setPrototypeOf","__proto__","__","constructor","distanceElement","boidRule","ruleName","log","executeRule","entity","distanceMatrix","weightRule","dir","weightParamNormal","weightParamSick","weightParam","immuneState","immune_system_state","sick","socialRule","_super","_this","view_distance","entity_size","nEntities","viewDistance","rule_dir","_entity","randomRule","avoidanceRule","avoidance_distance","avoidanceDistance","sicknessRule","infection_distance","infecting","incubating","infectionDistance","inVirusVicinity","immune_system","mortality_rate","infection_rate","incubation_time","healing_time","immune_time","_state","healthy","timer","makeSick","deceased","newstate","onStateUpdated","configurable","update","immune","infectable","AppColors","infected","dead","outline","fontColor","graphedVariable","color","values","variableList","appendValue","resetData","event","getGraphVariableByName","vars","variable","getGraphVariableByNameOrCreate","_var","getGraphedVariables","grapher","ctx","sizeChanged","margin","varNamesWidthPx","fontSizePt","colorDotSizePx","varNameSizePx","legendSize","legendMarkerHeight","nRows","dataChanged","updateIntervalID","minVal","maxVal","boundsChanged","width","canvas","height","varUpdatedListener","varAddedListener","stepSize","rowSize","yScale","xScale","startUpdateInterval","redrawLegend","addEventListener","setTimeout","resizeEvent","_updateLengendSizing","fontsize_px","toFixed","maxSizePx","nameSizePx","newval","interval","clearInterval","setInterval","clearRect","plotAllGraphVariables","fillStyle","idx","offset","fillText","beginPath","arc","PI","fill","strokeStyle","ySize","scale","moveTo","lineTo","stroke","translate","variables_1","gv","plotData","data","dataSet","sections","reset","boids","rules","initCanvas","canvasElement","container","canvasContext","getContext","resizeHandler","h","clientHeight","clientWidth","onload","param_container","getElementById","app_window","maxHeight","getBoundingClientRect","ParameterController","_initParameterController","be","gr","grapherCanvasElement","_initGrapher","options","boidEngineConfig","maxEntities","maxEntitySize","minEntitySize","fps","boidEngine","randr","addRule","socr","avr","sickr","infectOne","_initPandaemicApplication","btnRestart","onclick","restart","_initControls","scrollTo","continuum","boidRuleConfig","entitiesToBeRemoved","resetInNext","renderIntervalID","updateInterval","_parameterUpdateHandler","eps","entitiesToInfect","bound_size","_hbs","_initBoids","frametime","startRenderInterval","gv_EntitiesAlive","gv_EntitiesInfected","gv_EntitiesSick","gv_EntitesImmune","gv_EntitiesDead","floor","setImmuneSystemState","boidStateUpdateHandler","_generateNewBoid","_x","_y","_pos","_ent","boid","onImmuneSystemStateUpdated","_render","stopRenderInterval","_update","stopUpdateInterval","_rule","clearRules","lineWidth","_updateGraphData","nEntitesMax","nAlive","nInfected","nSick","nImmune","nDead","ent","splice","indexOf","_b","_c","_d","_e","velocity","_size","acceleration","speed","immuneSystem","walk_dir","rule","walk_acc","limit","limit_vec_len","new_position","_resolveCollisions","newpos","mindist","resolve_vector","self","Timeout","clearFn","_id","_clearFn","scope","clearTimeout","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","global","clearImmediate","registerImmediate","html","channel","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","attachTo","toString","process","handle","nextTick","runIfPresent","postMessage","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","port2","documentElement","script","onreadystatechange","removeChild","source","slice","attachEvent","task","run","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","currentQueue","queue","draining","queueIndex","cleanUpNextTick","drainQueue","marker","runClearTimeout","Item","array","noop","title","browser","env","argv","version","versions","binding","cwd","chdir","umask","ParameterControl","controller","minElement","maxElement","valueSlider","controlledParameter","createUIElement","attachListeners","listElem","className","param_ctrl","innerText","label_min","htmlFor","input_min","br_el","label_max","input_max","param_setpoint","param_slider","addUIElement","_el_1","onchange","parseInt","_el_2","_el_3","parameter_container","parameterAddHandler","controlElements","_ctrl"],"mappings":"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","file":"pandaemic.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","import { EventEmitter } from 'events'\r\n\r\nexport class vec2 {\r\n  x: number\r\n  y: number\r\n\r\n  constructor(x:number|null = 0, y:number|null = 0){\r\n    x = x || 0\r\n    y = y || 0\r\n\r\n    this.x = x\r\n    this.y = y\r\n  }\r\n\r\n  sub(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x - x.x, this.y - x.y)\r\n    }\r\n\r\n    y = y || x\r\n\r\n    return new vec2(this.x - x, this.y - y)\r\n  }\r\n\r\n  add(x:number|vec2, y:number = 0):vec2{\r\n    if(typeof x === 'object'){\r\n      return new vec2(this.x + x.x, this.y + x.y)\r\n    }\r\n\r\n    return new vec2(this.x + x, this.y + y)\r\n  }\r\n\r\n  scl(s:number|vec2 = 0): vec2{\r\n    if(typeof s === 'object'){\r\n      return new vec2(this.x*s.x, this.y*s.y)\r\n    }\r\n\r\n    return new vec2(this.x*s, this.y*s)\r\n  }\r\n\r\n  len():number{\r\n    return Math.sqrt(this.x*this.x + this.y*this.y)\r\n  }\r\n\r\n  norm():vec2{\r\n    let l = this.len()\r\n    if(l === 0) return new vec2(0, 0)\r\n    return new vec2(this.x/l, this.y/l)\r\n  }\r\n\r\n  fn(a:any):vec2{\r\n    return new vec2(a(this.x), a(this.y))\r\n  }\r\n\r\n  min(v: vec2){\r\n    return new vec2(Math.min(this.x, v.x), Math.min(this.x, v.y))\r\n  }\r\n\r\n  max(v: vec2){\r\n    return new vec2(Math.max(this.x, v.x), Math.max(this.x, v.y))\r\n  }\r\n\r\n  dot(v: vec2){\r\n    return this.x*v.x + this.y*v.y\r\n  }\r\n\r\n}\r\n\r\nexport class rect {\r\n  size: vec2\r\n  position: vec2\r\n\r\n  center: vec2\r\n\r\n  constructor(pos: vec2, size: vec2){\r\n    this.position = pos\r\n    this.size = size\r\n\r\n    this.center = this.position.add(this.size).scl(1/2)\r\n  }\r\n\r\n  isInside(point: vec2){\r\n    let insideX = (point.x > this.position.x) && (point.x < (this.position.x + this.size.x))\r\n    let insideY = (point.y > this.position.y) && (point.y < (this.position.y + this.size.y))\r\n    return insideX && insideY\r\n  }\r\n\r\n\r\n}\r\n\r\nexport enum parameter_type {\r\n  universal,\r\n  entity_scoped,\r\n  universal_percentage\r\n}\r\n\r\nexport class parameter {\r\n  static paramList: parameter[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  min: number\r\n  max: number\r\n  type: parameter_type\r\n  name: string\r\n\r\n  value: number\r\n  _values: number[]\r\n\r\n  dependecies: any[] = []\r\n\r\n  n: parameter|null\r\n\r\n  constructor(min: number, max:number, type: parameter_type, name: string = 'none', nparam: parameter|null = null){\r\n    if(type === parameter_type.universal_percentage){\r\n      // ignore min / max assignment\r\n      this.min = 0\r\n      this.max = 1\r\n    } else {\r\n      this.min = Math.min(min, max)\r\n      this.max = Math.max(min, max)\r\n    }\r\n\r\n    this.type = type\r\n    this.name = name\r\n\r\n    this.n = nparam || parameter.getParameterByName('nEntities')\r\n\r\n    this.value = (this.max - this.min)/2 + this.min\r\n    this._values = []\r\n    if(this.type === parameter_type.entity_scoped){\r\n      if(this.n){\r\n        this.n.registerDependency(this._updateHandler.bind(this))\r\n        for(let i=0; i<this.n.getValue(); i++){\r\n          this._values.push(this._randomValue())\r\n        }\r\n      }\r\n    }\r\n\r\n    parameter.paramList.push(this)\r\n    // console.log(parameter.paramList)\r\n    parameter.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  _updateHandler(param: parameter|null = null){\r\n    if(param && param.name === 'nEntities'){\r\n      let n = this._values.length\r\n      let diff = param.getValue() - n\r\n      for(let i=0; i<Math.abs(diff); i++) (diff>0)? this._values.push(0) : this._values.pop()\r\n    }\r\n\r\n    //update all values\r\n    this._updateValues()\r\n\r\n    // pass change event onto dependencies :)\r\n    for(let cb of this.dependecies){\r\n      setImmediate(cb, this)\r\n    }\r\n  }\r\n\r\n  _randomValue(): number{\r\n    let rnd:number = Math.random()\r\n    let val:number = (this.max - this.min)*rnd + this.min\r\n    return val\r\n  }\r\n\r\n  _updateValues(){\r\n    if(this.n){\r\n      for(let i=0; i<this.n.getValue(); i++){\r\n        this._values[i] = this._randomValue()\r\n      }\r\n    }\r\n  }\r\n\r\n  registerDependency(callback: any){\r\n    this.dependecies.push(callback)\r\n  }\r\n\r\n  valueOf(): number{\r\n    return 10\r\n  }\r\n\r\n  getValue(id: number = 0): number {\r\n    switch(this.type){\r\n      case parameter_type.universal:\r\n      case parameter_type.universal_percentage:\r\n        return this.value\r\n      case parameter_type.entity_scoped:\r\n        if(id < 0) id = 0\r\n        if(id >= this._values.length) id = this._values.length-1\r\n        return this._values[id]\r\n    }\r\n    return 0\r\n  }\r\n\r\n  setValue(val: number){\r\n    if(val > this.max) val = this.max\r\n    if(val < this.min) val = this.min\r\n    this.value = val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMin(val: number){\r\n    this.min = (this.type === parameter_type.universal_percentage)? 0 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n  setMax(val: number){\r\n    this.max = (this.type === parameter_type.universal_percentage)? 1 : val\r\n    this._updateHandler()\r\n  }\r\n\r\n\r\n\r\n\r\n  static getParametersByName(name: string){\r\n    let params:parameter[] = []\r\n    for(let param of parameter.paramList){\r\n      if(param.name === name) params.push(param)\r\n    }\r\n    return params\r\n  }\r\n\r\n  static getParameterByName(name: string): parameter|null{\r\n    return this.getParametersByName(name)[0]\r\n  }\r\n\r\n  static getParameterByNameOrCreate(name: string, type:parameter_type=parameter_type.entity_scoped, min:number=0, max:number= 1): parameter{\r\n    let _param = this.getParametersByName(name)[0]\r\n    if(!_param){\r\n      _param = new parameter(min, max, type, name)\r\n    }\r\n\r\n    return _param\r\n  }\r\n\r\n  static getParameters(){\r\n    return parameter.paramList\r\n  }\r\n\r\n}\r\n\r\nexport class ruler {\r\n  static element: HTMLElement|null\r\n  static checkLength(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetWidth\r\n  }\r\n\r\n  static checkHeight(str: string, fontStyle: string){\r\n    if(!ruler.element){\r\n      ruler._getElement()\r\n    }\r\n    if(!ruler.element) return 0\r\n    ruler.element.style.font = fontStyle\r\n    ruler.element.innerHTML = str\r\n    return ruler.element.offsetHeight\r\n  }\r\n\r\n  static _getElement(){\r\n    // document.write('<span id=\"ruler\"></span>')\r\n    ruler.element = document.createElement('span') as HTMLElement\r\n    document.body.appendChild(ruler.element)\r\n    ruler.element.style.visibility = 'hidden'\r\n    ruler.element.style.position = 'absolute'\r\n    ruler.element.style.top = '0'\r\n    ruler.element.style.whiteSpace = 'nowrap'\r\n  }\r\n}\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","import { boid } from './boids'\r\nimport { vec2, rect, parameter, parameter_type } from './utils'\r\nimport { immune_system, immune_system_state } from './pandemic'\r\n\r\nexport class distanceElement{\r\n  dist: number = 0\r\n  vec: vec2 = new vec2()\r\n}\r\n\r\nexport function distanceAccelerator(entities: boid[]): distanceElement[][]{\r\n  let n = entities.length\r\n  let distMatrix: distanceElement [][] = []\r\n\r\n\r\n  let tmp: distanceElement[] = []\r\n  for(let i=0; i<n; i++){\r\n    tmp = []\r\n    // for(let ii=0; ii<n; ii++){\r\n    //   tmp.push({dist: 0, vec: new vec2()})\r\n    // }\r\n    distMatrix.push(tmp)\r\n  }\r\n\r\n  for(let i=0; i<n; i++){\r\n    for(let ii=i; ii<n; ii++){\r\n      let dvec = entities[i].position.sub(entities[ii].position)\r\n      let dist = dvec.len()\r\n      distMatrix[i][ii] = {dist:dist, vec: dvec}\r\n      distMatrix[ii][i] = {dist:dist, vec: dvec.scl(-1)}\r\n    }\r\n  }\r\n  return distMatrix\r\n}\r\n\r\nexport class boidRule {\r\n  ruleName: string;\r\n\r\n  constructor(name:string){\r\n    this.ruleName = name;\r\n    console.log('Constructed new rule w/ name:', name)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2{\r\n    console.log('Excuting base rule :)')\r\n    return new vec2()\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    let weightParamNormal = parameter.getParameterByNameOrCreate(`${this.ruleName} weight`)\r\n    let weightParamSick = parameter.getParameterByNameOrCreate(`${this.ruleName} weight (sick)`)\r\n\r\n    let weightParam = (entity.immuneState === immune_system_state.sick)? weightParamSick : weightParamNormal\r\n    return dir.scl(weightParam.getValue(entity.id))\r\n  }\r\n\r\n}\r\n\r\nexport class socialRule extends boidRule{\r\n\r\n  view_distance: parameter\r\n  entity_size: parameter\r\n\r\n  constructor(){\r\n    super('SocialRule')\r\n    this.view_distance = parameter.getParameterByNameOrCreate('View Distance', parameter_type.universal, 10, 30)\r\n    this.entity_size = parameter.getParameterByNameOrCreate('EntitySize', parameter_type.universal, 4, 8)\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities = distanceMatrix.length\r\n    let viewDistance = this.view_distance.getValue()\r\n\r\n    let rule_dir = new vec2()\r\n    for(let i:number=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = entity.position.sub(_entity.position)\r\n      if(dist.len() < viewDistance){\r\n        // if(dist <= this.entity_size.getValue(id)*1.2) continue\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 1/e))\r\n      }\r\n    }\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\nexport class randomRule extends boidRule{\r\n\r\n  constructor(){\r\n    super('randomRule')\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let x = (Math.random() - 0.5) * 2\r\n    let y = (Math.random() - 0.5) * 2\r\n\r\n    let rule_dir = new vec2(x, y)\r\n    return rule_dir.norm()\r\n}\r\n\r\n}\r\n\r\nexport class avoidanceRule extends boidRule{\r\n  avoidance_distance: parameter;\r\n\r\n\r\n  constructor(){\r\n    super('avoidanceRule')\r\n\r\n    this.avoidance_distance = parameter.getParameterByNameOrCreate('Avoidance Distance', parameter_type.universal, 10, 30)\r\n\r\n  }\r\n\r\n  executeRule(entity:boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let avoidanceDistance = this.avoidance_distance.getValue()\r\n\r\n    let rule_dir: vec2 = new vec2()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = _entity.position.sub(entity.position)\r\n      if(dist.len() < avoidanceDistance){\r\n        rule_dir = rule_dir.add(dist.fn((e:number) => 100 * 1/e))\r\n      }\r\n    }\r\n\r\n    return rule_dir.norm()\r\n  }\r\n\r\n}\r\n\r\n/*\r\nThis rule does not return a distance, but abuses the rule interface to handle infections...\r\n*/\r\nexport class sicknessRule extends boidRule{\r\n  infection_distance: parameter;\r\n\r\n  constructor(){\r\n    super('sicknessRule')\r\n    this.infection_distance = parameter.getParameterByNameOrCreate('Infection Distance', parameter_type.universal, 10, 15)\r\n  }\r\n\r\n  weightRule(dir: vec2, entity: boid): vec2{\r\n    return dir;\r\n  }\r\n\r\n  executeRule(entity: boid, entities: boid[], distanceMatrix:distanceElement[][]): vec2 {\r\n\r\n    let nEntities: number = distanceMatrix.length\r\n\r\n    let infecting = entity.immuneState === immune_system_state.incubating || entity.immuneState === immune_system_state.sick\r\n\r\n    let infectionDistance = this.infection_distance.getValue()\r\n\r\n    // TODO extract this into new method.\r\n    for(let i=0; i<nEntities; i++){\r\n      let _entity = entities[i]\r\n      if(entity === _entity) continue\r\n      //let distEl = distanceMatrix[entity.id][i]\r\n      let dist = entity.position.sub(_entity.position)\r\n\r\n      // let distEl: distanceElement = distanceMatrix[id][i]\r\n      if(dist.len() < infectionDistance && infecting){\r\n        // possibly infect the other boid...\r\n        let otherEntity = entities[i]\r\n        otherEntity.inVirusVicinity()\r\n      }\r\n    }\r\n\r\n    return new vec2()\r\n  }\r\n\r\n}\r\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport enum immune_system_state {\r\n  healthy,\r\n  incubating,\r\n  sick,\r\n  deceased,\r\n  immune\r\n}\r\n\r\nexport class immune_system {\r\n  mortality_rate: parameter\r\n  infection_rate: parameter\r\n  incubation_time: parameter\r\n  healing_time: parameter\r\n  immune_time: parameter\r\n\r\n  _state: immune_system_state\r\n  timer: number;\r\n\r\n  onStateUpdated: any|null;\r\n\r\n  constructor(){\r\n    this.mortality_rate = parameter.getParameterByNameOrCreate('Mortality Rate', parameter_type.universal_percentage)\r\n    this.infection_rate = parameter.getParameterByNameOrCreate('Infection Rate', parameter_type.universal_percentage)\r\n    this.incubation_time = parameter.getParameterByNameOrCreate('Incubation Time', parameter_type.universal, 0, 100)\r\n    this.healing_time = parameter.getParameterByNameOrCreate('Healing Time', parameter_type.universal, 0, 100)\r\n    this.immune_time = parameter.getParameterByNameOrCreate('Immune Time', parameter_type.universal, 0, 100)\r\n\r\n    this._state = immune_system_state.healthy\r\n    this.timer = 0\r\n  }\r\n\r\n  makeSick(){\r\n    if(this.state !== immune_system_state.deceased){\r\n      this.state = immune_system_state.sick;\r\n    }\r\n  }\r\n\r\n  set state(newstate: immune_system_state){\r\n    this._state = newstate\r\n    if(this.onStateUpdated) this.onStateUpdated(this._state)\r\n  }\r\n\r\n  get state(){\r\n    return this._state\r\n  }\r\n\r\n  update(diff: number){\r\n    switch(this.state){\r\n      case immune_system_state.healthy:\r\n        // do nothing :)\r\n      break;\r\n      case immune_system_state.incubating:\r\n        this.timer += diff\r\n        if(this.timer > this.incubation_time.getValue()*1000){\r\n          this.state = immune_system_state.sick\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case immune_system_state.sick:\r\n        this.timer += diff\r\n        if(this.timer > this.healing_time.getValue()*1000){\r\n          let rnd = Math.random()\r\n          if(rnd > this.mortality_rate.getValue()){\r\n            this.state = immune_system_state.immune\r\n          }else{\r\n            this.state = immune_system_state.deceased\r\n          }\r\n          this.timer = 0\r\n        }\r\n      break;\r\n      case immune_system_state.deceased:\r\n        // can't do anything :)\r\n      break;\r\n      case immune_system_state.immune:\r\n        this.timer += diff\r\n        if(this.timer > this.immune_time.getValue()*1000){\r\n          this.state = immune_system_state.healthy\r\n          this.timer = 0\r\n        }\r\n      break;\r\n    }\r\n  }\r\n\r\n  get infectable() {\r\n    return this._state === immune_system_state.healthy\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    if(!this.infectable) return\r\n    let _rnd = Math.random()\r\n    if(_rnd <= this.infection_rate.getValue()){\r\n      this.state = immune_system_state.incubating\r\n    }\r\n  }\r\n\r\n\r\n\r\n}\r\n","export class AppColors {\r\n  static immune: string = '#273B89'\r\n  static healthy: string = '#C9D1B2'\r\n  static infected: string = '#F36F21'\r\n  static sick: string = '#FF1919'\r\n  static dead: string = '#191919'\r\n\r\n  static outline: string = '#2a4e6c'\r\n\r\n  static fontColor: string = '#0B141C'\r\n\r\n}\r\n","import { vec2, ruler } from './utils'\r\nimport { EventEmitter } from 'events'\r\nimport { AppColors }  from './color'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class graphedVariable {\r\n  static variableList: graphedVariable[] = []\r\n  static emitter: EventEmitter = new EventEmitter()\r\n\r\n  name: string\r\n  color: string\r\n\r\n  values: number[]\r\n  n: number\r\n\r\n  constructor(name: string = 'none', color: string = '#000'){\r\n    this.name = name\r\n    this.color = color\r\n\r\n    this.n = 0\r\n    this.values = []\r\n\r\n    graphedVariable.variableList.push(this)\r\n    // console.log(parameter.paramList)\r\n    graphedVariable.emitter.emit('paramAdded', this)\r\n  }\r\n\r\n  appendValue(val: number){\r\n    this.values.push(val)\r\n    graphedVariable.emitter.emit('variableUpdated', val, this)\r\n  }\r\n\r\n  get data(){\r\n    // TODO add preprocessing?\r\n    return this.values\r\n  }\r\n\r\n  resetData(){\r\n    this.n = 0\r\n    this.values = []\r\n  }\r\n\r\n  static on(event: string, callback: any){\r\n    graphedVariable.emitter.on(event, callback)\r\n  }\r\n\r\n  static getGraphVariableByName(name: string): graphedVariable|null{\r\n    let vars: graphedVariable[] = []\r\n    for(let variable of graphedVariable.variableList){\r\n      if(variable.name === name) vars.push(variable)\r\n    }\r\n\r\n    if(vars.length === 0) return null\r\n    return vars[0]\r\n  }\r\n\r\n  static getGraphVariableByNameOrCreate(name: string, color: string): graphedVariable{\r\n    let _var = this.getGraphVariableByName(name)\r\n    if(!_var){\r\n      _var = new graphedVariable(name, color)\r\n    }\r\n    return _var\r\n  }\r\n\r\n  static getGraphedVariables(){\r\n    return graphedVariable.variableList\r\n  }\r\n\r\n}\r\n\r\n\r\nexport class grapher{\r\n  values: number[][]\r\n  ctx: CanvasRenderingContext2D\r\n  size: vec2\r\n  sizeChanged: boolean = false\r\n\r\n  maxVal: number\r\n  minVal: number\r\n  boundsChanged: boolean\r\n\r\n  xScale: number\r\n  yScale: number\r\n  stepSize: number\r\n  margin: number = 10\r\n  rowSize: number\r\n\r\n  varNamesWidthPx: number = 0\r\n  fontSizePt: number = 10\r\n  colorDotSizePx: number = 4\r\n  varNameSizePx: number = 25\r\n\r\n  legendSize: number = 50\r\n  legendMarkerHeight: number = 0\r\n  nRows = 4\r\n\r\n  dataChanged: boolean = true\r\n\r\n  updateIntervalID: timerHandle|null = null\r\n\r\n  constructor(ctx: CanvasRenderingContext2D){\r\n    this.values = []\r\n    this.ctx = ctx\r\n\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.boundsChanged = true\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    graphedVariable.on('variableUpdated', this.varUpdatedListener.bind(this))\r\n    graphedVariable.on('paramAdded', this.varAddedListener.bind(this))\r\n\r\n    // set these values for your data\r\n    let sections = 12;\r\n    this.stepSize = 40;\r\n    this.rowSize = 50;\r\n\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.xScale = (this.size.x - this.rowSize) / sections;\r\n\r\n    this.startUpdateInterval(100)\r\n\r\n    this.redrawLegend()\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n    this.sizeChanged = true\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  _updateLengendSizing(){\r\n\r\n    let fontsize_px = this.size.y / 13\r\n    fontsize_px *= 0.85\r\n    this.fontSizePt = fontsize_px*0.75\r\n    let fontStyle = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n\r\n    this.varNameSizePx = fontsize_px * 1.5\r\n    this.colorDotSizePx = Math.min(4, this.varNameSizePx/3)\r\n\r\n\r\n    let maxSizePx = 0\r\n    for (let _var of graphedVariable.variableList){\r\n      let nameSizePx = ruler.checkLength(_var.name + 'aa', fontStyle)\r\n      maxSizePx = Math.max(maxSizePx, nameSizePx)\r\n      // console.log(_var.name + '=>' + nameSizePx)\r\n    }\r\n    this.varNamesWidthPx = maxSizePx + 2*this.colorDotSizePx\r\n\r\n    this.legendSize = 2 * ruler.checkLength(this.maxVal.toFixed(1), fontStyle)\r\n    this.legendMarkerHeight = ruler.checkHeight(this.maxVal.toFixed(1), fontStyle)\r\n  }\r\n\r\n  varAddedListener(_var: graphedVariable){\r\n    this._updateLengendSizing()\r\n  }\r\n\r\n  varUpdatedListener(newval: number, _var: any): void {\r\n    if(newval < this.minVal){\r\n      this.minVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    if(newval > this.maxVal){\r\n      this.maxVal = newval\r\n      this.boundsChanged = true\r\n      this._updateLengendSizing()\r\n    }\r\n    this.dataChanged = true\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this.update.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  update(){\r\n    if(!this.dataChanged) return\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n    if(this.boundsChanged){\r\n      this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n      // this.xScale = (this.size.x - this.rowSize) / sections;\r\n      this.boundsChanged = false\r\n    }\r\n\r\n    this.redrawLegend()\r\n    this.plotAllGraphVariables()\r\n    // console.log(this)\r\n    this.dataChanged = false\r\n  }\r\n\r\n  redrawLegend(){\r\n    this.ctx.fillStyle = AppColors.fontColor\r\n    this.ctx.font = `${this.fontSizePt.toFixed(1)}pt Oswald`\r\n    // this.ctx.font = '10pt Oswald'\r\n\r\n    let idx = 0\r\n    let offset = this.size.y - graphedVariable.getGraphedVariables().length * this.varNameSizePx\r\n    offset = (offset / 2) + this.margin\r\n    for (let _var of graphedVariable.getGraphedVariables()){\r\n      this.ctx.fillStyle = _var.color\r\n      // this.ctx.fillText(_var.name, this.margin, 20);\r\n      this.ctx.fillStyle = AppColors.fontColor\r\n      let y = offset + idx*this.varNameSizePx\r\n      this.ctx.fillText(_var.name, this.margin + this.legendSize, y);\r\n      this.ctx.fillStyle = _var.color\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(this.margin - 8 + this.legendSize,  y - 4, this.colorDotSizePx, 0, 2 * Math.PI, false);\r\n      this.ctx.fill()\r\n      idx ++\r\n    }\r\n\r\n    let stepSize = (this.maxVal - this.minVal) / this.nRows\r\n    // print row header and draw horizontal grid lines\r\n    var count =  0;\r\n    this.ctx.strokeStyle = AppColors.fontColor\r\n    this.ctx.fillStyle = AppColors.fontColor\r\n\r\n    let steps = 4\r\n    let ySize = (this.size.y - 2*this.margin)\r\n    for(let i=0;i<=steps;i++){\r\n      let y = this.margin + ySize * (i/steps)\r\n      let scale = this.minVal + (this.maxVal - this.minVal) * (1 - i/steps)\r\n      this.ctx.fillText(scale.toFixed(1), this.margin, y + this.legendMarkerHeight/4);\r\n      this.ctx.moveTo(this.legendSize + this.varNamesWidthPx, y)\r\n      this.ctx.lineTo(this.size.x - this.margin,y)\r\n    }\r\n    this.ctx.stroke();\r\n  }\r\n\r\n  plotAllGraphVariables(){\r\n    this.ctx.translate(this.legendSize, 0);\r\n    let variables = graphedVariable.getGraphedVariables()\r\n    for(let gv of variables){\r\n      this.ctx.strokeStyle = gv.color\r\n      this.plotData(gv.data)\r\n    }\r\n    this.ctx.translate(-this.legendSize, 0);\r\n  }\r\n\r\n  plotData(dataSet: number[]) {\r\n    let sections = dataSet.length\r\n    // let rowsize = this.size.x / sections\r\n    let xScale = this.size.x / sections;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.yScale * (this.maxVal - dataSet[0]) + this.margin);\r\n    for (let i=1;i<sections;i++) {\r\n      this.ctx.lineTo(i * xScale, this.yScale * (this.maxVal - dataSet[i]) + this.margin);\r\n    }\r\n    this.ctx.stroke();\r\n    }\r\n\r\n  reset(){\r\n    this.minVal = 0\r\n    this.maxVal =  1\r\n    this.yScale = (this.size.y - 2*this.margin) / (this.maxVal - this.minVal);\r\n  }\r\n}\r\n","import * as boids from \"./boids\";\nimport * as rules from \"./boidRules\"\nimport { vec2, rect, parameter, parameter_type } from './utils'\nimport { ParameterController } from './parametercontrol'\nimport { grapher } from './grapher'\n\n\n\nlet initCanvas = (canvasElement: HTMLCanvasElement, container: HTMLElement) => {\n  let canvasContext: CanvasRenderingContext2D|null = canvasElement.getContext('2d');\n\n  let resizeHandler = () => {\n    let h = canvasElement.clientHeight\n    canvasElement.height = h\n    let w = canvasElement.clientWidth\n    canvasElement.width = w\n    if(canvasContext){\n      canvasContext.canvas.width  = w;\n      canvasContext.canvas.height = h;\n    }\n\n  }\n\n  window.addEventListener('resize', resizeHandler);\n\n  resizeHandler()\n\n  return canvasContext\n}\n\nlet _initPandaemicApplication = (canvas: HTMLCanvasElement) => {\n  let container: HTMLElement|null = document.getElementById('be_canvas_container')\n  if(!container) return\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n\n  let options = new boids.boidEngineConfig()\n  options.maxEntities = 200\n  options.maxEntitySize = 8\n  options.minEntitySize = 8\n  options.fps = 25\n\n  let be = new boids.boidEngine(ctx, options)\n\n  let randr = new rules.randomRule()\n  be.addRule(randr)\n\n  let socr = new rules.socialRule();\n  be.addRule(socr)\n\n  let avr = new rules.avoidanceRule()\n  be.addRule(avr)\n\n  let sickr = new rules.sicknessRule()\n  be.addRule(sickr)\n\n  window.infectOne = be.infectOne.bind(be)\n\n  // be.startRenderInterval(100)\n  // setInterval(be.reset.bind(be), 1000)\n  return be\n}\n\nlet _initParameterController = () => {\n  let param_container = document.getElementById('p_container')\n  let app_window = document.getElementById('window')\n\n\n  if(param_container && app_window){\n    param_container.style.maxHeight = 0.95*app_window.getBoundingClientRect().height + 'px';\n    let _ctrl = new ParameterController(param_container)\n  }\n}\n\nlet _initGrapher = (canvas: HTMLCanvasElement) => {\n\n  let container: HTMLElement|null = document.getElementById('graph_canvas_container')\n  if(!container) return\n\n  let ctx = initCanvas(canvas, container)\n  if(!ctx) return\n  let _grapher = new grapher(ctx)\n  return _grapher\n}\n\nlet _initControls = (be: boids.boidEngine, gr: grapher) => {\n  let btnRestart: HTMLElement|null = document.getElementById('btn_restart')\n  if(btnRestart){\n    btnRestart.onclick = () => {\n      if(!btnRestart) return\n      be.restart()\n      gr.reset()\n    }\n  }\n}\n\nlet main = () => {\n\n  _initParameterController()\n\n  let be = null, gr = null\n\n  //get the grapher canvas element\n  let grapherCanvasElement: HTMLCanvasElement|null = document.getElementById('graph_canvas') as HTMLCanvasElement\n  if(grapherCanvasElement) gr = _initGrapher(grapherCanvasElement)\n\n  // get the canvas element\n  let canvasElement: HTMLCanvasElement|null = document.getElementById('canvas') as HTMLCanvasElement\n  if(canvasElement) be = _initPandaemicApplication(canvasElement)\n\n  if(be && gr){\n    _initControls(be, gr)\n  }\n\n  // Mobile scroll test:\n  window.addEventListener(\"load\",() => {\n    setTimeout(() => window.scrollTo(0, 1), 0);\n  });\n\n  /*\n  for(let i=0; i<20; i++){\n    let param = new parameter(0, 1, parameter_type.universal, `rule_${i}`)\n  }\n  */\n\n}\n\nwindow.onload = main\n","import { vec2, rect, parameter, parameter_type } from \"./utils\";\r\nimport { boidRule, distanceAccelerator, distanceElement} from './boidRules'\r\nimport { immune_system, immune_system_state } from './pandemic'\r\nimport { AppColors } from './color'\r\n\r\nimport { graphedVariable } from './grapher'\r\n\r\ntype timerHandle = number;\r\n\r\nexport class boidEngineConfig {\r\n  maxEntities: number = 500;\r\n  minEntitySize: number = 3;\r\n  maxEntitySize: number = 3;\r\n\r\n  fps: number|null = null;\r\n\r\n  continuum: boolean = true;\r\n}\r\n\r\nexport class boidRuleConfig {\r\n\r\n}\r\n\r\nexport class boidEngine {\r\n\r\n  nEntities: parameter\r\n  ctx: CanvasRenderingContext2D\r\n\r\n  size: vec2\r\n  bound_size: vec2\r\n  _hbs: vec2\r\n\r\n  entity_size: parameter\r\n\r\n  entities: boid[]\r\n  entitiesToBeRemoved: boid[] = []\r\n  resetInNext: boolean = false\r\n\r\n  renderIntervalID: timerHandle|null = null\r\n  updateIntervalID: timerHandle|null = null\r\n  updateInterval: number = 0;\r\n\r\n  entitiesToInfect: parameter\r\n\r\n  rules: boidRule[] = []\r\n\r\n  continuum: boolean;\r\n\r\n  // graphed data:\r\n  gv_EntitiesAlive: graphedVariable\r\n  gv_EntitiesInfected: graphedVariable\r\n  gv_EntitiesSick: graphedVariable\r\n  gv_EntitesImmune: graphedVariable\r\n  gv_EntitiesDead: graphedVariable\r\n\r\n  // Initialization\r\n\r\n  constructor(ctx: CanvasRenderingContext2D, options: boidEngineConfig = new boidEngineConfig()){\r\n    this.ctx = ctx\r\n\r\n    this.nEntities = new parameter(10, options.maxEntities, parameter_type.universal, 'nEntities')\r\n    this.nEntities.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    let eps = parameter.getParameterByName('EntitySize')\r\n    this.entity_size = (eps)? eps :  new parameter(options.minEntitySize, options.maxEntitySize, parameter_type.entity_scoped, 'EntitySize')\r\n    this.entity_size.registerDependency(this._parameterUpdateHandler.bind(this))\r\n\r\n    this.entitiesToInfect = parameter.getParameterByNameOrCreate('# Infected at Start', parameter_type.universal, 0, 10)\r\n\r\n    this.continuum = options.continuum\r\n\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n    this.entities = []\r\n\r\n    this._initBoids()\r\n\r\n    if(options.fps){\r\n      let frametime = 1000/options.fps;\r\n      this.startRenderInterval(frametime)\r\n      this.startUpdateInterval(frametime)\r\n      this.updateInterval = frametime;\r\n    }\r\n    this.gv_EntitiesAlive = graphedVariable.getGraphVariableByNameOrCreate('Entities Alive', AppColors.healthy)\r\n    this.gv_EntitiesInfected = graphedVariable.getGraphVariableByNameOrCreate('Entities Infected' , AppColors.infected)\r\n    this.gv_EntitiesSick = graphedVariable.getGraphVariableByNameOrCreate('Entities Sick', AppColors.sick)\r\n    this.gv_EntitesImmune = graphedVariable.getGraphVariableByNameOrCreate('Entities Immune', AppColors.immune)\r\n    this.gv_EntitiesDead = graphedVariable.getGraphVariableByNameOrCreate('Entities Dead', AppColors.dead)\r\n\r\n    window.addEventListener('resize', () => setTimeout(this.resizeEvent.bind(this), 10))\r\n  }\r\n\r\n  resizeEvent(){\r\n    let width:number = this.ctx.canvas.width\r\n    let height:number = this.ctx.canvas.height\r\n\r\n    this.size = new vec2(width, height)\r\n\r\n    this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n    this._hbs = this.bound_size.scl(1/2)\r\n  }\r\n\r\n  infectOne(){\r\n    let idx = Math.floor(this.entities.length * Math.random())\r\n    this.entities[idx].setImmuneSystemState(immune_system_state.incubating)\r\n  }\r\n\r\n  boidStateUpdateHandler(entity: boid, state: immune_system_state){\r\n    // console.log(`boid #${entity.id} state is now: ${state}`)\r\n    if(state === immune_system_state.deceased){\r\n      //console.log 'removing boid'\r\n      this.entitiesToBeRemoved.push(entity)\r\n    }\r\n  }\r\n\r\n  _generateNewBoid(){\r\n    let id = this.entities.length\r\n    // choose a new starting point randomly :)\r\n    let _x = Math.random()\r\n    let _y = Math.random()\r\n    let _pos = new vec2(_x, _y).scl(this.bound_size)\r\n\r\n    // generate a new entity\r\n    let _ent = new boid(_pos, this.entity_size, id)\r\n\r\n    _ent.onImmuneSystemStateUpdated = this.boidStateUpdateHandler.bind(this, _ent)\r\n\r\n    this.entities.push(_ent)\r\n  }\r\n\r\n  _initBoids(){\r\n    for(let i=0; i<this.nEntities.getValue(); i++){\r\n      this._generateNewBoid()\r\n    }\r\n    for(let i =0; i<this.entitiesToInfect.getValue(); i++){\r\n      this.infectOne()\r\n    }\r\n  }\r\n\r\n  _parameterUpdateHandler(param: parameter){\r\n    switch(param.name){\r\n      case 'nEntities':\r\n        let n = param.getValue()\r\n        let diff = n - this.entities.length\r\n        for(let i=0; i<Math.abs(diff); i++) (diff > 0)? this._generateNewBoid() : this.entities.pop()\r\n      break;\r\n      case 'EntitySize':\r\n        this.bound_size = this.size.sub(this.entity_size.getValue()*4)\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Render/Update Intervals\r\n\r\n  startRenderInterval(interval: number){\r\n    if(this.renderIntervalID !== null){\r\n      clearInterval(this.renderIntervalID)\r\n    }\r\n    this.renderIntervalID = setInterval(this._render.bind(this), interval) as unknown as number\r\n  }\r\n\r\n  stopRenderInterval(){\r\n    if(this.renderIntervalID){\r\n      clearInterval(this.renderIntervalID)\r\n      this.renderIntervalID = null\r\n    }\r\n  }\r\n\r\n  startUpdateInterval(interval: number){\r\n    if(this.updateIntervalID !== null){\r\n      clearInterval(this.updateIntervalID)\r\n    }\r\n    this.updateIntervalID = setInterval(this._update.bind(this), interval) as unknown as number\r\n\r\n    this.updateInterval = interval\r\n  }\r\n\r\n  stopUpdateInterval(){\r\n    if(this.updateIntervalID){\r\n      clearInterval(this.updateIntervalID)\r\n      this.updateIntervalID = null\r\n    }\r\n  }\r\n\r\n  // interface Methods\r\n\r\n  reset(){\r\n    this.entities = []\r\n    this._initBoids()\r\n  }\r\n\r\n  addRule(_rule: boidRule){\r\n    console.log(_rule)\r\n    this.rules.push(_rule)\r\n  }\r\n\r\n  clearRules(){\r\n    this.rules = []\r\n  }\r\n\r\n  // Render/Update Methods\r\n\r\n  _render(){\r\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\r\n\r\n    let id=0\r\n    for(let entity of this.entities){\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI, false);\r\n      switch(entity.immuneState){\r\n        case immune_system_state.immune:\r\n        this.ctx.fillStyle = AppColors.immune;\r\n        break;\r\n\r\n        case immune_system_state.healthy:\r\n        this.ctx.fillStyle = AppColors.healthy;\r\n        break;\r\n\r\n        case immune_system_state.incubating:\r\n        this.ctx.fillStyle = AppColors.infected;\r\n        break;\r\n\r\n        case immune_system_state.sick:\r\n        this.ctx.fillStyle = AppColors.sick;\r\n        break;\r\n      }\r\n\r\n      this.ctx.fill();\r\n\r\n      this.ctx.beginPath();\r\n      this.ctx.strokeStyle = AppColors.outline\r\n      this.ctx.lineWidth = 0.3;\r\n      this.ctx.arc(entity.position.x, entity.position.y, this.entity_size.getValue(id)/2, 0, 2 * Math.PI);\r\n      this.ctx.stroke();\r\n      id ++\r\n    }\r\n  }\r\n\r\n  _updateGraphData(){\r\n    let nEntitesMax = this.nEntities.getValue()\r\n    let nAlive: number = this.entities.length\r\n    let nInfected: number = 0\r\n    let nSick: number = 0\r\n    let nImmune: number = 0\r\n    let nDead: number = nEntitesMax - this.entities.length\r\n\r\n    for(let ent of this.entities){\r\n      switch(ent.immuneState){\r\n        case immune_system_state.immune:\r\n          nImmune ++\r\n          break;\r\n        case immune_system_state.incubating:\r\n          nInfected ++\r\n          break;\r\n        case immune_system_state.sick:\r\n          nSick ++\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.gv_EntitiesAlive.appendValue(nAlive)\r\n    this.gv_EntitiesInfected.appendValue(nInfected)\r\n    this.gv_EntitiesSick.appendValue(nSick)\r\n    this.gv_EntitesImmune.appendValue(nImmune)\r\n    this.gv_EntitiesDead.appendValue(nDead)\r\n  }\r\n\r\n  _update(){\r\n    if(this.resetInNext){\r\n      this.entities = []\r\n      this._initBoids()\r\n      this.resetInNext = false;\r\n    }\r\n\r\n    if(this.entities.length > 0) this._updateGraphData();\r\n    for(let ent of this.entitiesToBeRemoved){\r\n      this.entities.splice(this.entities.indexOf(ent), 1)\r\n    }\r\n    this.entitiesToBeRemoved = []\r\n    //console.log('stepping panda')\r\n    let diff = this.updateInterval;\r\n    //TODO calulate distance matrix\r\n    let distMatrix = distanceAccelerator(this.entities)\r\n    //let rules_list = [rules.socialRule, rules.randomRule, rules.makeBorderRule(this.size)]\r\n\r\n    for(let entity of this.entities){\r\n      entity.update(diff, this.entities, distMatrix, this.rules)\r\n    }\r\n\r\n    if(this.continuum){\r\n      let id = 0\r\n      for(let entity of this.entities){\r\n        let point = entity.position\r\n        if(point.x < -this.entity_size){\r\n          entity.position.x += this.size.x + entity.size\r\n        }else if (point.x > (this.size.x + this.entity_size.getValue(id))){\r\n          entity.position.x -= this.size.x + entity.size\r\n        }\r\n\r\n        if(point.y < -this.entity_size){\r\n          entity.position.y += this.size.y + entity.size\r\n        }else if (point.y > (this.size.y + this.entity_size.getValue(id))){\r\n          entity.position.y -= this.size.y + entity.size\r\n        }\r\n        id ++\r\n      }\r\n    }\r\n  }\r\n\r\n  restart(){\r\n    console.log('restarting be')\r\n\r\n    this.resetInNext = true\r\n\r\n    this.gv_EntitiesAlive.resetData()\r\n    this.gv_EntitiesInfected.resetData()\r\n    this.gv_EntitiesSick.resetData()\r\n    this.gv_EntitesImmune.resetData()\r\n    this.gv_EntitiesDead.resetData()\r\n  }\r\n\r\n}\r\n\r\nlet limit = (min: number, max: number, val:number) => {\r\n  if(val < min) return min\r\n  if(val > max) return max\r\n  return val\r\n}\r\n\r\nlet limit_vec_len = (vec:vec2, limit:number) => {\r\n  let len = vec.len()\r\n  if(len>limit) return vec.norm().scl(limit)\r\n  return vec\r\n}\r\n\r\nexport class boid {\r\n  position: vec2\r\n  velocity: vec2 = new vec2()\r\n  state: string\r\n  _size: parameter\r\n\r\n  id: number\r\n\r\n  acceleration: parameter\r\n  speed: parameter\r\n\r\n  immuneSystem: immune_system\r\n  ImmuneSystemStateUpdateHandler: any | null\r\n\r\n  constructor(pos: vec2 = new vec2(), size:parameter, id:number=0) {\r\n    this.position = pos\r\n    this._size = size\r\n    this.state = 'base'\r\n\r\n    this.id = id\r\n\r\n    this.acceleration = parameter.getParameterByNameOrCreate('Entity Acceleration', parameter_type.universal, 15, 25)\r\n    this.speed = parameter.getParameterByNameOrCreate('Entity Speed', parameter_type.universal, 15, 20)\r\n\r\n    this.immuneSystem = new immune_system()\r\n  }\r\n\r\n  update(diff: number, entities:boid[], distanceMatrix:distanceElement[][], rules: boidRule[]){\r\n    let walk_dir = new vec2()\r\n\r\n    for(let idx=0; idx < rules.length; idx ++){\r\n      let rule = rules[idx]\r\n\r\n      // get the corresponding parameter :)\r\n      let rule_dir = rule.executeRule(this, entities, distanceMatrix)\r\n      rule_dir = rule.weightRule(rule_dir, this)\r\n      walk_dir = walk_dir.add(rule_dir)\r\n    }\r\n    let walk_acc = walk_dir.norm().scl(this.acceleration.getValue() * diff/1000)\r\n    this.velocity = this.velocity.add(walk_acc)\r\n    this.velocity = limit_vec_len(this.velocity, this.speed.getValue())\r\n\r\n    let new_position = this.position.add(this.velocity.scl(diff/1000))\r\n    // console.log(new_position.sub(this.position).len())\r\n\r\n    this.position = this._resolveCollisions(new_position, walk_dir, entities)\r\n\r\n    this.immuneSystem.update(diff)\r\n  }\r\n\r\n  inVirusVicinity(){\r\n    this.immuneSystem.inVirusVicinity()\r\n  }\r\n\r\n  setImmuneSystemState(state: immune_system_state){\r\n    this.immuneSystem.state = state\r\n  }\r\n\r\n  // TODO move this to the engine :)\r\n  _resolveCollisions(newpos: vec2, walk_dir: vec2, entities:boid[]): vec2{\r\n    // could be sped up by only checking entities which were in the neighborhood before via max_walk_dist & distanceMatrix\r\n\r\n    let nEntities = entities.length\r\n\r\n    for(let i=0; i<nEntities; i++){\r\n      let entity = entities[i]\r\n      if(entity === this) continue\r\n      let dvec = entities[i].position.sub(newpos)\r\n      let len = dvec.len()\r\n\r\n      let mindist = this.size/2 + entities[i].size/2\r\n      if(len < mindist){\r\n        let resolve_vector = dvec.norm().scl(mindist - len)\r\n        // entities[i].position = entities[i].position.add(dvec.scl(0.25))\r\n        newpos = newpos.sub(resolve_vector)\r\n      }\r\n    }\r\n\r\n    return newpos\r\n  }\r\n\r\n  get size(): number{\r\n    return this._size.getValue(this.id)\r\n  }\r\n\r\n  get immuneState(){\r\n    return this.immuneSystem.state\r\n  }\r\n\r\n  set onImmuneSystemStateUpdated(callback: any){\r\n    this.immuneSystem.onStateUpdated = callback\r\n  }\r\n\r\n}\r\n\r\n/*\r\n\r\n\r\nsize: vec2\r\nbound_size: vec2\r\n_hbs: vec2\r\nentities: pandaEntity[]\r\n\r\nconstructor(ctx: CanvasRenderingContext2D, n: number){\r\n\r\n\r\n  this.ctx = ctx\r\n*/\r\n","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import { parameter, parameter_type } from './utils'\r\n\r\nexport class ParameterControl {\r\n  controller: ParameterController\r\n  controlledParameter: parameter\r\n\r\n  minElement: HTMLInputElement|null = null\r\n  maxElement: HTMLInputElement|null = null\r\n  valueSlider: HTMLInputElement|null = null\r\n\r\n  constructor(controller: ParameterController, param: parameter){\r\n    this.controller = controller\r\n    this.controlledParameter = param\r\n    this.createUIElement()\r\n    this.attachListeners()\r\n  }\r\n\r\n  createUIElement(){\r\n    let listElem = document.createElement('li');\r\n    listElem.className = ''\r\n    let param_ctrl = document.createElement('div')\r\n    param_ctrl.className = 'param_options | no_select'\r\n    param_ctrl.innerText = this.controlledParameter.name + '\\n'\r\n\r\n    if(this.controlledParameter.type === parameter_type.entity_scoped ||\r\n       this.controlledParameter.type === parameter_type.universal){\r\n\r\n         let label_min: HTMLLabelElement = document.createElement('label')\r\n         label_min.htmlFor = `${this.controlledParameter.name}_min`\r\n         label_min.innerText = 'min:'\r\n         let input_min: HTMLInputElement = document.createElement('input')\r\n         input_min.name = `${this.controlledParameter.name}_min`\r\n         input_min.type = 'number'\r\n         input_min.value = this.controlledParameter.min + ''\r\n\r\n         let br_el = document.createElement('br')\r\n\r\n         let label_max: HTMLLabelElement = document.createElement('label')\r\n         label_max.htmlFor = `${this.controlledParameter.name}_max`\r\n         label_max.innerText = 'max:'\r\n         let input_max: HTMLInputElement = document.createElement('input')\r\n         input_max.name = `${this.controlledParameter.name}_max`\r\n         input_max.type = 'number'\r\n         input_max.value = this.controlledParameter.max + ''\r\n\r\n         this.minElement = input_min\r\n         this.maxElement = input_max\r\n\r\n         param_ctrl.appendChild(label_min)\r\n         param_ctrl.appendChild(input_min)\r\n         param_ctrl.appendChild(br_el)\r\n         param_ctrl.appendChild(label_max)\r\n         param_ctrl.appendChild(input_max)\r\n    }\r\n    listElem.appendChild(param_ctrl)\r\n\r\n    if(this.controlledParameter.type === parameter_type.universal ||\r\n       this.controlledParameter.type === parameter_type.universal_percentage){\r\n      let param_setpoint = document.createElement('div')\r\n      param_setpoint.className = 'param_setpoint'\r\n\r\n      let param_slider: HTMLInputElement = document.createElement('input')\r\n      param_slider.type = 'range'\r\n      param_slider.min = '0'\r\n      param_slider.max = '1000'\r\n      param_slider.value = '500'\r\n\r\n      param_setpoint.appendChild(param_slider)\r\n\r\n      listElem.appendChild(param_setpoint)\r\n      this.valueSlider = param_slider\r\n    }\r\n    this.controller.addUIElement(listElem)\r\n  }\r\n\r\n  attachListeners(){\r\n    if(this.minElement){\r\n      let _el: HTMLInputElement = this.minElement\r\n      this.minElement.onchange = () => { this.controlledParameter.setMin(parseInt(_el.value)) }\r\n    }\r\n\r\n    if(this.maxElement){\r\n      let _el: HTMLInputElement = this.maxElement\r\n      this.maxElement.onchange = () => { this.controlledParameter.setMax(parseInt(_el.value)) }\r\n    }\r\n\r\n    if(this.valueSlider){\r\n      let _el: HTMLInputElement = this.valueSlider\r\n      this.valueSlider.onchange = () => {\r\n        let val: number = parseInt(_el.value)/1000.0\r\n        val *= this.controlledParameter.max - this.controlledParameter.min\r\n        val += this.controlledParameter.min\r\n        this.controlledParameter.setValue(val)\r\n       }\r\n    }\r\n  }\r\n}\r\n\r\nexport class ParameterController {\r\n  parameter_container: HTMLElement\r\n  controlElements: ParameterControl[]\r\n\r\n  constructor(container: HTMLElement){\r\n    this.parameter_container = container\r\n    parameter.emitter.on('paramAdded', this.parameterAddHandler.bind(this))\r\n\r\n    this.controlElements = []\r\n  }\r\n\r\n  parameterAddHandler(param: parameter){\r\n    let _ctrl = new ParameterControl(this, param)\r\n    this.controlElements.push(_ctrl)\r\n  }\r\n\r\n  addUIElement(element: HTMLElement){\r\n    this.parameter_container.appendChild(element)\r\n  }\r\n\r\n}\r\n"],"sourceRoot":""}